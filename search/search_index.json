{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"What is StartLeft?","text":"<p>StartLeft is an automation tool for generating Threat Models written in the Open Threat Model (OTM)  format from a variety of different sources such as IaC files, diagrams or projects exported from  Threat Modeling tools.</p>"},{"location":"#why-startleft","title":"Why StartLeft?","text":"<p>Automation and integration are the core goals of StartLeft. It was born as an internal project of  IriusRisk, whose leading threat  modelling tool allows the users to build a complete Threat Model of an application only by depicting its architecture in a diagram. However, there is a bunch of formats in which the architecture (or directly the TM) can be defined. This led IriusRisk to create and share with the community two key  resources:</p> <ul> <li>Open Threat Model (OTM), a standardized and vendor-agnostic way to represent Threat Models      to make them easily portable between platforms.</li> <li>StartLeft, a tool for automating the conversion from different sources into OTM.</li> </ul> <p>In some cases, StartLeft acts only as a format translator, like in case of diagrams or Threat Model sources, but it has also specific and configurable logic for generating Threat Models (TMs) from Infrastructure as Code (IaC) files, which  brings a great advantage reducing the necessary knowledge and manual work required for translating infrastructure  into TM, as well as enabling the users to make amazing things like integrating the generation of the TM in a CI/CD  pipeline of the actual IaC file.</p> <p>StartLeft is currently an Open Source application powered by IriusRisk, that is already using it as an intermediate  service for all the imports of new projects from external sources.</p>"},{"location":"#what-input-sources-are-supported","title":"What input sources are supported?","text":"<p>Split by type, the currently supported input formats are:</p> <ul> <li> <p>Infrastructure as Code (IaC):</p> <ul> <li>CloudFormation (CFT).</li> <li>Terraform (TF).</li> <li>Diagram:</li> <li>Microsoft Visio (including diagrams exported from Lucidchart).</li> <li>Threat Model:</li> <li>Microsoft Threat Modeling Tool (MTMT).</li> </ul> </li> </ul>"},{"location":"#how-can-i-try-it","title":"How can I try it?","text":"<p>Simply install the tool and play with its Command Line Interface. You can also set up a REST API with a single command and consume it with any REST client such as Postman. Anyway, the best way to start is by following the  Quickstart guide for beginners.</p>"},{"location":"#how-can-i-integrate-it","title":"How can I integrate it?","text":"<p>One of the most interesting aspects of StartLeft is that it is easily integrable within processes that may need to generate Threat Models. The different ways of integrating StartLeft are described in the  Quickstart guide for integrations.</p>"},{"location":"#how-can-i-contribute","title":"How can I contribute?","text":"<p>StartLeft is an Open Source application whose modularized architecture based on processors is specially focused on simplifying the collaboration for any developer. If you want to contribute, check out the  Quickstart guide for developers and the  CONTRIBUTING.md file.</p>"},{"location":"About/","title":"About this documentation","text":""},{"location":"About/#maintenance","title":"Maintenance","text":"<p>This documentation is maintained by the IriusRisk engineering team. If you find an error, or need any  clarification, please raise an issue in the  StartLeft GitHub repository.</p>"},{"location":"About/#documentation-per-branch","title":"Documentation per branch","text":"<p>The documentation shown here applies to the  latest stable version of StartLeft. If you want to check the  documentation of a previous version or for an ongoing development, you can do it by checking out the desired branch and  deploying its documentation. To do that, first we need to select the right branch:</p> <ul> <li><code>main</code> is the branch for the latest stable version.</li> <li><code>release/{release-number}</code> (i.e: <code>release/1.7.0</code>) are the branches for each version.</li> <li><code>dev</code> is the branch that contains the developments that will be delivered in the next version.</li> <li><code>feature/{feature-number}</code> (i.e: <code>feature/600</code>) are the branches for specific developments.</li> </ul> <p>So, suppose for example you want to check the documentation for the developments delivered in the next version. You  will need to clone the <code>dev</code> branch:</p> <pre><code>git clone -b dev https://github.com/iriusrisk/startleft.git\n</code></pre> <p>And then launch the StartLeft documentation</p>"},{"location":"About/#launch-startleft-documentation-by-dockerfile","title":"Launch StartLeft documentation by Dockerfile","text":"<p>Deploy the documentation using the provided <code>docker-compose.yml</code> file inside the <code>deployment</code> folder:</p> <ul> <li>With docker installed from debian/ubuntu packages (docker.io) and the docker-compose plugin <pre><code>cd deployment\ndocker-compose up -d docs\n</code></pre></li> <li>With docker installed from docker.com packages <pre><code>cd deployment\ndocker compose up -d docs\n</code></pre></li> </ul> <p>Now you can access the docs in http://localhost:8000.</p> <p> Launch by Dockerfile is recommended in case none modification will be done to the docs</p>"},{"location":"About/#launch-startleft-documentation-by-mkdocs-serve","title":"Launch StartLeft documentation by mkdocs serve","text":"<p>Run into StartLeft root folder <pre><code>pip install -e \".[doc]\"\nmkdocs serve\n</code></pre></p> <p>Browse to http://localhost:8000 to access the documentation.</p> <p> Launch by mkdocs serve is recommended if the docs will be modified, as the changes are  reloaded automatically</p>"},{"location":"Open-Threat-Model-%28OTM%29/","title":"Open Threat Model (OTM)","text":""},{"location":"Open-Threat-Model-%28OTM%29/#open-threat-model-standard","title":"Open Threat Model standard","text":"<p>The <code>Open Threat Modeling Format (OTM)</code> defines a platform independent way to define the threat model of any system. It\u2019s a simple and tool agnostic <code>YAML</code> (or <code>JSON</code>) format that describes the essential  elements and properties of a threat model and which allows to understand what are the components of a system,  how are they distributed, the security risks that could be exposed to attackers and the mitigations that could be  implemented to avoid those vulnerabilities (see https://www.iriusrisk.com/resources-blog/introduction-to-the-open-threat-model-standard).</p> <p>A detailed description about the standard is included in the OTM Project.</p>"},{"location":"Open-Threat-Model-%28OTM%29/#format","title":"Format","text":"<p>An <code>OTM</code> document is itself a JSON object, which may be represented either in JSON or YAML format. All field names in the specification are case-sensitive. This includes all fields that are used as keys in a map.</p> <p>The specification follows the same approach to JSON formats as the OpenAPI specification. See   the Swagger specification  for more information.</p> Manual OTM example <pre><code>    otmVersion: 0.1.0\n    project:\n      name: Manual ThreatModel\n      id:   manual-threatmodel\n    trustZones:\n      - id:   f0ba7722-39b6-4c81-8290-a30a248bb8d9\n        name: Internet\n        risk:\n        trustRating: 1\n      - id:   6376d53e-6461-412b-8e04-7b3fe2b397de\n        name: Public\n        risk:\n        trustRating: 1\n      - id:   2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\n        name: Private Secured\n        risk:\n        trustRating: 100\n    components:\n      - id:     user\n        name:   User\n        type:   generic-client\n        parent:\n        trustZone: f0ba7722-39b6-4c81-8290-a30a248bb8d9\n      - id:     web-server\n        name:   Web server\n        type:   web-application-server-side\n        parent:\n        trustZone: 6376d53e-6461-412b-8e04-7b3fe2b397de\n      - id:     database\n        name:   Database\n        type:   postgresql\n        parent:\n        trustZone: 2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\n    dataflows:\n      - id:     client-connection\n        name:   Client connection\n        source:   user\n        destination:   web-server\n        - id:     database-connection\n        name:   Database connection\n        source:   web-server\n        destination:     database\n</code></pre>"},{"location":"Open-Threat-Model-%28OTM%29/#schema","title":"Schema","text":"<p>The OTM object <code>schema</code> is as follows:</p> Field Type Description otmVersion String REQUIRED This field states the OTM version used in the current file. It is an important field in order to ensure backwards compatibility. project Project object REQUIRED The project node represents the entity within all the other elements are grouped. It's the unit of work. representations Representations object Representations define different ways in which the project may be represented. Representation is an abstract concept and there might be several implementations. assets Assets object Assets are the different kinds of sensible information that take part in our threat model. components Components object Components are the different pieces of software / hardware that make up our project. dataflows DataFlows object Data flows are the elements that describe the movement of relevant information (assets) across our architecture. trustZones TrustZones object Trust zones are the different areas within which components are located. They define how trustworthy an area is, based on how accessible it is: the more accessible, the less trustworthy. threats Threats object Threats are the undesirable outcomes that can occur in our system and that we want to prevent. mitigations Mitigations object Mitigations are the actions that we can take (or controls that we can put in place) in order to prevent a threat from taking place."},{"location":"Open-Threat-Model-%28OTM%29/#open-threat-model-examples","title":"Open Threat Model examples","text":"<p>Some examples of <code>otm</code> files are shown below, along with the project that each one generates.</p> Cloudformation project example OTM fileGenerated project <pre><code>    {\n      \"otmVersion\": \"0.1.0\",\n      \"project\": {\n        \"name\": \"cft_multiple_files_project\",\n        \"id\": \"cft_multiple_files_project_id\"\n      },\n      \"representations\": [\n        {\n          \"name\": \"CloudFormation\",\n          \"id\": \"CloudFormation\",\n          \"type\": \"code\"\n        }\n      ],\n      \"trustZones\": [\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n          \"name\": \"Public Cloud\",\n          \"risk\": {\n            \"trustRating\": 10\n          }\n        },\n        {\n          \"id\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\",\n          \"name\": \"Internet\",\n          \"risk\": {\n            \"trustRating\": 10\n          }\n        }\n      ],\n      \"components\": [\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\",\n          \"name\": \"CustomVPC\",\n          \"type\": \"vpc\",\n          \"parent\": {\n            \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n          },\n          \"tags\": [\n            \"AWS::EC2::VPC\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1\",\n          \"name\": \"PrivateSubnet1\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\"\n          },\n          \"tags\": [\n            \"AWS::EC2::Subnet\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2\",\n          \"name\": \"PrivateSubnet2\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\"\n          },\n          \"tags\": [\n            \"AWS::EC2::Subnet\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet1\",\n          \"name\": \"PublicSubnet1\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\"\n          },\n          \"tags\": [\n            \"AWS::EC2::Subnet\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet2\",\n          \"name\": \"PublicSubnet2\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\"\n          },\n          \"tags\": [\n            \"AWS::EC2::Subnet\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcssm\",\n          \"name\": \"VPCssm\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1\"\n          },\n          \"tags\": [\n            \"AWS::EC2::VPCEndpoint\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcssm\",\n          \"name\": \"VPCssm\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2\"\n          },\n          \"tags\": [\n            \"AWS::EC2::VPCEndpoint\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcssmmessages\",\n          \"name\": \"VPCssmmessages\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1\"\n          },\n          \"tags\": [\n            \"AWS::EC2::VPCEndpoint\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcssmmessages\",\n          \"name\": \"VPCssmmessages\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2\"\n          },\n          \"tags\": [\n            \"AWS::EC2::VPCEndpoint\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcmonitoring\",\n          \"name\": \"VPCmonitoring\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1\"\n          },\n          \"tags\": [\n            \"AWS::EC2::VPCEndpoint\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcmonitoring\",\n          \"name\": \"VPCmonitoring\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2\"\n          },\n          \"tags\": [\n            \"AWS::EC2::VPCEndpoint\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.service\",\n          \"name\": \"Service\",\n          \"type\": \"elastic-container-service\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1\"\n          },\n          \"tags\": [\n            \"AWS::ECS::Service\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.service\",\n          \"name\": \"Service\",\n          \"type\": \"elastic-container-service\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2\"\n          },\n          \"tags\": [\n            \"AWS::ECS::Service\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.service.servicetaskdefinition\",\n          \"name\": \"ServiceTaskDefinition\",\n          \"type\": \"docker-container\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.service\"\n          },\n          \"tags\": [\n            \"AWS::ECS::TaskDefinition\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.service.servicetaskdefinition\",\n          \"name\": \"ServiceTaskDefinition\",\n          \"type\": \"docker-container\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.service\"\n          },\n          \"tags\": [\n            \"AWS::ECS::TaskDefinition\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.servicelb\",\n          \"name\": \"ServiceLB\",\n          \"type\": \"load-balancer\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1\"\n          },\n          \"tags\": [\n            \"AWS::ElasticLoadBalancingV2::LoadBalancer\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.servicelb\",\n          \"name\": \"ServiceLB\",\n          \"type\": \"load-balancer\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2\"\n          },\n          \"tags\": [\n            \"AWS::ElasticLoadBalancingV2::LoadBalancer\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet1.canary\",\n          \"name\": \"Canary\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet1\"\n          },\n          \"tags\": [\n            \"AWS::Synthetics::Canary\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet2.canary\",\n          \"name\": \"Canary\",\n          \"type\": \"empty-component\",\n          \"parent\": {\n            \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet2\"\n          },\n          \"tags\": [\n            \"AWS::Synthetics::Canary\"\n          ]\n        },\n        {\n          \"id\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.vpcssmsecuritygroup.0_0_0_0_0\",\n          \"name\": \"0.0.0.0/0\",\n          \"type\": \"generic-client\",\n          \"parent\": {\n            \"trustZone\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\"\n          },\n          \"tags\": [\n            \"Outbound connection destination IP\"\n          ]\n        },\n        {\n          \"id\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.outboundsecuritygroup.255_255_255_255_32\",\n          \"name\": \"255.255.255.255/32\",\n          \"type\": \"generic-client\",\n          \"parent\": {\n            \"trustZone\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\"\n          },\n          \"tags\": [\n            \"Outbound connection destination IP\"\n          ]\n        },\n        {\n          \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.vpcssm-altsource\",\n          \"name\": \"Systems Manager from VPCEndpoint (grouped)\",\n          \"type\": \"CD-SYSTEMS-MANAGER\",\n          \"parent\": {\n            \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n          },\n          \"tags\": [\n            \"VPCssm (AWS::EC2::VPCEndpoint)\",\n            \"VPCssmmessages (AWS::EC2::VPCEndpoint)\"\n          ]\n        }\n      ],\n      \"dataflows\": [\n        {\n          \"id\": \"f50bd3e2-40cd-4e6a-a794-774bb2f213c2\",\n          \"name\": \"VPCssmSecurityGroup -&gt; VPCssm\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcssm\",\n          \"tags\": [\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"04e8573e-d0aa-4964-ba5a-3492c705f111\",\n          \"name\": \"VPCssm -&gt; VPCssmSecurityGroup\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcssm\",\n          \"destination\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.vpcssmsecuritygroup.0_0_0_0_0\",\n          \"tags\": [\n            \"Allow all outbound traffic by default\",\n            \"-1\",\n            \"0.0.0.0/0\"\n          ]\n        },\n        {\n          \"id\": \"617dee3d-8a20-4153-8c70-9c32fc7ecde3\",\n          \"name\": \"VPCssmSecurityGroup -&gt; VPCssm\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcssm\",\n          \"tags\": [\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"dae9fa64-9828-4710-a3e6-bf618b6a47e6\",\n          \"name\": \"VPCssm -&gt; VPCssmSecurityGroup\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcssm\",\n          \"destination\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.vpcssmsecuritygroup.0_0_0_0_0\",\n          \"tags\": [\n            \"Allow all outbound traffic by default\",\n            \"-1\",\n            \"0.0.0.0/0\"\n          ]\n        },\n        {\n          \"id\": \"d65adb9a-6e1a-4a64-9971-baecb082e617\",\n          \"name\": \"VPCssmmessagesSecurityGroup -&gt; VPCssmmessages\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcssmmessages\",\n          \"tags\": [\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"65cce749-e20c-472f-8323-6aa6693e4205\",\n          \"name\": \"VPCssmmessages -&gt; VPCssmmessagesSecurityGroup\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcssmmessages\",\n          \"destination\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.vpcssmsecuritygroup.0_0_0_0_0\",\n          \"tags\": [\n            \"Allow all outbound traffic by default\",\n            \"-1\",\n            \"0.0.0.0/0\"\n          ]\n        },\n        {\n          \"id\": \"86165718-ca5f-4ddb-b981-0566f6d8f52a\",\n          \"name\": \"VPCssmmessagesSecurityGroup -&gt; VPCssmmessages\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcssmmessages\",\n          \"tags\": [\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"76a092f4-1f7f-4cad-8e65-ad29065aeac5\",\n          \"name\": \"VPCssmmessages -&gt; VPCssmmessagesSecurityGroup\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcssmmessages\",\n          \"destination\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.vpcssmsecuritygroup.0_0_0_0_0\",\n          \"tags\": [\n            \"Allow all outbound traffic by default\",\n            \"-1\",\n            \"0.0.0.0/0\"\n          ]\n        },\n        {\n          \"id\": \"101a5dc5-1d25-445a-92a2-71bafe2661b5\",\n          \"name\": \"VPCmonitoringSecurityGroup -&gt; VPCmonitoring\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcmonitoring\",\n          \"tags\": [\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"abcefff3-5de5-4cae-9b72-4c1db550d782\",\n          \"name\": \"VPCmonitoring -&gt; VPCmonitoringSecurityGroup\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.vpcmonitoring\",\n          \"destination\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.vpcssmsecuritygroup.0_0_0_0_0\",\n          \"tags\": [\n            \"Allow all outbound traffic by default\",\n            \"-1\",\n            \"0.0.0.0/0\"\n          ]\n        },\n        {\n          \"id\": \"60e99a7e-6e0a-44e2-89a9-f8186e6221d4\",\n          \"name\": \"VPCmonitoringSecurityGroup -&gt; VPCmonitoring\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcmonitoring\",\n          \"tags\": [\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"893291bd-509f-40e1-b24d-bce8f1eb6e3a\",\n          \"name\": \"VPCmonitoring -&gt; VPCmonitoringSecurityGroup\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.vpcmonitoring\",\n          \"destination\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.vpcssmsecuritygroup.0_0_0_0_0\",\n          \"tags\": [\n            \"Allow all outbound traffic by default\",\n            \"-1\",\n            \"0.0.0.0/0\"\n          ]\n        },\n        {\n          \"id\": \"fffa11dd-2d92-4d9e-b28c-a0468af49870\",\n          \"name\": \"Service -&gt; OutboundSecurityGroup\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.service\",\n          \"destination\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.outboundsecuritygroup.255_255_255_255_32\",\n          \"tags\": [\n            \"Disallow all traffic\",\n            \"icmp\",\n            \"255.255.255.255/32\"\n          ]\n        },\n        {\n          \"id\": \"5e84eded-dd7a-48f2-83df-714bce5ddd81\",\n          \"name\": \"Service -&gt; OutboundSecurityGroup\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.service\",\n          \"destination\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9.outboundsecuritygroup.255_255_255_255_32\",\n          \"tags\": [\n            \"Disallow all traffic\",\n            \"icmp\",\n            \"255.255.255.255/32\"\n          ]\n        },\n        {\n          \"id\": \"5c22512c-36c9-421c-a7da-bb1bf2994956\",\n          \"name\": \"ServiceLB -&gt; Service\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.servicelb\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.service\",\n          \"tags\": [\n            \"Load balancer to target\",\n            \"tcp\",\n            \"80\",\n            \"80\",\n            \"Load balancer to target\",\n            \"tcp\",\n            \"80\",\n            \"80\"\n          ]\n        },\n        {\n          \"id\": \"9224208d-918b-4406-af96-1407e807fa7e\",\n          \"name\": \"ServiceLB -&gt; Service\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.servicelb\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.service\",\n          \"tags\": [\n            \"Load balancer to target\",\n            \"tcp\",\n            \"80\",\n            \"80\",\n            \"Load balancer to target\",\n            \"tcp\",\n            \"80\",\n            \"80\"\n          ]\n        },\n        {\n          \"id\": \"8656b4a0-0fdf-4fc8-8207-888388a0a2a1\",\n          \"name\": \"Canary -&gt; ServiceLB\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet1.canary\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.servicelb\",\n          \"tags\": [\n            \"from ECSFargateGoCanaryStackCanarySecurityGroup:443\",\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"24b32b34-d8df-44eb-bf06-5bafdad9c3a7\",\n          \"name\": \"Canary -&gt; ServiceLB\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet2.canary\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.servicelb\",\n          \"tags\": [\n            \"from ECSFargateGoCanaryStackCanarySecurityGroup:443\",\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"d0a14b14-c7af-4f2f-8a09-7d20924b85a2\",\n          \"name\": \"ServiceLB -&gt; Service\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.servicelb\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1.service\",\n          \"tags\": [\n            \"Load balancer to target\",\n            \"tcp\",\n            \"80\",\n            \"80\",\n            \"Load balancer to target\",\n            \"tcp\",\n            \"80\",\n            \"80\"\n          ]\n        },\n        {\n          \"id\": \"a4bb6f9e-91ca-4314-9fab-04aa434c4099\",\n          \"name\": \"ServiceLB -&gt; Service\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.servicelb\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.service\",\n          \"tags\": [\n            \"Load balancer to target\",\n            \"tcp\",\n            \"80\",\n            \"80\",\n            \"Load balancer to target\",\n            \"tcp\",\n            \"80\",\n            \"80\"\n          ]\n        },\n        {\n          \"id\": \"db637226-95ad-410d-b482-8e2fa8c5cbff\",\n          \"name\": \"Canary -&gt; ServiceLB\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet1.canary\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.servicelb\",\n          \"tags\": [\n            \"from ECSFargateGoCanaryStackCanarySecurityGroup:443\",\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        },\n        {\n          \"id\": \"73da31ec-24b5-48d2-8366-269b08d08ab6\",\n          \"name\": \"Canary -&gt; ServiceLB\",\n          \"source\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.publicsubnet2.canary\",\n          \"destination\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet2.servicelb\",\n          \"tags\": [\n            \"from ECSFargateGoCanaryStackCanarySecurityGroup:443\",\n            \"tcp\",\n            \"443\",\n            \"443\"\n          ]\n        }\n      ]\n}\n</code></pre> <p></p> Visio project example OTM fileGenerated project <pre><code>{\n  \"otmVersion\": \"0.1.0\",\n  \"project\": {\n    \"name\": \"Aws with tz and vpt\",\n    \"id\": \"vs-aws-tz-vpc\"\n  },\n  \"representations\": [\n    {\n      \"name\": \"Visio\",\n      \"id\": \"Visio\",\n      \"type\": \"diagram\",\n      \"size\": {\n        \"width\": 1000,\n        \"height\": 1000\n      }\n    }\n  ],\n  \"trustZones\": [\n    {\n      \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n      \"name\": \"Public Cloud\",\n      \"risk\": {\n        \"trustRating\": 10\n      }\n    },\n    {\n      \"id\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\",\n      \"name\": \"Private Secured\",\n      \"risk\": {\n        \"trustRating\": 10\n      }\n    }\n  ],\n  \"components\": [\n    {\n      \"id\": \"1\",\n      \"name\": \"Amazon EC2\",\n      \"type\": \"ec2\",\n      \"parent\": {\n        \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n      }\n    },\n    {\n      \"id\": \"12\",\n      \"name\": \"Custom machine\",\n      \"type\": \"ec2\",\n      \"parent\": {\n        \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n      }\n    },\n    {\n      \"id\": \"30\",\n      \"name\": \"Private Database\",\n      \"type\": \"rds\",\n      \"parent\": {\n        \"trustZone\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\"\n      }\n    },\n    {\n      \"id\": \"35\",\n      \"name\": \"Amazon CloudWatch\",\n      \"type\": \"cloudwatch\",\n      \"parent\": {\n        \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n      }\n    },\n    {\n      \"id\": \"41\",\n      \"name\": \"Custom log system\",\n      \"type\": \"cloudwatch\",\n      \"parent\": {\n        \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n      }\n    }\n  ],\n  \"dataflows\": [\n    {\n      \"id\": \"17\",\n      \"name\": \"6ead9f3e-fa04-4b61-b7ba-523aaf27ef7f\",\n      \"source\": \"1\",\n      \"destination\": \"12\"\n    },\n    {\n      \"id\": \"34\",\n      \"name\": \"64bbe075-4999-423c-b40a-653c86493ee5\",\n      \"source\": \"12\",\n      \"destination\": \"30\"\n    },\n    {\n      \"id\": \"40\",\n      \"name\": \"682fd394-5b8c-44d2-840b-fec8da18126f\",\n      \"source\": \"1\",\n      \"destination\": \"35\"\n    },\n    {\n      \"id\": \"46\",\n      \"name\": \"c6d711f1-c867-44c0-a022-89a8babebbe3\",\n      \"source\": \"12\",\n      \"destination\": \"41\"\n    }\n  ]\n}\n</code></pre> <p></p> Terraform project example OTM fileGenerated project <pre><code>{\n  \"otmVersion\": \"0.1.0\",\n  \"project\": {\n    \"name\": \"Terraform ELB example\",\n    \"id\": \"tf-elb-ex\"\n  },\n  \"representations\": [\n    {\n      \"name\": \"Terraform\",\n      \"id\": \"Terraform\",\n      \"type\": \"code\"\n    }\n  ],\n  \"trustZones\": [\n    {\n      \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n      \"name\": \"Public Cloud\",\n      \"risk\": {\n        \"trustRating\": 10\n      }\n    }\n  ],\n  \"components\": [\n    {\n      \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_vpc-foo\",\n      \"name\": \"foo\",\n      \"type\": \"vpc\",\n      \"parent\": {\n        \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n      },\n      \"tags\": [\n        \"aws_vpc\"\n      ]\n    },\n    {\n      \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_vpc-foo.aws_subnet-baz\",\n      \"name\": \"baz\",\n      \"type\": \"empty-component\",\n      \"parent\": {\n        \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_vpc-foo\"\n      },\n      \"tags\": [\n        \"aws_subnet\"\n      ]\n    },\n    {\n      \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_vpc-foo.aws_subnet-bar\",\n      \"name\": \"bar\",\n      \"type\": \"empty-component\",\n      \"parent\": {\n        \"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_vpc-foo\"\n      },\n      \"tags\": [\n        \"aws_subnet\"\n      ]\n    }\n  ],\n  \"dataflows\": []\n}\n</code></pre> <p></p> MTMT project example OTM fileGenerated project <pre><code>{\n    \"otmVersion\": \"0.1.0\",\n    \"project\": {\n        \"name\": \"mtmt_project_name\",\n        \"id\": \"mtmt_project_id\"\n    },\n    \"representations\": [\n        {\n            \"name\": \"Microsoft Threat Modeling Tool\",\n            \"id\": \"Microsoft Threat Modeling Tool\",\n            \"type\": \"threat-model\"\n        },\n        {\n            \"name\": \"mtmt_project_id Diagram Representation\",\n            \"id\": \"mtmt_project_id-diagram\",\n            \"type\": \"diagram\",\n            \"size\": {\n                \"width\": 2000,\n                \"height\": 2000\n            }\n        }\n    ],\n    \"trustZones\": [\n        {\n            \"id\": \"6376d53e-6461-412b-8e04-7b3fe2b397de\",\n            \"name\": \"Internet\",\n            \"risk\": {\n                \"trustRating\": 10\n            },\n            \"properties\": {\n                \"Name\": \"Internet\",\n                \"Dataflow Order\": \"0\"\n            },\n            \"representations\": [\n                {\n                    \"name\": \"Internet Representation\",\n                    \"id\": \"7537441a-1c03-48c0-b9c8-f82d5906c139-representation\",\n                    \"representation\": \"mtmt_project_id-diagram\",\n                    \"size\": {\n                        \"width\": 202,\n                        \"height\": 281\n                    },\n                    \"position\": {\n                        \"x\": 386,\n                        \"y\": 151\n                    }\n                }\n            ]\n        },\n        {\n            \"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n            \"name\": \"Public Cloud\",\n            \"risk\": {\n                \"trustRating\": 10\n            },\n            \"properties\": {\n                \"Name\": \"Public Cloud\",\n                \"Dataflow Order\": \"0\"\n            },\n            \"representations\": [\n                {\n                    \"name\": \"Public Cloud Representation\",\n                    \"id\": \"24cdf4da-ac7f-4a35-bab0-29256d4169bf-representation\",\n                    \"representation\": \"mtmt_project_id-diagram\",\n                    \"size\": {\n                        \"width\": 371,\n                        \"height\": 308\n                    },\n                    \"position\": {\n                        \"x\": 744,\n                        \"y\": 142\n                    }\n                }\n            ]\n        }\n    ],\n    \"components\": [\n        {\n            \"id\": \"53245f54-0656-4ede-a393-357aeaa2e20f\",\n            \"name\": \"Accounting PostgreSQL\",\n            \"type\": \"CD-MICROSOFT-AZURE-DB-POSTGRESQL\",\n            \"parent\": {\n                \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n            },\n            \"properties\": {\n                \"Name\": \"Accounting PostgreSQL\",\n                \"Out Of Scope\": \"false\",\n                \"Azure Postgres DB Firewall Settings\": \"Select\",\n                \"Azure Postgres DB TLS Enforced\": \"Select\"\n            },\n            \"representations\": [\n                {\n                    \"name\": \"Accounting PostgreSQL Representation\",\n                    \"id\": \"53245f54-0656-4ede-a393-357aeaa2e20f-representation\",\n                    \"representation\": \"mtmt_project_id-diagram\",\n                    \"size\": {\n                        \"width\": 100,\n                        \"height\": 100\n                    },\n                    \"position\": {\n                        \"x\": 231,\n                        \"y\": 40\n                    }\n                }\n            ],\n            \"threats\": [\n                {\n                    \"threat\": \"55\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"55\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"1\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"1\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"2\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"2\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                }\n            ]\n        },\n        {\n            \"id\": \"6183b7fa-eba5-4bf8-a0af-c3e30d144a10\",\n            \"name\": \"Mobile Client\",\n            \"type\": \"android-device-client\",\n            \"parent\": {\n                \"trustZone\": \"6376d53e-6461-412b-8e04-7b3fe2b397de\"\n            },\n            \"properties\": {\n                \"Name\": \"Mobile Client\",\n                \"Out Of Scope\": \"false\",\n                \"Mobile Client Technologies\": \"Android\"\n            },\n            \"representations\": [\n                {\n                    \"name\": \"Mobile Client Representation\",\n                    \"id\": \"6183b7fa-eba5-4bf8-a0af-c3e30d144a10-representation\",\n                    \"representation\": \"mtmt_project_id-diagram\",\n                    \"size\": {\n                        \"width\": 100,\n                        \"height\": 100\n                    },\n                    \"position\": {\n                        \"x\": 47,\n                        \"y\": 89\n                    }\n                }\n            ],\n            \"threats\": [\n                {\n                    \"threat\": \"69\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"69\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"68\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"68\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                }\n            ]\n        },\n        {\n            \"id\": \"5d15323e-3729-4694-87b1-181c90af5045\",\n            \"name\": \"Public API v2\",\n            \"type\": \"web-service\",\n            \"parent\": {\n                \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n            },\n            \"properties\": {\n                \"Name\": \"Public API v2\",\n                \"Out Of Scope\": \"false\",\n                \"Web API Technologies\": \"Select\",\n                \"Hosting environment\": \"Select\",\n                \"Identity Provider\": \"Select\"\n            },\n            \"representations\": [\n                {\n                    \"name\": \"Public API v2 Representation\",\n                    \"id\": \"5d15323e-3729-4694-87b1-181c90af5045-representation\",\n                    \"representation\": \"mtmt_project_id-diagram\",\n                    \"size\": {\n                        \"width\": 100,\n                        \"height\": 100\n                    },\n                    \"position\": {\n                        \"x\": 21,\n                        \"y\": 101\n                    }\n                }\n            ],\n            \"threats\": [\n                {\n                    \"threat\": \"3\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"3\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"4\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"4\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"5\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"5\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"6\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"6\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"7\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"7\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"8\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"8\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"9\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"9\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"10\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"10\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"62\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"62\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"61\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"61\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"60\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"60\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"59\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"59\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"58\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"58\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"57\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"57\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"56\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"56\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"25\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"25\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"26\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"26\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"28\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"28\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"29\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"29\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"30\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"30\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"31\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"31\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"32\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"32\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"33\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"33\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"35\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"35\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"36\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"36\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"37\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"37\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"38\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"38\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"39\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"39\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"67\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"67\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"66\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"66\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"63\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"63\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                }\n            ]\n        },\n        {\n            \"id\": \"91882aca-8249-49a7-96f0-164b68411b48\",\n            \"name\": \"Azure File Storage\",\n            \"type\": \"azure-storage\",\n            \"parent\": {\n                \"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n            },\n            \"properties\": {\n                \"Name\": \"Azure File Storage\",\n                \"Out Of Scope\": \"false\",\n                \"Storage Type\": \"Select\",\n                \"HTTPS Enforced\": \"Select\",\n                \"Network Security\": \"Select\",\n                \"CORS Enabled\": \"Select\"\n            },\n            \"representations\": [\n                {\n                    \"name\": \"Azure File Storage Representation\",\n                    \"id\": \"91882aca-8249-49a7-96f0-164b68411b48-representation\",\n                    \"representation\": \"mtmt_project_id-diagram\",\n                    \"size\": {\n                        \"width\": 100,\n                        \"height\": 100\n                    },\n                    \"position\": {\n                        \"x\": 230,\n                        \"y\": 169\n                    }\n                }\n            ],\n            \"threats\": [\n                {\n                    \"threat\": \"11\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"11\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"12\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"12\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"13\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"13\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"14\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"14\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"15\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"15\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"16\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"16\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                },\n                {\n                    \"threat\": \"17\",\n                    \"state\": \"AutoGenerated\",\n                    \"mitigations\": [\n                        {\n                            \"mitigation\": \"17\",\n                            \"state\": \"RECOMMENDED\"\n                        }\n                    ]\n                }\n            ]\n        }\n    ],\n    \"dataflows\": [\n        {\n            \"id\": \"eb072144-af37-4b75-b46b-b78111850d3e\",\n            \"name\": \"PSQL Request\",\n            \"source\": \"5d15323e-3729-4694-87b1-181c90af5045\",\n            \"destination\": \"53245f54-0656-4ede-a393-357aeaa2e20f\",\n            \"bidirectional\": false,\n            \"properties\": {\n                \"Request\": {},\n                \"Name\": \"PSQL Request\",\n                \"Dataflow Order\": \"0\",\n                \"Out Of Scope\": \"false\",\n                \"Reason For Out Of Scope\": {},\n                \"Configurable Attributes\": {},\n                \"As Generic Data Flow\": {},\n                \"Show Boundary Threats\": \"Select\"\n            }\n        },\n        {\n            \"id\": \"36091fd8-dba8-424e-a3cd-784ea6bcb9e0\",\n            \"name\": \"PSQL Response\",\n            \"source\": \"53245f54-0656-4ede-a393-357aeaa2e20f\",\n            \"destination\": \"5d15323e-3729-4694-87b1-181c90af5045\",\n            \"bidirectional\": false,\n            \"properties\": {\n                \"Response\": {},\n                \"Name\": \"PSQL Response\",\n                \"Dataflow Order\": \"0\",\n                \"Out Of Scope\": \"false\",\n                \"Reason For Out Of Scope\": {},\n                \"Configurable Attributes\": {},\n                \"As Generic Data Flow\": {},\n                \"Show Boundary Threats\": \"Select\"\n            }\n        },\n        {\n            \"id\": \"f5fe3c6e-e10b-4252-a4aa-4ec6108c96a6\",\n            \"name\": \"File Request\",\n            \"source\": \"5d15323e-3729-4694-87b1-181c90af5045\",\n            \"destination\": \"91882aca-8249-49a7-96f0-164b68411b48\",\n            \"bidirectional\": false,\n            \"properties\": {\n                \"Request\": {},\n                \"Name\": \"File Request\",\n                \"Dataflow Order\": \"0\",\n                \"Out Of Scope\": \"false\",\n                \"Reason For Out Of Scope\": {},\n                \"Configurable Attributes\": {},\n                \"As Generic Data Flow\": {},\n                \"Show Boundary Threats\": \"Select\"\n            }\n        },\n        {\n            \"id\": \"d826de3d-1464-4d1f-8105-aa0449a50aec\",\n            \"name\": \"File Response\",\n            \"source\": \"91882aca-8249-49a7-96f0-164b68411b48\",\n            \"destination\": \"5d15323e-3729-4694-87b1-181c90af5045\",\n            \"bidirectional\": false,\n            \"properties\": {\n                \"Response\": {},\n                \"Name\": \"File Response\",\n                \"Dataflow Order\": \"0\",\n                \"Out Of Scope\": \"false\",\n                \"Reason For Out Of Scope\": {},\n                \"Configurable Attributes\": {},\n                \"As Generic Data Flow\": {},\n                \"Show Boundary Threats\": \"Select\"\n            }\n        },\n        {\n            \"id\": \"9840bcdf-c444-437d-8289-d5468f41b0db\",\n            \"name\": \"API Request\",\n            \"source\": \"6183b7fa-eba5-4bf8-a0af-c3e30d144a10\",\n            \"destination\": \"5d15323e-3729-4694-87b1-181c90af5045\",\n            \"bidirectional\": false,\n            \"properties\": {\n                \"Request\": {},\n                \"Name\": \"API Request\",\n                \"Dataflow Order\": \"0\",\n                \"Out Of Scope\": \"false\",\n                \"Reason For Out Of Scope\": {},\n                \"Configurable Attributes\": {},\n                \"As Generic Data Flow\": {},\n                \"Show Boundary Threats\": \"Select\"\n            }\n        },\n        {\n            \"id\": \"5861370d-b333-4d4b-9420-95425026e9c9\",\n            \"name\": \"API Response\",\n            \"source\": \"5d15323e-3729-4694-87b1-181c90af5045\",\n            \"destination\": \"6183b7fa-eba5-4bf8-a0af-c3e30d144a10\",\n            \"bidirectional\": false,\n            \"properties\": {\n                \"Response\": {},\n                \"Name\": \"API Response\",\n                \"Dataflow Order\": \"0\",\n                \"Out Of Scope\": \"false\",\n                \"Reason For Out Of Scope\": {},\n                \"Configurable Attributes\": {},\n                \"As Generic Data Flow\": {},\n                \"Show Boundary Threats\": \"Select\"\n            }\n        }\n    ],\n    \"threats\": [\n        {\n            \"name\": \"An adversary can gain unauthorized access to Azure Postgres DB instances due to weak network security configuration\",\n            \"id\": \"55\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain unauthorized access to  Accounting PostgreSQL instances due to weak network security configuration\"\n        },\n        {\n            \"name\": \"An adversary may read and/or tamper with the data transmitted to Azure Postgres DB due to weak configuration\",\n            \"id\": \"1\",\n            \"categories\": [\n                \"Tampering\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may read and/or tamper with the data transmitted to Accounting PostgreSQL due to weak configuration\"\n        },\n        {\n            \"name\": \"An adversary can gain long term, persistent access to an Azure Postgres DB instance through the compromise of local user account password(s)\",\n            \"id\": \"2\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain long term, persistent access to Accounting PostgreSQL instance through the compromise of local user account password(s)\"\n        },\n        {\n            \"name\": \"An adversary may gain unauthorized access to Web API due to poor access control checks\",\n            \"id\": \"3\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may gain unauthorized access to Web API due to poor access control checks\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive information from an API through error messages\",\n            \"id\": \"4\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to sensitive data such as the following, through verbose error messages - Server names - Connection strings - Usernames - Passwords - SQL procedures - Details of dynamic SQL failures - Stack trace and lines of code - Variables stored in memory - Drive and folder locations - Application install points - Host configuration settings - Other internal application details\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data by sniffing traffic to Web API\",\n            \"id\": \"5\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to sensitive data by sniffing traffic to Web API\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data stored in Web API's config files\",\n            \"id\": \"6\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to the config files. and if sensitive data is stored in it, it would be compromised\"\n        },\n        {\n            \"name\": \"Attacker can deny a malicious act on an API leading to repudiation issues\",\n            \"id\": \"7\",\n            \"categories\": [\n                \"Repudiation\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"Attacker can deny a malicious act on an API leading to repudiation issues\"\n        },\n        {\n            \"name\": \"An adversary may spoof Accounting PostgreSQL and gain access to Web API\",\n            \"id\": \"8\",\n            \"categories\": [\n                \"Spoofing\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"If proper authentication is not in place, an adversary can spoof a source process or external entity and gain unauthorized access to the Web Application\"\n        },\n        {\n            \"name\": \"An adversary may inject malicious inputs into an API and affect downstream processes\",\n            \"id\": \"9\",\n            \"categories\": [\n                \"Tampering\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may inject malicious inputs into an API and affect downstream processes\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data by performing SQL injection through Web API\",\n            \"id\": \"10\",\n            \"categories\": [\n                \"Tampering\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"SQL injection is an attack in which malicious code is inserted into strings that are later passed to an instance of SQL Server for parsing and execution. The primary form of SQL injection consists of direct insertion of code into user-input variables that are concatenated with SQL commands and executed. A less direct attack injects malicious code into strings that are destined for storage in a table or as metadata. When the stored strings are subsequently concatenated into a dynamic SQL command, the malicious code is executed\"\n        },\n        {\n            \"name\": \"An adversary can gain unauthorized access to Azure File Storage due to weak access control restrictions\",\n            \"id\": \"11\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain unauthorized access to Azure File Storage due to weak access control restrictions\"\n        },\n        {\n            \"name\": \"An adversary can gain unauthorized access to Azure File Storage instances due to weak network configuration\",\n            \"id\": \"12\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain unauthorized access to Azure File Storage instances due to weak network configuration\"\n        },\n        {\n            \"name\": \"An adversary may gain unauthorized access to Azure File Storage account in a subscription\",\n            \"id\": \"13\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may gain unauthorized access to Azure File Storage account in a subscription\"\n        },\n        {\n            \"name\": \"An adversary can abuse poorly managed Azure File Storage account access keys\",\n            \"id\": \"14\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can abuse poorly managed Azure File Storage account access keys and gain unauthorized access to storage\"\n        },\n        {\n            \"name\": \"An adversary can abuse an insecure communication channel between a client and Azure File Storage\",\n            \"id\": \"15\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can abuse an insecure communication channel between a client and Azure File Storage\"\n        },\n        {\n            \"name\": \"An adversary can deny actions on Azure File Storage due to lack of auditing\",\n            \"id\": \"16\",\n            \"categories\": [\n                \"Repudiation\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"Proper logging of all security events and user actions builds traceability in a system and denies any possible repudiation issues. In the absence of proper auditing and logging controls, it would become impossible to implement any accountability in a system\"\n        },\n        {\n            \"name\": \"An adversary can gain unauthorized access to Azure File Storage due to weak CORS configuration\",\n            \"id\": \"17\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain unauthorized access to Azure File Storage due to weak CORS configuration\"\n        },\n        {\n            \"name\": \"An adversary may inject malicious inputs into an API and affect downstream processes\",\n            \"id\": \"62\",\n            \"categories\": [\n                \"Tampering\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may inject malicious inputs into an API and affect downstream processes\"\n        },\n        {\n            \"name\": \"An adversary may spoof Azure File Storage and gain access to Web API\",\n            \"id\": \"61\",\n            \"categories\": [\n                \"Spoofing\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"If proper authentication is not in place, an adversary can spoof a source process or external entity and gain unauthorized access to the Web Application\"\n        },\n        {\n            \"name\": \"Attacker can deny a malicious act on an API leading to repudiation issues\",\n            \"id\": \"60\",\n            \"categories\": [\n                \"Repudiation\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"Attacker can deny a malicious act on an API leading to repudiation issues\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data stored in Web API's config files\",\n            \"id\": \"59\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to the config files. and if sensitive data is stored in it, it would be compromised\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data by sniffing traffic to Web API\",\n            \"id\": \"58\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to sensitive data by sniffing traffic to Web API\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive information from an API through error messages\",\n            \"id\": \"57\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to sensitive data such as the following, through verbose error messages - Server names - Connection strings - Usernames - Passwords - SQL procedures - Details of dynamic SQL failures - Stack trace and lines of code - Variables stored in memory - Drive and folder locations - Application install points - Host configuration settings - Other internal application details\"\n        },\n        {\n            \"name\": \"An adversary may gain unauthorized access to Web API due to poor access control checks\",\n            \"id\": \"56\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may gain unauthorized access to Web API due to poor access control checks\"\n        },\n        {\n            \"name\": \"An adversary may jail break into a mobile device and gain elevated privileges\",\n            \"id\": \"25\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may jail break into a mobile device and gain elevated privileges\"\n        },\n        {\n            \"name\": \"An adversary may gain unauthorized access to Web API due to poor access control checks\",\n            \"id\": \"26\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may gain unauthorized access to Web API due to poor access control checks\"\n        },\n        {\n            \"name\": \"An adversary may spoof an Azure administrator and gain access to Azure subscription portal\",\n            \"id\": \"69\",\n            \"categories\": [\n                \"Spoofing\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may spoof an Azure administrator and gain access to Azure subscription portal if the administrator's credentials are compromised\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive information from an API through error messages\",\n            \"id\": \"28\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to sensitive data such as the following, through verbose error messages - Server names - Connection strings - Usernames - Passwords - SQL procedures - Details of dynamic SQL failures - Stack trace and lines of code - Variables stored in memory - Drive and folder locations - Application install points - Host configuration settings - Other internal application details\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data by sniffing traffic from Mobile client\",\n            \"id\": \"29\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to sensitive data by sniffing traffic from Mobile client\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data by sniffing traffic to Web API\",\n            \"id\": \"30\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to sensitive data by sniffing traffic to Web API\"\n        },\n        {\n            \"name\": \"An adversary can gain sensitive data from mobile device\",\n            \"id\": \"31\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"If application saves sensitive PII or HBI data on phone SD card or local storage, then it ay get stolen\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data stored in Web API's config files\",\n            \"id\": \"32\",\n            \"categories\": [\n                \"Information Disclosure\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain access to the config files. and if sensitive data is stored in it, it would be compromised\"\n        },\n        {\n            \"name\": \"Attacker can deny a malicious act on an API leading to repudiation issues\",\n            \"id\": \"33\",\n            \"categories\": [\n                \"Repudiation\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"Attacker can deny a malicious act on an API leading to repudiation issues\"\n        },\n        {\n            \"name\": \"An adversary can gain unauthorized access to resources in an Azure subscription\",\n            \"id\": \"68\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain unauthorized access to resources in Azure subscription. The adversary can be either a disgruntled internal user, or someone who has stolen the credentials of an Azure subscription\"\n        },\n        {\n            \"name\": \"An adversary obtains refresh or access tokens from Mobile Client and uses them to obtain access to the Public API v2 API\",\n            \"id\": \"35\",\n            \"categories\": [\n                \"Spoofing\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"On a public client (e.g. a mobile device), refresh tokens may be stolen and used by an attacker to obtain access to the API. Depending on the client type, there are different ways that tokens may be revealed to an attacker and therefore different ways to protect them, some involving how the software using the tokens requests, stores and refreshes them\"\n        },\n        {\n            \"name\": \"An adversary may spoof Mobile Client and gain access to Web API\",\n            \"id\": \"36\",\n            \"categories\": [\n                \"Spoofing\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"If proper authentication is not in place, an adversary can spoof a source process or external entity and gain unauthorized access to the Web Application\"\n        },\n        {\n            \"name\": \"An adversary may inject malicious inputs into an API and affect downstream processes\",\n            \"id\": \"37\",\n            \"categories\": [\n                \"Tampering\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may inject malicious inputs into an API and affect downstream processes\"\n        },\n        {\n            \"name\": \"An adversary can reverse engineer and tamper binaries\",\n            \"id\": \"38\",\n            \"categories\": [\n                \"Tampering\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can use various tools, reverse engineer binaries and abuse them by tampering\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data by performing SQL injection through Web API\",\n            \"id\": \"39\",\n            \"categories\": [\n                \"Tampering\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"SQL injection is an attack in which malicious code is inserted into strings that are later passed to an instance of SQL Server for parsing and execution. The primary form of SQL injection consists of direct insertion of code into user-input variables that are concatenated with SQL commands and executed. A less direct attack injects malicious code into strings that are destined for storage in a table or as metadata. When the stored strings are subsequently concatenated into a dynamic SQL command, the malicious code is executed\"\n        },\n        {\n            \"name\": \"An adversary may spoof an Azure administrator and gain access to Azure subscription portal\",\n            \"id\": \"67\",\n            \"categories\": [\n                \"Spoofing\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary may spoof an Azure administrator and gain access to Azure subscription portal if the administrator's credentials are compromised\"\n        },\n        {\n            \"name\": \"An adversary can gain unauthorized access to resources in an Azure subscription\",\n            \"id\": \"66\",\n            \"categories\": [\n                \"Elevation of Privileges\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"An adversary can gain unauthorized access to resources in Azure subscription. The adversary can be either a disgruntled internal user, or someone who has stolen the credentials of an Azure subscription\"\n        },\n        {\n            \"name\": \"An adversary can gain access to sensitive data by performing SQL injection through Web API\",\n            \"id\": \"63\",\n            \"categories\": [\n                \"Tampering\"\n            ],\n            \"risk\": {\n                \"likelihood\": 100,\n                \"impact\": 100\n            },\n            \"description\": \"SQL injection is an attack in which malicious code is inserted into strings that are later passed to an instance of SQL Server for parsing and execution. The primary form of SQL injection consists of direct insertion of code into user-input variables that are concatenated with SQL commands and executed. A less direct attack injects malicious code into strings that are destined for storage in a table or as metadata. When the stored strings are subsequently concatenated into a dynamic SQL command, the malicious code is executed\"\n        }\n    ],\n    \"mitigations\": [\n        {\n            \"name\": \"Restrict access to Azure Postgres DB instances by configuring server-level firewall rules to only permit connections from selected IP addresses where possible\",\n            \"id\": \"55\",\n            \"riskReduction\": 100,\n            \"description\": \"Restrict access to Azure Postgres DB instances by configuring server-level firewall rules to only permit connections from selected IP addresses where possible. Refer: &lt;a href=\\\"https://aka.ms/tmt-th153\\\"&gt;https://aka.ms/tmt-th153&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Enforce communication between clients and Azure Postgres DB to be over SSL/TLS by enabling the Enforce SSL connection feature on the server\",\n            \"id\": \"1\",\n            \"riskReduction\": 100,\n            \"description\": \"Enforce communication between clients and Azure Postgres DB to be over SSL/TLS by enabling the Enforce SSL connection feature on the server. Check that the connection strings used to connect to MySQL databases have the right configuration (e.g. ssl = true or sslmode=require or sslmode=true are set). Refer: &lt;a href=\\\"https://aka.ms/tmt-th154a\\\"&gt;https://aka.ms/tmt-th154a&lt;/a&gt; Configure MySQL server to use a verifiable SSL certificate (needed for SSL/TLS communication). Refer: &lt;a href=\\\"https://aka.ms/tmt-th154b\\\"&gt;https://aka.ms/tmt-th154b&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"It is recommended to rotate user account passwords (e\",\n            \"id\": \"2\",\n            \"riskReduction\": 100,\n            \"description\": \"It is recommended to rotate user account passwords (e.g. those used in connection strings) regularly, in accordance with your organization's policies. Store secrets in a secret storage solution (e.g. Azure Key Vault)\"\n        },\n        {\n            \"name\": \"Implement proper authorization mechanism in ASP\",\n            \"id\": \"3\",\n            \"riskReduction\": 100,\n            \"description\": \"Implement proper authorization mechanism in ASP.NET Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtauthz#authz-aspnet\\\"&gt;https://aka.ms/tmtauthz#authz-aspnet&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that proper exception handling is done in ASP\",\n            \"id\": \"4\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that proper exception handling is done in ASP.NET Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtxmgmt#exception\\\"&gt;https://aka.ms/tmtxmgmt#exception&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Force all traffic to Web APIs over HTTPS connection\",\n            \"id\": \"5\",\n            \"riskReduction\": 100,\n            \"description\": \"Force all traffic to Web APIs over HTTPS connection. Refer: &lt;a href=\\\"https://aka.ms/tmtcommsec#webapi-https\\\"&gt;https://aka.ms/tmtcommsec#webapi-https&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Encrypt sections of Web API's configuration files that contain sensitive data\",\n            \"id\": \"6\",\n            \"riskReduction\": 100,\n            \"description\": \"Encrypt sections of Web API's configuration files that contain sensitive data. Refer: &lt;a href=\\\"https://aka.ms/tmtconfigmgmt#config-sensitive\\\"&gt;https://aka.ms/tmtconfigmgmt#config-sensitive&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that auditing and logging is enforced on Web API\",\n            \"id\": \"7\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that auditing and logging is enforced on Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtauditlog#logging-web-api\\\"&gt;https://aka.ms/tmtauditlog#logging-web-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that standard authentication techniques are used to secure Web APIs\",\n            \"id\": \"8\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that standard authentication techniques are used to secure Web APIs. Refer: &lt;a href=\\\"https://aka.ms/tmtauthn#authn-secure-api\\\"&gt;https://aka.ms/tmtauthn#authn-secure-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that model validation is done on Web API methods\",\n            \"id\": \"9\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that model validation is done on Web API methods. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#validation-api\\\"&gt;https://aka.ms/tmtinputval#validation-api&lt;/a&gt;  Implement input validation on all string type parameters accepted by Web API methods. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#string-api\\\"&gt;https://aka.ms/tmtinputval#string-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that type-safe parameters are used in Web API for data access\",\n            \"id\": \"10\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that type-safe parameters are used in Web API for data access. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#typesafe-api\\\"&gt;https://aka.ms/tmtinputval#typesafe-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Grant limited access to objects in Azure Storage using SAS or SAP\",\n            \"id\": \"11\",\n            \"riskReduction\": 100,\n            \"description\": \"Grant limited access to objects in Azure Storage using SAS or SAP. It is recommended to scope SAS and SAP to permit only the necessary permissions over a short period of time. Refer: &lt;a href=\\\"https://aka.ms/tmt-th17a\\\"&gt;https://aka.ms/tmt-th17a&lt;/a&gt; and &lt;a href=\\\"https://aka.ms/tmt-th17b\\\"&gt;https://aka.ms/tmt-th17b&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"It is recommended to restrict access to Azure Storage instances to selected networks where possible\",\n            \"id\": \"12\",\n            \"riskReduction\": 100,\n            \"description\": \"It is recommended to restrict access to Azure Storage instances to selected networks where possible. &lt;a href=\\\"https://aka.ms/tmt-th140\\\"&gt;https://aka.ms/tmt-th140&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Assign the appropriate Role-Based Access Control (RBAC) role to users, groups and applications at the right scope for the Azure Storage instance\",\n            \"id\": \"13\",\n            \"riskReduction\": 100,\n            \"description\": \"Assign the appropriate Role-Based Access Control (RBAC) role to users, groups and applications at the right scope for the Azure Storage instance. Refer: &lt;a href=\\\"https://aka.ms/tmt-th67\\\"&gt;https://aka.ms/tmt-th67&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure secure management and storage of Azure storage access keys\",\n            \"id\": \"14\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure secure management and storage of Azure storage access keys. It is recommended to rotate storage access keys regularly, in accordance with organizational policies. Refer: &lt;a href=\\\"https://aka.ms/tmt-th63\\\"&gt;https://aka.ms/tmt-th63&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that communication to Azure Storage is over HTTPS\",\n            \"id\": \"15\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that communication to Azure Storage is over HTTPS. It is recommended to enable the secure transfer required option to force communication with Azure Storage to be over HTTPS.  Use Client-Side Encryption to store sensitive data in Azure Storage. Refer: &lt;a href=\\\"https://aka.ms/tmt-th65\\\"&gt;https://aka.ms/tmt-th65&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Use Azure Storage Analytics to audit access of Azure Storage\",\n            \"id\": \"16\",\n            \"riskReduction\": 100,\n            \"description\": \"Use Azure Storage Analytics to audit access of Azure Storage. If possible, audit the calls to the Azure Storage instance at the source of the call. Refer: &lt;a href=\\\"https://aka.ms/tmt-th20\\\"&gt;https://aka.ms/tmt-th20&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that only specific, trusted origins are allowed\",\n            \"id\": \"17\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that only specific, trusted origins are allowed. Refer: &lt;a href=\\\"https://aka.ms/tmt-th21\\\"&gt;https://aka.ms/tmt-th21&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that model validation is done on Web API methods\",\n            \"id\": \"62\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that model validation is done on Web API methods. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#validation-api\\\"&gt;https://aka.ms/tmtinputval#validation-api&lt;/a&gt;  Implement input validation on all string type parameters accepted by Web API methods. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#string-api\\\"&gt;https://aka.ms/tmtinputval#string-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that standard authentication techniques are used to secure Web APIs\",\n            \"id\": \"61\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that standard authentication techniques are used to secure Web APIs. Refer: &lt;a href=\\\"https://aka.ms/tmtauthn#authn-secure-api\\\"&gt;https://aka.ms/tmtauthn#authn-secure-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that auditing and logging is enforced on Web API\",\n            \"id\": \"60\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that auditing and logging is enforced on Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtauditlog#logging-web-api\\\"&gt;https://aka.ms/tmtauditlog#logging-web-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Encrypt sections of Web API's configuration files that contain sensitive data\",\n            \"id\": \"59\",\n            \"riskReduction\": 100,\n            \"description\": \"Encrypt sections of Web API's configuration files that contain sensitive data. Refer: &lt;a href=\\\"https://aka.ms/tmtconfigmgmt#config-sensitive\\\"&gt;https://aka.ms/tmtconfigmgmt#config-sensitive&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Force all traffic to Web APIs over HTTPS connection\",\n            \"id\": \"58\",\n            \"riskReduction\": 100,\n            \"description\": \"Force all traffic to Web APIs over HTTPS connection. Refer: &lt;a href=\\\"https://aka.ms/tmtcommsec#webapi-https\\\"&gt;https://aka.ms/tmtcommsec#webapi-https&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that proper exception handling is done in ASP\",\n            \"id\": \"57\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that proper exception handling is done in ASP.NET Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtxmgmt#exception\\\"&gt;https://aka.ms/tmtxmgmt#exception&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Implement proper authorization mechanism in ASP\",\n            \"id\": \"56\",\n            \"riskReduction\": 100,\n            \"description\": \"Implement proper authorization mechanism in ASP.NET Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtauthz#authz-aspnet\\\"&gt;https://aka.ms/tmtauthz#authz-aspnet&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Implement implicit jailbreak or rooting detection\",\n            \"id\": \"25\",\n            \"riskReduction\": 100,\n            \"description\": \"Implement implicit jailbreak or rooting detection. Refer: &lt;a href=\\\"https://aka.ms/tmtauthz#rooting-detection\\\"&gt;https://aka.ms/tmtauthz#rooting-detection&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Implement proper authorization mechanism in ASP\",\n            \"id\": \"26\",\n            \"riskReduction\": 100,\n            \"description\": \"Implement proper authorization mechanism in ASP.NET Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtauthz#authz-aspnet\\\"&gt;https://aka.ms/tmtauthz#authz-aspnet&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Enable fine-grained access management to Azure Subscription using RBAC\",\n            \"id\": \"69\",\n            \"riskReduction\": 100,\n            \"description\": \"Enable fine-grained access management to Azure Subscription using RBAC. Refer: &lt;a href=\\\"https://aka.ms/tmtauthz#grained-rbac\\\"&gt;https://aka.ms/tmtauthz#grained-rbac&lt;/a&gt;  Enable Azure Multi-Factor Authentication for Azure Administrators. Refer: &lt;a href=\\\"https://aka.ms/tmtauthn#multi-factor-azure-admin\\\"&gt;https://aka.ms/tmtauthn#multi-factor-azure-admin&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that proper exception handling is done in ASP\",\n            \"id\": \"28\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that proper exception handling is done in ASP.NET Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtxmgmt#exception\\\"&gt;https://aka.ms/tmtxmgmt#exception&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Implement Certificate Pinning\",\n            \"id\": \"29\",\n            \"riskReduction\": 100,\n            \"description\": \"Implement Certificate Pinning. Refer: &lt;a href=\\\"https://aka.ms/tmtcommsec#cert-pinning\\\"&gt;https://aka.ms/tmtcommsec#cert-pinning&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Force all traffic to Web APIs over HTTPS connection\",\n            \"id\": \"30\",\n            \"riskReduction\": 100,\n            \"description\": \"Force all traffic to Web APIs over HTTPS connection. Refer: &lt;a href=\\\"https://aka.ms/tmtcommsec#webapi-https\\\"&gt;https://aka.ms/tmtcommsec#webapi-https&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Encrypt sensitive or PII data written to phones local storage\",\n            \"id\": \"31\",\n            \"riskReduction\": 100,\n            \"description\": \"Encrypt sensitive or PII data written to phones local storage. Refer: &lt;a href=\\\"https://aka.ms/tmtdata#pii-phones\\\"&gt;https://aka.ms/tmtdata#pii-phones&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Encrypt sections of Web API's configuration files that contain sensitive data\",\n            \"id\": \"32\",\n            \"riskReduction\": 100,\n            \"description\": \"Encrypt sections of Web API's configuration files that contain sensitive data. Refer: &lt;a href=\\\"https://aka.ms/tmtconfigmgmt#config-sensitive\\\"&gt;https://aka.ms/tmtconfigmgmt#config-sensitive&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that auditing and logging is enforced on Web API\",\n            \"id\": \"33\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that auditing and logging is enforced on Web API. Refer: &lt;a href=\\\"https://aka.ms/tmtauditlog#logging-web-api\\\"&gt;https://aka.ms/tmtauditlog#logging-web-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Enable fine-grained access management to Azure Subscription using RBAC\",\n            \"id\": \"68\",\n            \"riskReduction\": 100,\n            \"description\": \"Enable fine-grained access management to Azure Subscription using RBAC. Refer: &lt;a href=\\\"https://aka.ms/tmtauthz#grained-rbac\\\"&gt;https://aka.ms/tmtauthz#grained-rbac&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Use ADAL libraries to manage token requests from OAuth2 clients to AAD (or on-premises AD)\",\n            \"id\": \"35\",\n            \"riskReduction\": 100,\n            \"description\": \"Use ADAL libraries to manage token requests from OAuth2 clients to AAD (or on-premises AD). Refer: &lt;a href=\\\"https://aka.ms/tmtauthn#adal-oauth2\\\"&gt;https://aka.ms/tmtauthn#adal-oauth2&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that standard authentication techniques are used to secure Web APIs\",\n            \"id\": \"36\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that standard authentication techniques are used to secure Web APIs. Refer: &lt;a href=\\\"https://aka.ms/tmtauthn#authn-secure-api\\\"&gt;https://aka.ms/tmtauthn#authn-secure-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that model validation is done on Web API methods\",\n            \"id\": \"37\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that model validation is done on Web API methods. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#validation-api\\\"&gt;https://aka.ms/tmtinputval#validation-api&lt;/a&gt;  Implement input validation on all string type parameters accepted by Web API methods. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#string-api\\\"&gt;https://aka.ms/tmtinputval#string-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Obfuscate generated binaries before distributing to end users\",\n            \"id\": \"38\",\n            \"riskReduction\": 100,\n            \"description\": \"Obfuscate generated binaries before distributing to end users. Refer: &lt;a href=\\\"https://aka.ms/tmtdata#binaries-end\\\"&gt;https://aka.ms/tmtdata#binaries-end&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that type-safe parameters are used in Web API for data access\",\n            \"id\": \"39\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that type-safe parameters are used in Web API for data access. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#typesafe-api\\\"&gt;https://aka.ms/tmtinputval#typesafe-api&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Enable fine-grained access management to Azure Subscription using RBAC\",\n            \"id\": \"67\",\n            \"riskReduction\": 100,\n            \"description\": \"Enable fine-grained access management to Azure Subscription using RBAC. Refer: &lt;a href=\\\"https://aka.ms/tmtauthz#grained-rbac\\\"&gt;https://aka.ms/tmtauthz#grained-rbac&lt;/a&gt;  Enable Azure Multi-Factor Authentication for Azure Administrators. Refer: &lt;a href=\\\"https://aka.ms/tmtauthn#multi-factor-azure-admin\\\"&gt;https://aka.ms/tmtauthn#multi-factor-azure-admin&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Enable fine-grained access management to Azure Subscription using RBAC\",\n            \"id\": \"66\",\n            \"riskReduction\": 100,\n            \"description\": \"Enable fine-grained access management to Azure Subscription using RBAC. Refer: &lt;a href=\\\"https://aka.ms/tmtauthz#grained-rbac\\\"&gt;https://aka.ms/tmtauthz#grained-rbac&lt;/a&gt;\"\n        },\n        {\n            \"name\": \"Ensure that type-safe parameters are used in Web API for data access\",\n            \"id\": \"63\",\n            \"riskReduction\": 100,\n            \"description\": \"Ensure that type-safe parameters are used in Web API for data access. Refer: &lt;a href=\\\"https://aka.ms/tmtinputval#typesafe-api\\\"&gt;https://aka.ms/tmtinputval#typesafe-api&lt;/a&gt;\"\n        }\n    ]\n}\n</code></pre> <p></p>"},{"location":"Open-Threat-Model-%28OTM%29/#open-threat-model-parsing","title":"Open Threat Model parsing","text":""},{"location":"Open-Threat-Model-%28OTM%29/#how-to-create-a-new-startleft-processor","title":"How to create a new StartLeft Processor","text":"<p>It is possible to use StartLeft for parsing different formats to OTM, or even creating a new StartLeft Processor for formats that are not currently supported.</p> <p>There is an in depth tutorial explaining what is a StartLeft Processor and how to create one from scratch in the following link:</p> <p>Create a new StartLeft Processor</p> <p>Creating a StartLeft Processor allows you to focus on the parsing logic, while StartLeft takes care of building and validating  the OTM and exposing an API or CLI for ease of operation.</p> <p>How to create an OTM Parser without using StartLeft</p> <p>Although creating a new StartLeft Processor is the preferred method of supporting new formats, it is also possible to develop your own OTM parser. An example of how to create it is detailed in the following link:</p> <p>https://www.iriusrisk.com/resources-blog/how-to-create-an-open-threat-model-parser</p>"},{"location":"Quickstart-Guide-for-Beginners/","title":"Quickstart Guide for Beginners","text":"<p>The aim of this page is enabling you to get the StartLeft application installed in your machine so that you can execute some commands, set up the REST API and, in summary, familiarize yourself with the usage of the tool.</p>"},{"location":"Quickstart-Guide-for-Beginners/#prerequisites","title":"Prerequisites","text":"<ul> <li>Install the latest version of Python.</li> <li>Install pip3.</li> <li>Install git.</li> <li>Install graphviz and graphviz-dev.</li> </ul> <p>During this guide some files will be downloaded or generated, so you can optionally create a folder to keep them organized.</p> <p> Linux-based OS are recommended to run StartLeft</p> Extra requisites for Windows/OSX users <p>StartLeft uses python-magic  interface to the libmagic file type identification library for validating file types.</p> <p>Prerequisites for Windows</p> <p>\"You'll need DLLs for libmagic usage on Windows. @julian-r maintains a pypi package with the DLLs, you can fetch it with:\" <pre><code>pip install python-magic-bin\n</code></pre></p> <p>Prerequisites for OSX</p> <ul> <li>When using Homebrew: <code>brew install libmagic</code></li> <li>When using macports: <code>port install file</code></li> </ul>"},{"location":"Quickstart-Guide-for-Beginners/#install-startleft","title":"Install StartLeft","text":"<p>Install the last stable version of the tool using pip: <pre><code>pip install git+https://github.com/iriusrisk/startleft.git\n</code></pre></p> <p>Check your installation with the command: <pre><code>startleft --version\n</code></pre></p> <p>That should return something like: <pre><code>startleft, version &lt;your-installed-version&gt;\n</code></pre></p>"},{"location":"Quickstart-Guide-for-Beginners/#the-parse-command","title":"The parse command","text":"<p>The <code>parse</code> is the main command of the StartLeft CLI that enables you to perform the whole process of conversion to OTM by providing one or multiple source files and a mapping file. It presents slight variations depending on the type  of input source that you can check in the CLI section or in each specific processor  documentation, but, to get an idea of its behavior, you can perform a conversion from an IaC file:</p> <p>First of all, let's download one of the examples contained in the StartLeft's <code>examples/terraform</code> folder:</p> <pre><code>wget https://raw.githubusercontent.com/iriusrisk/startleft/main/examples/terraform/multinetwork_security_groups_with_lb.tf\n</code></pre> <p>This is a rich example where you can see in action some capabilities of StartLeft. It represents the Threat  Model for an architecture with two TrustZones and several VPCs which contain many types of AWS components.</p> <p>Now, we need to download the mapping file where the configuration for parsing this source is located. In this case,  we will download an example that maps to IriusRisk components. It is placed in the same <code>examples/terraform</code> folder:</p> <pre><code>wget https://raw.githubusercontent.com/iriusrisk/startleft/main/examples/terraform/iriusrisk-tf-aws-mapping.yaml\n</code></pre> <p>With this two files we are ready to execute the <code>parse</code> command in order to generate the Threat Model in OTM format: <pre><code>startleft parse \\\n--iac-type TERRAFORM \\\n--mapping-file iriusrisk-tf-aws-mapping.yaml \\\n--output-file multinetwork_security_groups_with_lb.otm \\\n--project-name \"Terraform MN Security Groups with LB\" \\\n--project-id \"tf-mn-sg-lb\" \\\nmultinetwork_security_groups_with_lb.tf\n</code></pre></p> <p>Finally, you can open the generated <code>multinetwork_security_groups_with_lb.otm</code> with your favourite text editor and check  how a Threat Model has been automatically generated from the Terraform file. </p>"},{"location":"Quickstart-Guide-for-Beginners/#the-server-command","title":"The server command","text":"<p>Using StartLeft as a service is the most useful strategy for integrate it with other tools. The different ways of  configuring this service are deeply described in the Quickstart guide for Integrations  and REST API sections. However, you can begin to familiarize yourself with this mode by setting up the server  through the CLI using the command: <pre><code>startleft server\n</code></pre> Then open a web browser, in http://localhost:5000/docs you will find a Swagger page with the documentation of the API. It is completely functional, so you can just send requests from there to get used to the tool. </p>"},{"location":"Quickstart-Guide-for-Beginners/#auxiliary-commands","title":"Auxiliary commands","text":"<p>In addition to <code>parse</code>, the CLI provides you with a group of utility commands that simplify a lot of the work with the  files involved in the OTM conversions performed by StartLeft.</p>"},{"location":"Quickstart-Guide-for-Beginners/#help","title":"help","text":"<p>Undoubtedly the most insightful command, it gives you information about everything you have available through the CLI.</p> <p>It can be used in general: <pre><code>startleft --help\n</code></pre> Or for specific commands: <pre><code>startleft parse --help\n</code></pre></p>"},{"location":"Quickstart-Guide-for-Beginners/#validate","title":"validate","text":"<p>This command is able to perform validations over several types of files:</p>"},{"location":"Quickstart-Guide-for-Beginners/#iac-mapping-files","title":"IaC mapping files","text":"<p>Described in depth in each processor's docs, they are used to create relationships between types in the source and their expected equivalent in the OTM (i.e: an <code>aws_instance</code> type in Terraform matches the <code>ec2</code> type in IriusRisk). If we take the same mapping file we have downloaded for the <code>parse</code> command, we can execute:</p> Terraform example <pre><code>startleft validate --mapping-file iriusrisk-tf-aws-mapping.yaml --mapping-type TERRAFORM\n</code></pre> Cloudformation example <pre><code>startleft validate --mapping-file iriusrisk-cft-mapping.yaml --mapping-type CLOUDFORMATION\n</code></pre>"},{"location":"Quickstart-Guide-for-Beginners/#diagram-mapping-files","title":"Diagram mapping files","text":"<p>Also described in the processors' documentation, allows you to validate the format of mapping files used for diagram conversions as Visio and Lucidchart. </p> <p>Let's download the IriusRisk's Visio mapping file located in the <code>examples/visio</code> folder: <pre><code>wget https://raw.githubusercontent.com/iriusrisk/startleft/main/examples/visio/iriusrisk-visio-aws-mapping.yaml\n</code></pre> Now we can validate it using the following StartLeft command:</p> Visio example <pre><code>startleft validate --mapping-file iriusrisk-visio-aws-mapping.yaml --mapping-type VISIO\n</code></pre> <p>You can also validate Lucidchart mapping files like it is shown in this example:</p> Lucidchart example <pre><code>startleft validate --mapping-file iriusrisk-lucid-aws-mapping.yaml --mapping-type LUCID\n</code></pre>"},{"location":"Quickstart-Guide-for-Beginners/#external-threat-model-mapping-files","title":"External Threat Model mapping files","text":"<p>The last type of mapping file we can validate is External Threat Model. This allows you to validate the format of mapping files used for External Threat Model conversions as MTMT (Microsoft Threat Modeling Tool):</p> MTMT example <pre><code>startleft validate --mapping-file mtmt_default_mapping_example.yaml --mapping-type MTMT\n</code></pre>"},{"location":"Quickstart-Guide-for-Beginners/#otm","title":"OTM","text":"<p>These files may have been generated by StartLeft or handcrafted by any user. To see how to validate  an OTM file, we can download an example from the <code>examples/manual</code> folder. <pre><code>wget https://raw.githubusercontent.com/iriusrisk/startleft/main/examples/manual/manual.otm\n</code></pre></p> <p>And then validate it by executing:</p> OTM example <pre><code>startleft validate --otm-file manual.otm\n</code></pre> Mapping file and otm validation <p>Notice that parameters <code>--mapping-file</code> and <code>--otm-file</code> are mutually exclusive, so we can only validate one file at once.</p>"},{"location":"Quickstart-Guide-for-Beginners/#search","title":"search","text":"<p>This is an auxiliary utility only supported currently for IaC mapping files. Due to the complexity of these files,  sometimes it is useful to test some expressions directly before including them in the final mapping file. </p> <p>For example, let's use the same Terraform file that we have downloaded for the <code>parse</code> command and perform a simple query:</p> <pre><code>startleft search \\\n--iac-type TERRAFORM \\\n--query \"resource|get(@, 'aws_synthetics_canary')\" \\\nmultinetwork_security_groups_with_lb.tf\n</code></pre>"},{"location":"Troubleshooting/","title":"Troubleshooting","text":"<p>This is a list of common pitfalls on using StartLeft, and how to avoid them.</p>","boost":3},{"location":"Troubleshooting/#importerror-failed-to-find-libmagic","title":"<code>ImportError: failed to find libmagic.</code>","text":"<p>When using Windows or OSX OS, there is the requirement to manually install the corresponding  python-magic  library as indicated in the prerequisites section.</p>","boost":3},{"location":"Troubleshooting/#glightbox-package-is-not-installed","title":"<code>\"glightbox\" package is not installed</code>","text":"<p>When trying to launch StartLeft documentation by <code>mkdocs serve</code> using IntelliJ, you may get an  error stating that the <code>glightbox</code> package is not installed. </p> <p>This requires re-running the <code>pip install -e \".[doc]\"</code>  command and restarting the IDE.</p>","boost":3},{"location":"Troubleshooting/#cannot-open-include-file-graphvizcgraphh","title":"<code>Cannot open include file: 'graphviz/cgraph.h'</code>","text":"<p>When using Windows, it is sometimes required to set up some extra configurations. </p> <p>Install Graphviz in your OS using the following command: <pre><code>choco install graphviz\n</code></pre></p> <p>Adding the Graphviz binaries to the PATH <pre><code>echo \"C:\\Program Files\\Graphviz\\bin\" &gt;&gt; $PATH\n</code></pre></p> <p>Installing the <code>pygraphviz</code> lib setting the OS files location: </p> <pre><code>pip install --global-option=build_ext --global-option=\"-IC:\\Program files\\Graphviz\\include\" --global-option=\"-LC:\\Program files\\Graphviz\\lib\" pygraphviz\n</code></pre>","boost":3},{"location":"Troubleshooting/#pygraphvizgraphviz_wrapc15411-fatal-error-pythonh-no-such-file-or-directory","title":"<code>pygraphviz/graphviz_wrap.c:154:11: fatal error: Python.h: No such file or directory</code>","text":"<p>Looks like you haven't properly installed the header files and static libraries for python dev.</p> <p>You need to add a PPA offered by the  \u201cdeadsnakes\u201d team to get the old archived Python versions easily.</p> <pre><code>sudo apt install software-properties-common\n</code></pre> <pre><code>sudo add-apt-repository ppa:deadsnakes/ppa\n</code></pre> <p>After you need to install the required library for your python dev version:</p> <pre><code>sudo apt install python3.x-dev\n</code></pre>","boost":3},{"location":"Versioning/","title":"Versioning","text":"<p> All StartLeft versions and their release notes can be found here.</p> <p>StartLeft uses Semantic Versioning as versioning strategy. To  summarize, the version is composed by three parts following this format:</p> <p><code>{major}.{minor}.{patch}</code> (i.e.: <code>1.5.0</code>)</p> <p>Where:</p> <ul> <li>The <code>{major}</code> part changes when there is a retro-compatibility breaking change.</li> <li>The <code>{minor}</code> part changes with each new release of the application.</li> <li>The <code>{patch}</code> part changes when a hotfix is delivered over the current release of the application.</li> </ul>"},{"location":"Versioning/#versions-management","title":"Versions management","text":"<p>StartLeft versions are managed through git tags. For each release, a new tag for that version is created along with its release notes.  During the installation, the latest version tag from  the current branch is retrieved. Thus, if you query the version through the CLI command or the REST API endpoint,  you will know what is the version of the StartLeft's code that is being executing.</p> Versions table <p>There are different types of branches in the StartLeft repository that correspond to different stages of the  software life cycle. If we suppose that the current version is <code>1.5.0</code>, that is, the last tag in the  release page is <code>1.5.0</code>, we should expect to get the following  version for each branch type:</p> branch description expected version example <code>main</code> Latest stable version <code>1.5.0</code> <code>hotfix/*</code> Urgent fixes over main version <code>1.5.1.dev1+ge7812ca</code> <code>release/1.6.0</code> Specific version release branch <code>1.6.0rc1</code> <code>bugfix/*</code> Fixes during a release process <code>1.6.0rc1.dev1+g6cda015</code> <code>dev</code> Features under development for the next version <code>1.7.0.dev19+g17d9f68</code> <code>feature/*</code> Specific developmnet ongoing <code>1.7.0.dev3+g52d796a</code>"},{"location":"Versioning/#getting-the-installed-version","title":"Getting the installed version","text":"<p>Once you have StartLeft installed, there are two ways of getting the version of  StartLeft you are executing.</p> <p>Through the CLI it is as simple as executing the command:</p> <pre><code>startleft --version\n</code></pre> <p>The REST API also exposes an endpoint for retrieving the version that can be invoked with this cURL command: <pre><code>curl http://localhost:5000/health\n</code></pre></p>"},{"location":"development/Architecture/","title":"Architecture","text":""},{"location":"development/Architecture/#context","title":"Context","text":"<p>StartLeft is a modularized application that groups a set of processors that are able to convert different formats to  OTM. It can be used through a CLI, and it also exposes a REST API. However, the  point of  access is indifferent as, under the hood, both make use of the same conversion logic, that is implemented in a special  type of modules called SLPs (StartLeft Processor), described below in this page.</p> <p>If we take as a reference the big picture of the usage that IriusRisk makes of StartLeft, it plays the role of a service  consumed by the IriusRisk core through the REST API. For instance, this is a general view of project importing in IriusRisk:</p> <p></p>"},{"location":"development/Architecture/#module-based-architecture","title":"Module Based Architecture","text":"<p>The internal architecture of the StartLeft application is based on a set of modules with well-defined responsibilities and dependencies.</p> <p></p> <p>The diagram above shows the different modules currently implemented in StartLeft. The main considerations about them are:</p> <p>All the dependencies are fixed and unidirectional and the project is configured to raise a \"compile time\" exception in case  some module tries to do a forbidden import.</p> <p>StartLeft does not directly import any specific processor, but relies on the configuration located in <code>_sl_build</code> and on  <code>slp_base</code> logic to choose the right implementation for each case. This means that new processors can be added without modifying  any preexisting module.</p> <p>The OTM does not have the <code>sl</code> or <code>slp</code> prefixes because it is intended to be released as a general lib for general definitions  and logic related with the standard that could be imported independently of StartLeft.</p>"},{"location":"development/Architecture/#repository-structure","title":"Repository Structure","text":"<p>All the modules are located just under the root folder in the StartLeft's repo and must also fit the following common structure:</p> <p></p> <p>Since a general Python standard for modularizing projects does not exist, the chosen one is based  on the one used by several Open Source projects as well as by the StartLeft project itself before the modularization. It is important  to notice that, with this structure, each module is being isolated as if it was an independent project. The goal of this is to  facilitate a future migration to independent repositories.</p>"},{"location":"development/Architecture/#module-structure","title":"Module Structure","text":"<p>Note: <code>_sl_build</code> is an internal module with configuration and building purposes that does not fit the structure explained below.</p> <p></p> <p>In the root package of each module, there are only two subpackages, and a resources folder. The first subpackage has the  same name as the module itself and contains the production code. The other one is called <code>tests</code> and contains specific  tests for that module. The resources folder contains the resources needed by each module, for example, the schemas used  for validating mapping files.</p> <p>The root folder of each module represents its main boundary and may be understood as the main project folder if the modules  where migrated to independent repositories. However, instead of being simply folders, they need to be  python regular packages  with their own <code>__init.py__</code> file, which is an important nuance to consider. This file contains, for each module, a call to a  function defined in the <code>_sl_build</code> packages that overrides the native python\u2019s import function with a custom one that avoids  forbidden imports between modules. In case new modules are added to StartLeft, this call must be added to their main package\u2019s  <code>__init.py__</code> file. <pre><code>######################################################################\n# This folder is not actually intended to be a regular package       #\n# HOWEVER, we need to keep this __init.py__ file in order to         #\n# make it visible by other modules.                                  #\n# In future versions, this package should be moved to a lib so       #\n# that it will be an independent module instead of a \"false\" package #\n######################################################################\n# DON'T REMOVE: Module importer overwritten to prevent bidirectional dependencies\nfrom _sl_build.secure_importer import override_module_importer\noverride_module_importer()\n</code></pre></p>"},{"location":"development/Architecture/#production-code-package","title":"Production Code Package","text":"<p>The name of this package must match the main package. This is the place where the actual business logic code of the module is located.  The structure inside it is completely free, and it depends only on the needs of the logic implemented in the module.</p>"},{"location":"development/Architecture/#test-code-package","title":"Test Code Package","text":"<p>As has been already stated along this document, each module is a completely independent piece of software. Of course,  this also includes that it must also contain its own test code. Since each module has specific responsibilities, these are  the only ones that need to be tested from both a unitary and integration perspective. For example, every SLP must  have unitary tests for the classes implemented there, but also integration tests that verifies that the whole conversion to  OTM process works for every identified casuistic.</p> <p>Regarding the structure of the whole test code package, there is no a hard constraint about it, but, for readability reasons,  it is recommended to follow a common one for every module. The one chosen is split in the following packages:</p> <p>Note: Please don\u2019t be fanatic with the definition of unitary and integration. There are not always clear boundaries,  but common sense is the best way to identify what needs to be mocked or not.</p> <ul> <li><code>unit</code>. For unitary tests.</li> <li><code>integration</code>. For integration tests.</li> <li><code>resources</code>. It is also recommended to place here a test_resource_paths.py to have a unique point of access to the actual testing resources.</li> <li><code>util</code>. In case some general utilities need to be developed for being used in the tests, this package is the right place for them.**</li> </ul>"},{"location":"development/Architecture/#main-tests-package","title":"Main Tests Package","text":"<p>Note:  It is necessary to evaluate the convenience to have this package, but, at least for now, it is important to keep  these tests to guarantee the quality of the code.</p> <p>At the root level of the StartLeft repository (the same as the other modules) a general tests package is located. Unlike  the test packages located inside each module, this one is generic to the entire the StartLeft project and contains integration tests  that involves logic belonging to all the modules. By definition, this package can only contain integration tests.  So, when a new processor or a new important behavior is added to StartLeft, we need to create their associated integration  tests at the project level in this package.</p>"},{"location":"development/Architecture/#modules-description","title":"Modules Description","text":""},{"location":"development/Architecture/#startleft","title":"startleft","text":"<p>This is the main module whose origin is the initial StartLeft project that used to contain all the processing logic for  the first conversion formats. As part of the modularization process, it was lightened so that it does no longer implements  any conversion logic, and it simply exposes the CLI and REST API and makes the connection with the SLPs where the conversion  itself takes place.</p> <p>Main responsibilities: Expose a CLI and a REST API to enable the access to the conversion to OTM logic.</p> <p>Imported by:  Not imported.</p> <p>Imports: <code>_sl_build</code>, <code>slp_base</code>, <code>sl_util</code>, <code>otm</code>. It also imports <code>slp_cft</code> and <code>slp_tf</code> to support the  search function, whose future is under evaluation.</p>"},{"location":"development/Architecture/#sl_util","title":"sl_util","text":"<p>This is currently the only module that contains common utilities for the rest of the modules of StartLeft. The <code>sl</code> prefix  means that it is not intended to be a very generic module like the Apache Commons in Java, but a module to place useful  functions for the StartLeft scope (including some OTM related utilities, for example). However, it is not a mixed bag to  place common logic related, for instance, with the SLPs. Business logic or domain classes should fit one of the other  modules or, if not, maybe a new one should be created.</p> <p>Main responsibilities: Offer general (not processor specific) utilities related to StartLeft.</p> <p>Imported by:  <code>startleft</code>, <code>slp_base</code>, SLPs, <code>otm</code>.</p> <p>Imports: No imports.</p>"},{"location":"development/Architecture/#slps","title":"SLPs","text":"<p>The StartLeft processors are the key modules of StartLeft. They contain the specific logic for converting each format to OTM.  Each one is focused on converting from one and only one input format (CFT, TF, Visio, etc.).  One important thing to notice is that the integration tests for these modules are the most important ones in the application  since they validate behavior for the main purpose and responsibility of StartLeft as a whole.</p>"},{"location":"development/Architecture/#slp_base","title":"slp_base","text":"<p>This is a critical module where the whole process of conversion is defined, including all the interfaces for each step of  the conversion process (from loading files to the OTM validation) as well as definition of the errors that the process may  potentially arise.</p> <p>Main responsibilities: </p> <ul> <li>Defining the main conversion process using a template pattern in the class <code>OTMProcessor</code>.</li> <li>Defining a set of interfaces for each step of the process (source and mapping files loading and validating, OTM conversion process and OTM validation) that must be implemented by the specific SLPs.</li> <li>Defining all the possible errors that may arise through the conversion process.</li> <li>Defining a <code>ProviderResolver</code> class to dynamically retrieve the right SLP based on the source type (CFT, TF, etc.).</li> </ul> <p>Imported by:  <code>startleft</code>, SLPs.</p> <p>Imports: <code>sl_util</code>, <code>otm</code>. </p>"},{"location":"development/Architecture/#concrete-implementations","title":"Concrete Implementations","text":"<p>Each supported provider (CFT, TF, etc.) must have its own processor in order to perform the OTM conversion. They are completely  independent modules and imports among them are forbidden. The goal is that they can be work in isolation so their evolution  is also completely independent. In case some duplication appears between two processors, the first option is to duplicate  the code instead of prematurely creating abstractions. Only after these duplications were consolidated, and we could identify  a really common casuistic, we may think about creating a common module grouping, for instance, logic related with one provider  type (IaC, diagram or threat modeling). Anyway, this common logic should be placed in a new dedicated module and never in  the <code>sl_util</code> module.</p> <p>Current implementations: </p> <ul> <li><code>slp_cft</code> for Cloudformation (IaC).</li> <li><code>slp_tf</code> for Terraform (IaC).</li> <li><code>slp_visio</code> for MS Visio (Diagram).</li> <li><code>slp_mtmt</code> for MS Threat Modeling Tool (Threat model).</li> </ul> <p>Main responsibilities: Implementing the interfaces defined in <code>slp_base</code> in order to actually perform the   conversion process from the origin provider formats to OTM.</p> <p>Imported by: No statically imported by any module. They are dynamically instanced by the <code>slp_base</code> based  on the module configuration placed in <code>_sl_build</code>.</p> <p>Imports: Each processor is an independent module that may import different modules. However, in general:</p> <ul> <li>Must import: <code>otm</code> and <code>slp_base</code>.</li> <li>May import: <code>sl_util</code>.</li> <li>Cannot import: <code>startleft</code>.</li> </ul>"},{"location":"development/Architecture/#otm","title":"otm","text":"<p>Currently, we have the only public release specifically focused on the OTM standard  here, that simply contains a <code>README.md</code> file with a  natural language description of the components of the standard. It would be interesting to extend the resources associated  with the standard and share them with the community (a JSON schema, some kind of validator, etc.). This module is intended  to be the seed for that public resources' library. This means that it has not to be understood as a part of StartLeft itself  (notice the absence of the <code>sl</code> prefix), but as a more generic library exclusively oriented to general OTM concerns.</p> <p>Main responsibilities: Defining a set of entities that represent the OTM standard as well as providing a  standard building to simplify the generation of OTM instances.</p> <p>Imported by: <code>startleft</code>, <code>slp_base</code>, SLPs.</p> <p>Imports: Currently, it imports <code>sl_util</code>, but, for the reasons explained above, it should not import any  StartLeft module.  Thus, we should be careful about creating new dependencies between these two modules.</p>"},{"location":"development/Architecture/#_sl_build","title":"_sl_build","text":"<p>This is a special module whose existence is due to the current structure of the project. Since the multimodule management  is not being done by any external tool (like Maven/Gradle in Java), it is necessary to develop some ad hoc features in order  to manage the interaction between modules. </p> <p>Main responsibilities:</p> <ul> <li>Defining the main configuration for the modules in a configuration class.</li> <li>Name of the module.</li> <li>Type of module (<code>general</code> or <code>processor</code>).</li> <li>Forbidden dependencies.</li> <li>Provider type supported by each SLP.</li> </ul> <p>Managing the imports between modules to raise an error when trying to import a forbidden dependency.</p> <p>Note: The imports for this module are not constrained as in the other ones because this is the module that manages  these constraints, so it is important to be careful with the imports that are performed here.</p> <p>Imported by: <code>startleft</code> to read configuration and for all the rest of the modules to override the import  system.</p> <p>Imports: No imports allowed.</p>"},{"location":"development/Architecture/#building","title":"Building","text":"<p>All the modules inside StartLeft are, at the end of the day, Python modules, so <code>pip</code> does not have any problem to install a  project based on them. For this reason, the installation of the StartLeft project can be simply done by executing this command  inside the StartLeft repository's root folder:</p> <pre><code>pip install .\n</code></pre> <p>About the entrypoints for the application, it is important to difference between the <code>startleft</code> whole project and the <code>startleft</code>  module inside it. This means that, to reference some class or module inside it, it is needed to put the name two times (<code>startleft.startleft</code>). For example, in the <code>docker-compose</code> command or the docker <code>ENTRYPOINT</code>, the FastAPI webapp entry point must be referenced in this way:</p>"},{"location":"development/Architecture/#testing","title":"Testing","text":"<p>As stated before in this document, each module is an independent software unit with their own tests set. This means that  the tests can only be executed module by module. In PyCharm, for example, a run configuration must be created for executing  the tests in each module:</p> <p></p> <p>For executing them from the terminal, <code>pytest</code> needs to know what is the module that is under testing: <pre><code>pytest slp_base\n</code></pre> It is also possible to execute tests for several modules at the same time: <pre><code>pytest slp_base otm startleft\n</code></pre> However, from the point of view of CI/CD, it is undesirable to include in the pipelines configuration the name of all  the modules that are required to be tested because this implies that every modification in the module structure or even  the addition of a new module will provoke the modification of all the pipelines. For this reason, a <code>run_tests.py</code> has been  created in the root of the StartLeft project. It contains the logic for retrieving all the modules in the application and calling pytest with all of them generating a unique report. So, the command that the pipelines must include for executing  the StartLeft\u2019s tests is: <pre><code>python run_tests.py\n</code></pre> From a development point of view, the most common scenario is that only the module under development is needed to be frequently tested.  However, there is no problem about executing all the tests on demand by creating a run configuration that runs that <code>run_tests.py</code> file in  PyCharm and execute all the tests.</p>"},{"location":"development/Create-a-new-StartLeft-Processor/","title":"Create a new StartLeft Processor (SLP)","text":"<p>As you can see in the architecture page StartLeft Processors (SLPs) are a special kind of  modules where the conversion into OTM logic is actually implemented. All of them are based on the same interfaces, defined in the  <code>slp_base</code> module. So, if you want to create a new SLP, you simply have to:</p> <ul> <li>Create your module extending <code>slp_base</code>.</li> <li>Implement the parsing logic in your module.</li> <li>Configure StartLeft to use your module.</li> </ul> <p>Below you have a guided tutorial for easily performing this steps and creating a new SLP for a very basic invented  input format that you can use as a base for building your own.</p>"},{"location":"development/Create-a-new-StartLeft-Processor/#defining-a-sample-input-format-for-demo-purposes","title":"Defining a sample input format (for demo purposes)","text":"<p>Note: The SLPs are classified in IaC, Diagram or External Threat Model (ETM). However, it is only a logical division and the instructions defined in this tutorial are valid for creating SLPs of any kind.</p> <p>To guide this tutorial, let's imagine a fictitious Infrastructure as Code format, that we will call My Awesome Infrastructure Source (MAIS). A sample file of this format could be something like: <pre><code>{\n\"resources\": [\n{\n\"id\": 1,\n\"name\": \"My Server\",\n\"type\": \"server\"\n}\n]\n}\n</code></pre></p> <p>We need to define a format for the mappings between the source file and OTM. An example of this mapping file could be:</p> <p>Note: Remind that the OTM standard forces each component to have a parent. This is the reason we include this default TrustZone for this example. <pre><code>trustZones:\n- id: public-cloud\nname: Public Cloud\ndefault: true\ncomponents:\n- source_type: server\notm_type: otm-server\n</code></pre></p> <p>So the resulting OTM for this example should be something like: <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"My Project\",\n\"id\": \"my-project\"\n},\n\"representations\": [\n{\n\"name\": \"My Awesome Infrastructure Source\",\n\"id\": \"My Awesome Infrastructure Source\",\n\"type\": \"code\"\n}\n],\n\"trustZones\": [\n{\n\"id\": \"public-cloud\",\n\"name\": \"Public Cloud\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n],\n\"components\": [\n{\n\"id\": \"1\",\n\"name\": \"My Server\",\n\"type\": \"otm-server\",\n\"parent\": {\n\"trustZone\": \"public-cloud\"\n}\n}\n],\n\"dataflows\": []\n}\n</code></pre></p>"},{"location":"development/Create-a-new-StartLeft-Processor/#understanding-the-slp_base-interfaces","title":"Understanding the <code>slp_base</code> interfaces","text":"<p>The <code>OTMProcessor</code> class inside the <code>slp_base</code> module defines the conversion process using a template method, whose behavior depends on the implementations of the rest of the interfaces in the module.</p> <p></p> <p>In order to implement our sample processor, we need to know the structure of the provided interfaces, which looks like this.</p> <p></p>"},{"location":"development/Create-a-new-StartLeft-Processor/#creating-the-module","title":"Creating the module","text":"<p>For this tutorial, we are going to create a new SLP for parsing My awesome input source (MAIS) files which is going to be called <code>slp_mais</code>. First, we need to set up our development environment as explained in the Quickstart Guide for Developers.</p>"},{"location":"development/Create-a-new-StartLeft-Processor/#build-the-module-structure","title":"Build the module structure","text":"<p>Note: Do not worry if at this point you get some errors from the IDE. We will create some required modules and classes later.</p> <p>Every module must have a common structure and minimum files to work. So let's start by creating them. </p> <ol> <li> <p>Create the module folder <code>slp_mais</code> under the root <code>startleft</code> repo folder:</p> </li> <li> <p>Override the module importer for the module (for preventing forbidden imports among modules) by creating a <code>slp_mais/__init__.py</code>  file with this content: <pre><code>######################################################################\n# This folder is not actually intended to be a regular package       #\n# HOWEVER, we need to keep this __init.py__ file in order to         #\n# make it visible by other modules.                                  #\n# In future versions, this package should be moved to a lib so       #\n# that it will be an independent module instead of a \"false\" package #\n######################################################################\n# DON'T REMOVE: Module importer overwritten to prevent bidirectional dependencies\nfrom _sl_build.secure_importer import override_module_importer\noverride_module_importer()\nfrom .slp_mais import *\n</code></pre></p> </li> <li> <p>Create the production code package, creating a folder <code>slp_mais/slp_mais</code> with an<code>__init__.py</code> file that exports   the processor we are going to create in the next steps: <pre><code>from .mais_processor import MAISProcessor\n</code></pre></p> </li> <li> <p>Create the test code module as a <code>slp_mais/tests</code> folder with an empty <code>__init__.py</code> inside it.</p> </li> <li> <p>Create packages for unit and integration tests:</p> <ul> <li><code>slp_mais/tests/unit</code> with an empty <code>__init__.py</code> file inside it.</li> <li><code>slp_mais/tests/integration</code> with an empty <code>__init__.py</code> file inside it.</li> </ul> </li> <li> <p>Create an empty <code>slp_mais/tests/resources</code> folder.</p> </li> </ol> <p>After following these steps, your module should like this:</p> <p></p>"},{"location":"development/Create-a-new-StartLeft-Processor/#add-the-mais-type-to-the-provider-types","title":"Add the MAIS type to the Provider types","text":"<p>Every source type supported by StartLeft must be included in the enums contained in <code>slp_base/slp_base/provider_type.py</code>.  As we have stated before, MAIS is a fictitious IaC source, so we will add it to the <code>IacType</code> enum. <pre><code>from otm.otm.provider import Provider\nclass IacType(str, Provider):\n# [...]\nMAIS = (\"MAIS\", \"My Awesome Infrastructure Source\", \"code\")\n</code></pre></p>"},{"location":"development/Create-a-new-StartLeft-Processor/#implement-slp_base-interfaces","title":"Implement <code>slp_base</code> interfaces","text":"<p>Note: In order to simplify this tutorial, we will not implement any validation nor process loading or processing errors, but, for  a real implementation, you must read the errors management page to know the errors you  should  raise in each stage of the conversion process.</p> <p>We already know the main structure of the conversion process, so we can create our own implementation classes in the production  code package (<code>slp_mais/slp_mais</code>).</p>"},{"location":"development/Create-a-new-StartLeft-Processor/#maisvalidator-providervalidator","title":"MAISValidator (ProviderValidator)","text":"<p>Create the <code>mais_validator.py</code> file with the <code>MAISValidator</code> class implementing <code>ProviderValidator</code>.  <pre><code>import logging\nfrom slp_base import ProviderValidator\nlogger = logging.getLogger(__name__)\nclass MAISValidator(ProviderValidator):\ndef __init__(self, mais_data):\nsuper(MAISValidator, self).__init__()\nself.mais_data = mais_data\ndef validate(self):\nlogger.info('Validating MAIS file')\n</code></pre></p>"},{"location":"development/Create-a-new-StartLeft-Processor/#maisloader-providerloader","title":"MAISLoader (ProviderLoader)","text":"<p>Create the <code>mais_loader.py</code> file with the <code>MAISLoader</code> class implementing <code>ProviderLoader</code>:</p> <pre><code>import json\nimport logging\nfrom slp_base.slp_base.provider_loader import ProviderLoader\nlogger = logging.getLogger(__name__)\nclass MAISLoader(ProviderLoader):\ndef __init__(self, mais_source):\nself.mais_source = mais_source\nself.mais = {}\ndef load(self):\nlogging.getLogger('Loading MAIS source...')\nself.mais = json.loads(self.mais_source)\ndef get_mais(self) -&gt; {}:\nreturn self.mais\n</code></pre>"},{"location":"development/Create-a-new-StartLeft-Processor/#maismappingvalidator-mappingvalidator","title":"MAISMappingValidator (MappingValidator)","text":"<p>Create the <code>mais_mapping_validator.py</code> file with the <code>MAISMappingValidator</code> class implementing <code>MappingValidator</code>: <pre><code>import logging\nfrom slp_base import MappingValidator\nlogger = logging.getLogger(__name__)\nclass MAISMappingValidator(MappingValidator):\ndef __init__(self, mais_mapping_file):\nself.mais_mapping_file = mais_mapping_file\ndef validate(self):\nlogger.info('Validating MAIS mapping file')\n</code></pre></p>"},{"location":"development/Create-a-new-StartLeft-Processor/#maismappingloader-maismappingloader","title":"MAISMappingLoader (MAISMappingLoader)","text":"<p>Create the <code>mais_mapping_loader.py</code> file with the <code>MAISMappingLoader</code> class implementing <code>MAISMappingLoader</code>:</p> <pre><code>import yaml\nimport logging\nfrom slp_base import MappingLoader\nlogger = logging.getLogger(__name__)\nclass MAISMappingLoader(MappingLoader):\ndef __init__(self, mapping_data: bytes):\nself.mapping_data = mapping_data\nself.mais_mapping = {}\ndef load(self):\nlogger.info(\"Loading MAIS mapping file...\")\nself.mais_mapping = yaml.load(self.mapping_data, Loader=yaml.SafeLoader)\ndef get_mais_mapping(self):\nreturn self.mais_mapping\n</code></pre>"},{"location":"development/Create-a-new-StartLeft-Processor/#maisparser-providerparser","title":"MAISParser (ProviderParser)","text":"<p>Create <code>mais_parser.py</code> file with the <code>MAISParser</code> class implementing <code>ProviderParser</code>. It will need to contain,    at least, the minimum information to parse the source and create the OTM, this is:</p> <ul> <li>The ID of the OTM project.</li> <li>The name of the OTM project.</li> <li>The MAIS source.</li> <li>The MAIS mappings.</li> </ul> <p>For this example, almost trivial logic for processing our imaginary format is included, but this is the class where you would need to actually implement your custom conversion process.</p> <pre><code>from otm.otm.entity.component import Component\nfrom otm.otm.entity.otm import OTM\nfrom otm.otm.entity.trustzone import Trustzone\nfrom otm.otm.otm_builder import OTMBuilder\nfrom slp_base.slp_base.provider_parser import ProviderParser\nfrom slp_base.slp_base.provider_type import IacType\nclass MAISParser(ProviderParser):\ndef __init__(self, project_id: str, project_name: str, source, mais_mapping):\nself.project_id = project_id\nself.project_name = project_name\nself.source = source\nself.mais_mapping = mais_mapping\ndef build_otm(self) -&gt; OTM:\nreturn OTMBuilder(self.project_id, self.project_name, IacType.MAIS)\n.add_components(self.__parse_components())\n.add_trustzones(self.__parse_trustzones())\n.build()\ndef __parse_trustzones(self) -&gt; [Trustzone]:\ndefault_trustzone = self.__get_default_trustzone()\nreturn [Trustzone(default_trustzone['id'], default_trustzone['name'])]\ndef __parse_components(self) -&gt; [Component]:\ncomponent_mappings = self.mais_mapping['components']\ntypes_mappings = dict(zip(\n[cm['source_type'] for cm in component_mappings],\ncomponent_mappings))\notm_components = []\nfor mais_component in self.source['resources']:\nsource_type = mais_component['type']\nif source_type not in types_mappings:\ncontinue\notm_components.append(Component(\nid=str(mais_component['id']),\nname=mais_component['name'],\ntype=types_mappings[source_type]['otm_type'],\nparent=self.__get_default_trustzone()['id'],\nparent_type='trustZone'\n))\nreturn otm_components\ndef __get_default_trustzone(self) -&gt; dict:\nreturn next(filter(lambda tz: 'default' in tz and tz['default'], self.mais_mapping['trustZones']))\n</code></pre>"},{"location":"development/Create-a-new-StartLeft-Processor/#maisprocessor-otmprocessor","title":"MAISProcessor (OTMProcessor)","text":"<p>Finally, we are going to create the main class, the <code>MAISProcessor</code>, in a <code>mais_processor.py</code> file for implementing the  <code>OTMProcessor</code> interface. This class must implement methods for retrieving instances of all the other classes created above:</p> <pre><code>from slp_base import MappingLoader, MappingValidator\nfrom slp_base import OTMProcessor\nfrom slp_base import ProviderValidator\nfrom slp_base.slp_base.provider_loader import ProviderLoader\nfrom slp_base.slp_base.provider_parser import ProviderParser\nfrom slp_mais.slp_mais.mais_loader import MAISLoader\nfrom slp_mais.slp_mais.mais_mapping_loader import MAISMappingLoader\nfrom slp_mais.slp_mais.mais_mapping_validator import MAISMappingValidator\nfrom slp_mais.slp_mais.mais_parser import MAISParser\nfrom slp_mais.slp_mais.mais_validator import MAISValidator\nclass MAISProcessor(OTMProcessor):\ndef __init__(self, project_id: str, project_name: str, sources: [bytes], mappings: [bytes]):\nself.project_id = project_id\nself.project_name = project_name\nself.source = sources[0]\nself.mappings = mappings[0]\nself.loader = None\nself.mapping_loader = None\ndef get_provider_validator(self) -&gt; ProviderValidator:\nreturn MAISValidator(self.source)\ndef get_provider_loader(self) -&gt; ProviderLoader:\nself.loader = MAISLoader(self.source)\nreturn self.loader\ndef get_mapping_validator(self) -&gt; MappingValidator:\nreturn MAISMappingValidator(self.mappings)\ndef get_mapping_loader(self) -&gt; MappingLoader:\nself.mapping_loader = MAISMappingLoader(self.mappings)\nreturn self.mapping_loader\ndef get_provider_parser(self) -&gt; ProviderParser:\nmais = self.loader.get_mais()\nmais_mapping = self.mapping_loader.get_mais_mapping()\nreturn MAISParser(self.project_id, self.project_name, mais, mais_mapping)\n</code></pre> <p>Once you have created all the implementations, your slp_module package should appear like this:</p> <p></p>"},{"location":"development/Create-a-new-StartLeft-Processor/#testing-the-slp","title":"Testing the SLP","text":"<p>We have already implemented all the necessary classes to perform the conversion from MAIS to OTM, so let's create a test to verify that they are working fine.</p>"},{"location":"development/Create-a-new-StartLeft-Processor/#create-the-test-resources","title":"Create the test resources","text":"<p>We are going to create a single happy path test using the resources from the section where the MAIS format is defined.  So, inside the <code>slp_mais/tests/resources</code> folder:</p> <ol> <li>Copy the MAIS source file with the name <code>mais-sample.json</code>.</li> <li>Copy the mapping file with the name <code>mapping-sample.yaml</code>.</li> <li>Copy the expected OTM resulting file with the name <code>expected-otm.otm</code>.</li> </ol>"},{"location":"development/Create-a-new-StartLeft-Processor/#implement-the-test","title":"Implement the test","text":"<p>Now we can create a simple test that verifies that the conversion process is working fine for the basic files created above. For that, create a <code>test_mais_processor.py</code> file inside the <code>slp_mais/slp_mais/tests/integration</code> folder: <pre><code>import os\nfrom sl_util.sl_util.file_utils import get_data\nfrom slp_base.tests.util.otm import validate_and_compare\nfrom slp_mais.slp_mais.mais_processor import MAISProcessor\nSAMPLE_PROJECT_ID = 'my-project'\nSAMPLE_PROJECT_NAME = 'My Project'\nresources_path = f'{os.path.dirname(__file__)}/../resources'\nclass TestMAISProcessor:\ndef test_single_component_mais_file_ok(self):\n# GIVEN a simple MAIS file with a single component\nmais_file = get_data(f'{resources_path}/mais-sample.json')\n# AND a MAIS mapping file that defines a mapping for that component\nmapping_file = get_data(f'{resources_path}/mapping-sample.yaml')\n# AND an expected OTM result\nexpected_otm = f'{resources_path}/expected-otm.otm'\n# WHEN MAISProcessor::process is invoked\notm = MAISProcessor(\nproject_id=SAMPLE_PROJECT_ID,\nproject_name=SAMPLE_PROJECT_NAME,\nsources=[mais_file],\nmappings=[mapping_file]\n).process()\n# THEN a valid OTM file matching expected is generated\nresult, expected = validate_and_compare(otm, expected_otm, [])\nassert result == expected\n</code></pre></p> <p>The whole module appears now like this:</p> <p></p> <p>You are done! Execute the test and verify that the conversion process is happily performed!</p>"},{"location":"development/Create-a-new-StartLeft-Processor/#configuring-and-exposing-the-slp","title":"Configuring and exposing the SLP","text":"<p>At this point we already have our processor up and running, so it is time to expose it. For that,  no code is needed, and you only need to perform the configuration steps below.</p>"},{"location":"development/Create-a-new-StartLeft-Processor/#configure-the-module","title":"Configure the module","text":"<ol> <li>Go to the <code>_sl_build/modules.py</code> class, where you can find the modules' configuration.</li> <li>In the <code>PROCESSORS</code> variable, add <code>slp_mais</code> as <code>forbidden_dependency</code> for all the existent SLP modules.</li> <li>Create a new entry in the array with the configuration for our <code>slp_mais</code> module: <pre><code>    {\n'name': 'slp_mais', \n'type': 'processor', \n'provider_type': 'MAIS',\n'forbidden_dependencies': ['startleft', 'slp_cft', 'slp_tf', 'slp_visio', 'slp_mtmt']\n}\n</code></pre></li> </ol>"},{"location":"development/Create-a-new-StartLeft-Processor/#try-it-on-the-rest-api","title":"Try it on the REST API","text":"<p>Launch the REST API as explained in the Quickstart Guide for Developers and check the Swagger page in http://localhost:5000/docs. You can see that the MAIS IaC type is already available in the <code>POST /iac</code> endpoint:</p> <p></p> <p>If you try to perform the request with the sample source and mapping files used across this tutorial, you can see that  the server is returning the expected OTM as a response.</p>"},{"location":"development/Errors-Management/","title":"Errors management","text":""},{"location":"development/Errors-Management/#steps","title":"Steps","text":"<p>The management of errors on StartLeft is handled on four separated steps:</p> <ol> <li>Provider selection.</li> <li>Source file processing.</li> <li>Mapping file processing.</li> <li>OTM generation.</li> </ol> <p></p>"},{"location":"development/Errors-Management/#error-types","title":"Error types","text":"<p>Step 1:</p> <ul> <li>Provider error: Provider resolver could not find a provider for the given type.<ul> <li><code>ProviderNotFoundError</code>.</li> </ul> </li> </ul> <p>Step 2:</p> <ul> <li> <p>Validation error: The file is not valid due to wrong mime type, maxsize, etc.</p> <ul> <li><code>IacNotValidFileError</code>.</li> <li><code>DiagramNotValidFileError</code>.</li> <li><code>SourceFileNotValidError</code>.</li> </ul> </li> <li> <p>Loading error: We are unable to load the file due to the wrong type being specified or any error inside the file that   does not permit loading its content.</p> <ul> <li><code>LoadingIacFileError</code>.</li> <li><code>LoadingDiagramFileError</code>.</li> <li><code>LoadingSourceFileError</code>.</li> </ul> </li> </ul> <p>Step 3:</p> <ul> <li>Validation error: The file is not valid due to wrong mime type, maxsize, etc.<ul> <li><code>MappingFileNotValidError</code>.</li> </ul> </li> <li>Loading error: We are unable to load the file due to the wrong type being specified or any error inside the file that   does not permit loading its content.<ul> <li><code>LoadingMappingFileError</code>.</li> </ul> </li> </ul> <p>Step 4:</p> <ul> <li>OTM generation related errors:<ul> <li><code>OTMBuildingError</code>. We are unable to generate the OTM with the given files.</li> <li><code>OTMResultError</code>. We are able to generate the OTM but the OTM is invalid (e.g: inconsistent IDs).</li> <li><code>OTMGenerationError</code>. There was any unexpected error.</li> </ul> </li> </ul>"},{"location":"development/Errors-Management/#http-statuses-and-exit-codes","title":"HTTP statuses and exit codes","text":"Error code HTTP Status CLI exit code <code>LoadingIacFileError</code> 400 1 <code>IacFileNotValidError</code> 400 2 <code>LoadingDiagramFileError</code> 400 11 <code>DiagramNotValidFileError</code> 400 12 <code>LoadingSourceFileError</code> 400 51 <code>SourceFileNotValidError</code> 400 52 <code>LoadingMappingFileError</code> 400 21 <code>MappingFileNotValidError</code> 400 22 <code>OTMBuildingError</code> 400 41 <code>OTMResultError</code> 400 42 <code>OTMGenerationError</code> 500 45 <code>ProviderNotFoundError</code> 400 60"},{"location":"development/Errors-Management/#http-response-body","title":"HTTP response body","text":"<p>The response body on any of this cases will be a JSON with this structure: <pre><code>{\n\"status\": \"the numeric http status code\",\n\"error_type\": \"&lt;The error type&gt;\",\n\"title\": \"&lt;The error on human readable form&gt;\",\n\"detail\": \"&lt;The detail of the error&gt;\",\n\"errors\": [\n{\n\"errorMessage\": \"&lt;The reason of the error&gt;\"\n}\n]\n}\n</code></pre></p> <p>When calling StartLeft through IriusRisk, the most important field here is error_type because it is the code that the  IriusRisk core is going to read to match the error type, manage the StartLeft error response and send its own response  on the core API.</p>"},{"location":"development/Quickstart-Guide-for-Developers/","title":"Quickstart Guide for Developers","text":"<p>StartLeft is an Open Source project that welcomes collaborators to extend or improve its functionality. Despite the  fact that it was born as an internal IriusRisk project, there are some characteristic that makes it specially  suitable to grow through the contributions of the community:</p> <ul> <li>The nature of the project, whose natural functional escalation is based on the support of new, independent, source formats.</li> <li>The conversion into OTM is based on configuration files that can also be created independently depending on the expected   OTM use.</li> <li>The modularized architecture enables collaborators to contribute to each format's    processor without conflicts.</li> </ul>"},{"location":"development/Quickstart-Guide-for-Developers/#how-to-contribute","title":"How to contribute?","text":"<p>The IriusRisk team is currently the coordinator of the project and, ultimately, the responsible for validating the Pull Requests created by the collaborators. All you need to know before you start contributing is in the  CONTRIBUTING.md file.  Anyway, it is important to consider that, before creating your own fork or PR, you should check the  open issues to ensure that there is none related with what you intend to do.</p>"},{"location":"development/Quickstart-Guide-for-Developers/#set-up-the-environment","title":"Set up the environment","text":"<p>There are no special requirements about a specific IDE or special steps to perform that make StartLeft different from any Python project. However, as PyCharm (or IntelliJ with the python plugin) is one of the most common python IDEs, some related  utilities are provided.</p>"},{"location":"development/Quickstart-Guide-for-Developers/#basic-configuration","title":"Basic configuration","text":"<p>Regardless of the IDE you use, we can generalize the cloning of the project and the creation and configuration of the python virtual  environment.</p> <p>First, we need to clone the project and move to its project: <pre><code>git clone https://github.com/iriusrisk/startleft.git\ncd startleft\n</code></pre></p> <p>Then, let's create and activate a virtual environment for StartLeft: <pre><code>python3 -m venv ./venv\nsource venv/bin/activate\n</code></pre></p> <p>Now, install all the required dependencies, including the ones required for setup and test, in this virtual environment: <pre><code>pip install -e \".[setup,test]\"\n</code></pre></p> <p>If everything worked fine, you should be able to start the server inside this virtual environment and with no errors  shown in the logs: <pre><code>startleft server\n</code></pre></p> <p>At this point, you have the project completely configured to start working with the IDE or editor you prefer.</p>"},{"location":"development/Quickstart-Guide-for-Developers/#pycharmintellij-setup","title":"PyCharm/IntelliJ setup","text":""},{"location":"development/Quickstart-Guide-for-Developers/#open-the-project","title":"Open the project","text":"<p>The project is already cloned and configured, so simply go to <code>File &gt; Open...</code> and select the project folder.</p>"},{"location":"development/Quickstart-Guide-for-Developers/#configure-the-python-interpreter","title":"Configure the python interpreter","text":"<p>As we have already configured a virtual environment, PyCharm will recognize it and propose it as the project interpreter:</p> <p></p> <p>We only need to click on Configure a Python interpreter... and accept the proposed one.</p>"},{"location":"development/Quickstart-Guide-for-Developers/#import-the-run-configurations","title":"Import the run configurations","text":"<p>Since StartLeft is a quite complex project with different commands and test sets that can be launched independently,  a set of portable and preconfigured run configurations are provided. So, the final configuration step is to import them following the instructions detailed here and assure that you can execute StartLeft from your PyCharm.</p>"},{"location":"development/Quickstart-Guide-for-Developers/#architecture","title":"Architecture","text":"<p>With your development environment ready, it is strongly advised to take a look to the  architecture page to familiarize yourself with the different modules, including their relationships and common internal structure. This is specially relevant considering that forbidden imports between modules will remain in python collect errors that prevent  StartLeft to start which can lead to confusion.</p>"},{"location":"development/Quickstart-Guide-for-Developers/#errors-management","title":"Errors management","text":"<p>In spite of the modularized architecture of StartLeft, the process of reading and parsing an input source and convert it into OTM has a set of fixed stages defined in the <code>slp_base</code> module. For each of these stages, there are a set of predefined errors that must be used in order to get coherent and descriptive errors in the REST API or CLI responses. All you need to know about the errors management is explained in the errors management page.</p>"},{"location":"development/Quickstart-Guide-for-Developers/#creating-a-new-startleft-processor","title":"Creating a new StartLeft Processor","text":"<p>Once you have the environment in place and a general idea about the organization of the code, we can already take a look  to the most common use cases for StartLeft contributions through the documented tutorials.</p> <p>A very interesting situation is when the user wants to make StartLeft support a new format. In that case, you will need to  know the interfaces you need to implement and the minimal configuration to expose it through the CLI and the REST API.</p> <p>You can easily go through this creation process in this  tutorial page.</p>"},{"location":"development/Run-Configurations/","title":"Run configurations","text":"<p>Warning: This page only applies if you are using PyCharm or IntelliJ as IDE</p> <p>The easiest way to develop and test StartLeft is by using PyCharm\u2019s Run &amp; debug configurations that references our IaC,  diagrams and mapping files inside <code>/examples</code> project file. </p>"},{"location":"development/Run-Configurations/#how-to-import","title":"How to import?","text":"<p>Since there are a bunch of different commands, modules and  ways of using and testing StartLeft, you can import the <code>run_configurations.zip</code> file placed on the root of the repository.  For that, manually unzip the file or, in Linux, execute the following command:</p> <p><pre><code>unzip run_configurations.zip\n</code></pre> Then, a <code>.run</code> folder should be created in the root of the project with a bunch of xml files corresponding to each run configuration. The IDE should automatically process this folder and load all the configurations. Check the upper right corner of the window:</p> <p></p>"},{"location":"development/Run-Configurations/#how-to-use","title":"How to use?","text":"<p>Before going in depth into the different types of configurations and its organization, let's try a couple of basic commands.</p> <p>Execute <code>version &gt; [VERSION]</code> and verify that something like this is shown:</p> <pre><code>cli.py, version development-version\n</code></pre> <p>Now, set up the server with the <code>[SERVER]</code> configuration, you should see the starting logs and be able to see the API docs in  http://localhost:5000/docs.</p> <p>Finally, let's try the run configuration for running all the application tests executing the <code>[ALL TESTS]</code> run configuration. Then, the console must show all the tests which are being executed.</p>"},{"location":"development/Run-Configurations/#how-are-they-organized","title":"How are they organized?","text":"<p>Once imported all the run configuration will be available organized in the different levels explained below.</p>"},{"location":"development/Run-Configurations/#command-launching","title":"Command launching","text":"<p>The first group of run configurations that appears in the dropdown box is for launching the production code through the different commands supported by StartLeft. It is organized as follows.</p>"},{"location":"development/Run-Configurations/#server","title":"[SERVER]","text":"<p>This is the most common used run/debug configuration, since it is the one used for launching the StartLeft\u2019s web service that exposes the REST API. It basically launches the StartLeft\u2019s server command.</p>"},{"location":"development/Run-Configurations/#cli-commands","title":"CLI commands","text":"<p>Each CLI supported command has its own folder with several examples to be run with different parameters. The format for the name of these configurations is:</p> <p><code>[COMMAND][PROVIDER][USE CASE NAME]</code> </p> <p>For example, to launch the parse command with the Cloudformation example for security groups, the run configuration is called:</p> <p><code>[PARSE][CFT][SECURITY GROUPS]</code></p>"},{"location":"development/Run-Configurations/#all-tests","title":"[ALL TESTS]","text":"<p>This is a special case of the run configurations. Since StartLeft contains a group of independent modules, the only way  to launch all the tests for all the modules in a single command is having a python script with the logic to retrieve all these tests.  This run configuration runs that script in order to execute all the tests for the whole repo.</p>"},{"location":"development/Run-Configurations/#test-launching","title":"Test launching","text":"<p>Tests have their own specific section of run configurations with the following subsections.</p>"},{"location":"development/Run-Configurations/#module-tests","title":"Module tests","text":"<p>Each StartLeft module has a run configuration to launch its tests. The naming for this run configurations is:</p> <p><code>[MODULE_NAME][TESTS]</code> </p> <p>For instance, if we want to launch the tests for the Cloudformation SLP module, the run configuration is <code>[SLP_CFT][TESTS]</code>.</p>"},{"location":"development/Run-Configurations/#globaltests","title":"[GLOBAL][TESTS]","text":"<p>Apart from the module-specific tests, there is a group of global integration tests for the whole StartLeft that has its own launcher,  called <code>[GLOBAL][TESTS]</code>. Do not confuse this run configuration with <code>[ALL TESTS]</code>, that runs all the tests, including the global ones  as well as the tests for each module.</p>"},{"location":"development/Run-Configurations/#example-files","title":"Example files","text":"<p>The provided run configurations contain only relative paths to files existent inside the StartLeft repository, so you should  not need to change any parameter in the given run configurations. If so, this would be probably because some file has been renamed  or deleted from the repository.</p>"},{"location":"integration/Quickstart-Guide-for-Integrations/","title":"Quickstart Guide for Integrations","text":"<p>The final goal of StartLeft is being integrated within processes that requires the generation of a Threat Model. Examples of this are:</p> <ul> <li>A CI/CD pipeline for modifications in IaC files.</li> <li>A process for creating standardized Threat Models from infrastructure diagrams.</li> <li>A process for migrating Threat Models from one threat modeling tool to another.</li> </ul> <p>The more common scenario for these use cases is that they are automatized. For that, it is necessary that StartLeft can be used by another services or applications in a smooth way. The different ways of doing this are explained along this page.</p>"},{"location":"integration/Quickstart-Guide-for-Integrations/#as-a-service","title":"As a service","text":"<p>This type of integration fits specially well when we need to integrate StartLeft with some application that requires  OTM conversion features. For instance, IriusRisk provides importing endpoints for different sources that internally rely on a StartLeft service for generating an OTM as a common intermediate state:</p> <p></p> <p>Notice that StartLeft is a stateless service. It requires neither authentication nor authorization since it does not access or stores personal information nor access other services. For this reason, the service is quite simple to deploy and operate.</p>"},{"location":"integration/Quickstart-Guide-for-Integrations/#deploy-locally","title":"Deploy locally","text":"<p>If you only want to experiment with the API, this is probably the simplest way. For that, you need to have StartLeft installed in your machine as explained in the Quickstart Guide for Beginners and execute the command: <pre><code>startleft server\n</code></pre> The server is started by default in the port 5000, but you can configure it with the <code>--port</code>/<code>-p</code> modifier. <pre><code>startleft server --port 8080\n</code></pre> Once you have your service started, you can check the API documentation in http://localhost:5000/docs.</p>"},{"location":"integration/Quickstart-Guide-for-Integrations/#deploy-dockerized","title":"Deploy dockerized","text":"<p>This is the most logical option for integration purposes, since it enables the service to be portable to any infrastructure. In the same StartLeft repository a ready-to-use Dockerfile is provided, so you already have what you need to set up your  dockerized service.</p> <p>For trying it, let's clone the StartLeft repository: <pre><code>git clone https://github.com/iriusrisk/startleft.git\n</code></pre></p> <p>Jump into the repo folder: <pre><code>cd startleft\n</code></pre></p> <p>Optionally you can build the image for a specific version doing checkout of the correspondant release branch. For example, to generate an image for the version 1.5.0, you may execute: <pre><code>git checkout release/1.5.0\n</code></pre></p> <p>Now, we can create the StartLeft image: <pre><code>docker build . -f deployment/Dockerfile.application -t startleft\n</code></pre></p> <p>And, finally, we can run the docker container for the image we have just generated. Notice that you can select the port where the service is exposed in a standard Docker way. <pre><code>docker run -p 5000:5000 startleft\n</code></pre></p> <p>If everything works, you should see a log like this: <pre><code>INFO:     Started server process [1]\nINFO:     Waiting for application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://0.0.0.0:5000 (Press CTRL+C to quit)\n</code></pre></p> <p>As in the local deployment, we can check that the service documentation is correctly located in  http://localhost:5000/docs.</p> <p>Another way to verify the availability of the service is performing a request to the health endpoint, which can be done through a curl command like: <pre><code>curl localhost:5000/health\n</code></pre> This command should return: <pre><code>{\n\"status\": \"OK\",\n\"version\": \"development-version\",\n\"components\": {\n\"StartLeft\": \"OK\"\n}\n}\n</code></pre> For more details about how to use the StartLeft API, you can check the REST API page.</p>"},{"location":"integration/Quickstart-Guide-for-Integrations/#custom-dockerfile","title":"Custom Dockerfile","text":"<p>The Dockerfile provided should be enough for the most common integration scenarios, but, of course, it is possible to create a custom docker image for StartLeft. For that, you can take the existent  Dockerfile available in the root of the StartLeft repository as a base. However, you must bear in mind the following considerations:</p> <ul> <li>Every official python image from the Docker Hub for versions over 3.6 should work, but:<ul> <li>Depending on the base image, you may need to install additional libraries.</li> <li>Debian/Ubuntu based python official images present security vulnerabilities. This is the reason we decided  to use the Alpine based one despite the fact it is significantly slower than others at building time.</li> </ul> </li> <li>Although you could set as the entrypoint the <code>startleft server</code> command, it is more recommendable to just use the uvicorn    command, that also allows you to select the default deployment port: <pre><code>ENTRYPOINT [\"uvicorn\", \"startleft.startleft.api.fastapi_server:webapp\", \"--host\", \"0.0.0.0\", \"--port\", \"5000\"]\n</code></pre></li> </ul>"},{"location":"integration/Quickstart-Guide-for-Integrations/#in-batch-processes","title":"In batch processes","text":"<p>The Command Line Interface enables users to easily create scripts for converting from different sources to OTM in batch, but also to perform other operations like validating files. To do that, you simply need to install StartLeft on your machine or  create a StartLeft docker image able to read the scripts you want to process.</p> <p>Regarding the different functionalities available through the CLI and the REST API, it is important to consider that they do not have to necessarily match. For example, OTM or mappings validations are available through the <code>validate</code> command, but  there are no REST endpoint for them. On the other hand, not all the formats can be converted into OTM through the <code>parse</code> CLI command, but all of them are supported in the REST API. These inconsistencies are expected to be solved in the short/medium term with a small impact, since the transformation logic and the access interfaces are already decoupled. Thus, if you have special interest in having some feature available through some interface, please raise an issue or create a fork following the Quickstart guide for developers.</p>"},{"location":"integration/Quickstart-Guide-for-Integrations/#as-modules-as-library-for-future","title":"As modules as library (For future)","text":"<p>StartLeft is a complete tool that exposes OTM conversion functionalities through different interfaces. However, it would  be very useful for some customers to create their own python tools for parsing different formats to OTM without having to  install and use a CLI or set up a REST API.</p> <p>As you can see in the Architecture page, each StartLeft module is an  independent piece of software. Thus, releasing useful modules as the SLPs or the OTM module is currently under study. However, even though an advanced user could manage to install and use StartLeft as a library, it is not recommended because  some related changes (like modules' visibility) that could break retro compatibility will probably need to be done.</p> <p>The final goal would be that, in the future, you could do something like this in your own python script: <pre><code>from slp_visio import VisioProcessor\nvisio_processor = VisioProcessor(\nproject_id='sample-project-id', \nproject_name='sample-project-name', \nsource=open('visio.vsdx', 'r'), \nmappings=[open('mapping.yaml', 'r')])\notm = visio_processor.process()\n</code></pre></p>"},{"location":"startleft-processors/diagram/Lucidchart-support/","title":"Lucidchart Support","text":""},{"location":"startleft-processors/diagram/Lucidchart-support/#what-is-lucidchart","title":"What is Lucidchart?","text":"<p>From official Lucidchart page:</p> <p>Lucidchart is the intelligent diagramming application that brings teams together to make better decisions and  build the future.</p>"},{"location":"startleft-processors/diagram/Lucidchart-support/#parsing-particularities","title":"Parsing particularities","text":"<p>Lucidchart does not have its own extension for exporting. Instead of that, it enables their users to download  their diagrams in several ways. One of them is VSDX, which is the Microsoft Visio format supported by StartLeft.  All the Visio documentation about mapping and parsing logic applies for Lucidchart. However, there are a couple  of considerations that are important to know.</p> <p>About the mappings:</p> <ul> <li>The structure of the mapping file is exactly the same that for the Microsoft Visio files.</li> <li>The stencils are different in Microsoft Visio and Lucidchart, so you need to compose different mappings for each of    them.</li> <li>The internal name of the Lucidchart stencil shapes does not match the one shown in the application. In the   mapping file   provided in the StartLeft examples folder, you can find a list of AWS components' internal names.</li> </ul> <p>About the parsing logic:</p> <ul> <li>Boundary TrustZones are not currently supported for Lucidchart.</li> <li>Dataflows are calculated based on their position, what means that they do not necessarily need to touch origin    or target shapes, but they have some tolerance.</li> </ul>"},{"location":"startleft-processors/diagram/Lucidchart-support/#an-example","title":"An example","text":"<p>In this example, we can see a Lucidchart diagram which includes different types of elements.</p> <ul> <li>Generic shapes like the Internet TrustZone or the Custom VPC.</li> <li>Generic stencil shapes like the Client and the Mobile client.</li> <li>AWS stencil shapes like the Amazon CloudWatch or the Amazon EC2.</li> <li>Azure stencil shapes like the SQLDatabaseAzure2021.</li> <li>Several dataflows among the shapes.</li> </ul> <p>Notice also that all the components in the diagram are nested inside others. All of them belong to a TrustZone, but,  for example, the Amazon EC2 is also nested inside the Custom VPC. This hierarchy, as is done for Microsoft Visio,  will be respected in the resultant OTM.</p> <p></p> <p>If we compose a default mapping file for all the stencil shapes:</p> default-mapping.yaml <pre><code>trustzones:\n- label:  Public Cloud\ntype:   Public Cloud\nid:     b61d6911-338d-46a8-9f39-8dcd24abfe91\n- label:  Private Secured Cloud\ntype:   Private Secured\nid:     2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\n- label: AWSCloudAWS2021\ntype: Public Cloud\nid: b61d6911-338d-46a8-9f39-8dcd24abfe91\ncomponents:\n## Visio Lucid names\n- label: ClientAWS19\ntype: generic-client\n- label: AmazonCognitoAWS19\ntype: cognito\n- label: AmazonEC2AWS2021\ntype: ec2\n- label: SQLDatabaseAzure2021\ntype: CD-MICROSOFT-AZURE-SQL-DB\n- label: DatabaseBlock\ntype: other-database\n- label: AmazonSimpleStorageServiceS3AWS19\ntype: s3\n- label: AWSIdentityandAccessManagement_IAMAWS19\ntype: iam\n- label: AWSCloudTrailAWS19\ntype: cloudtrail\n- label: AWSCloudTrailAWS2021\ntype: cloudtrail\n- label: AmazonAPIGateway_purpleAWS19\ntype: api-gateway\n- label: AWSGeneral_UserAWS19\ntype: empty-component\n- label: ImageSearchBlock2\ntype: empty-component\n- label: ElasticLoadBalancingELLoadBalancer2017\ntype: empty-component\n- label: AmazonEC2AutoScalingAWS2021\ntype: empty-component\n- label: AWSFargateAWS19\ntype: empty-component\n- label: AmazonDynamoDBAWS19\ntype: empty-component\n- label: AWSCertificateManagerAWS19\ntype: empty-component\n- label: AWSCodePipelineAWS19\ntype: empty-component\n- label: AWSCodeBuildAWS19\ntype: empty-component\n- label: AmazonCloudWatchAWS19\ntype: cloudwatch\n- label: AmazonCloudWatchAWS2021\ntype: cloudwatch\n- label: AWSCodeStarAWS19\ntype: empty-component\n- label: AmazonECR2017\ntype: empty-component\ndataflows: [ ]\n</code></pre> <p>Then, we can map the generic shapes by name in a custom mapping file:</p> custom-mapping.yaml <pre><code>trustzones: - label:  Internet\ntype:   internet\nid:     f0ba7722-39b6-4c81-8290-a30a248bb8d9\ncomponents:\n- label: Web browser\ntype: generic-client\n- label: Android\ntype: android-device-client\ndataflows: []\n</code></pre> <p>The expected result for this case should be an OTM like this:</p> lucidchart.otm <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"Lucid Example\",\n\"id\": \"lucid-example\"\n},\n\"representations\": [{\n\"name\": \"Visio\",\n\"id\": \"Visio\",\n\"type\": \"diagram\",\n\"size\": {\n\"width\": 1000,\n\"height\": 1000\n}\n}],\n\"trustZones\": [{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"name\": \"Public Cloud\",\n\"risk\": {\n\"trustRating\": 10\n}\n}, {\n\"id\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\",\n\"name\": \"Private Secured Cloud\",\n\"risk\": {\n\"trustRating\": 10\n}\n}, {\n\"id\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\",\n\"name\": \"Internet\",\n\"risk\": {\n\"trustRating\": 10\n}\n}],\n\"components\": [{\n\"id\": \"7\",\n\"name\": \"Custom VPC\",\n\"type\": \"empty-component\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}, {\n\"id\": \"9\",\n\"name\": \"My EC2\",\n\"type\": \"ec2\",\n\"parent\": {\n\"component\": \"7\"\n}\n}, {\n\"id\": \"12\",\n\"name\": \"My CloudWatch\",\n\"type\": \"cloudwatch\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}, {\n\"id\": \"17\",\n\"name\": \"My API Gateway\",\n\"type\": \"api-gateway\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}, {\n\"id\": \"26\",\n\"name\": \"My CloudTrail\",\n\"type\": \"cloudtrail\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}, {\n\"id\": \"29\",\n\"name\": \"My Simple Storage Service (S3)\",\n\"type\": \"s3\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}, {\n\"id\": \"38\",\n\"name\": \"Web browser\",\n\"type\": \"generic-client\",\n\"parent\": {\n\"trustZone\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\"\n}\n}, {\n\"id\": \"44\",\n\"name\": \"Android\",\n\"type\": \"android-device-client\",\n\"parent\": {\n\"trustZone\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\"\n}\n}, {\n\"id\": \"47\",\n\"name\": \"SQL Database\",\n\"type\": \"CD-MICROSOFT-AZURE-SQL-DB\",\n\"parent\": {\n\"trustZone\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\"\n}\n}, {\n\"id\": \"53\",\n\"name\": \"My DynamoDB\",\n\"type\": \"dynamodb\",\n\"parent\": {\n\"trustZone\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\"\n}\n}],\n\"dataflows\": [{\n\"id\": \"32\",\n\"name\": \"EC2 Logs\",\n\"source\": \"9\",\n\"destination\": \"12\"\n}, {\n\"id\": \"33\",\n\"name\": \"GW/EC2\",\n\"source\": \"17\",\n\"destination\": \"9\"\n}, {\n\"id\": \"34\",\n\"name\": \"Log trace\",\n\"source\": \"17\",\n\"destination\": \"26\"\n}, {\n\"id\": \"35\",\n\"name\": \"Customer data\",\n\"source\": \"17\",\n\"destination\": \"29\"\n}, {\n\"id\": \"43\",\n\"name\": \"f7ef1b0f-2a7a-4822-9aa8-59affc9bf309\",\n\"source\": \"38\",\n\"destination\": \"17\"\n}, {\n\"id\": \"46\",\n\"name\": \"114deaf6-bb2d-407a-a68a-1fccb3d56ed7\",\n\"source\": \"44\",\n\"destination\": \"17\"\n}, {\n\"id\": \"56\",\n\"name\": \"User data\",\n\"source\": \"17\",\n\"destination\": \"53\"\n}, {\n\"id\": \"57\",\n\"name\": \"App data\",\n\"source\": \"17\",\n\"destination\": \"47\"\n}]\n} </code></pre> <p>That imported in a tool like IriusRisk looks like this: </p>"},{"location":"startleft-processors/diagram/Lucidchart-support/#curl","title":"cURL","text":"<p>To try this example on your machine, first, you need to put in place the necessary files:</p> <ul> <li>Download the Lucidchart example above from   here.</li> <li>Save the default mapping above with the name <code>default-mapping.yaml</code>.</li> <li>Save the custom mapping above with the name <code>custom-mapping.yaml</code>.</li> </ul> <p>Finally, execute the following command to retrieve the OTM file:</p> <pre><code>curl --location --request POST localhost:5000/api/v1/startleft/diagram \\\n--header \"Content-Type: multipart/form-data\" \\\n--header \"Accept: application/json\" \\\n--form diag_type=\"LUCID\" \\\n--form diag_file=@\"./lucid-aws-with-tz-and-vpc.vsdx\" \\\n--form default_mapping_file=@\"./default-mapping.yaml\" \\\n--form custom_mapping_file=@\"./custom-mapping.yaml\" \\\n--form id=\"my-lucidchart-example\" \\\n--form name=\"My Lucidchart Example\"\n</code></pre>"},{"location":"startleft-processors/diagram/Lucidchart-support/#command-line-usage","title":"Command line usage","text":"<p>You can also use the Command Line option for this example, with the files downloaded in the previous section.</p> <p>Make sure StartLeft is properly installed  and execute the following command:</p> <pre><code>startleft parse \\\n--diagram-type LUCID \\\n--default-mapping-file ./default-mapping.yaml \\\n--custom-mapping-file ./custom-mapping.yaml \\\n--output-file my-lucidchart-cli-example.otm \\\n--project-name \"My Lucidchart CLI Example\" \\\n--project-id \"my-lucidchart-cli-example\" \\\n./lucid-aws-with-tz-and-vpc.vsdx\n</code></pre>"},{"location":"startleft-processors/diagram/Visio-Mapping/","title":"Visio Mapping","text":"<p>The greatest challenge when mapping Microsoft Visio files is that it is a completely open format where the user can place whatever they want. For that reason, the <code>slp_visio</code> works with some premises in order to build an OTM file with only the necessary information:</p> <ul> <li>There are different ways of parsing TrustZones, but only the default TrustZone will be generated if no Trustzone  appears in any of the mapping files.</li> <li>The only shapes that will be parsed into the OTM components are the ones whose name or type matches some label in the    mapping file. The rest of them will be ignored.</li> <li>There is no need to create mappings for the DataFlows, they will be generated from those Visio connectors that    link components that have also been mapped into the OTM.</li> <li>Nested shapes are automatically processed and parsed to the OTM components and TrustZones. There is no need to    define parent relationships in the mapping files.</li> </ul>"},{"location":"startleft-processors/diagram/Visio-Mapping/#mapping-hierarchy","title":"Mapping hierarchy","text":"<p>The StartLeft's Visio SLP support two types of mapping files. They both have exactly the same structure and behavior, but are intended to be used for different types of mappings. </p>"},{"location":"startleft-processors/diagram/Visio-Mapping/#default-mapping-file","title":"Default mapping file","text":"<p>As stated in the Visio Quickstart, stencils are a powerful Visio feature. From the point of  view of StartLeft, those users that use them in their diagrams may reduce a lot the work they have to do in order to  build their mappings. This is because the mappings for the stencils can be reused across every request to StartLeft  and does not need to be created each time.</p> <p>Other potential case or mappings reuse are the generic TrustZones. Even if you may have some diagrams with specific  TrustZones, it is a common case to have a fistful of them that tend to be present in most of your diagrams.  Thus, you should not need to map them again and again. In conclusion, for all those elements that you do not want to  map in each request because are common and reusable, you can build a default mapping file. Indeed, if you are  going to use StartLeft in a script or pipeline, you can simply save the default mapping file and inject it in  every StartLeft request. That is, for example, how IriusRisk's import processes work.</p>"},{"location":"startleft-processors/diagram/Visio-Mapping/#custom-mapping-file","title":"Custom mapping file","text":"<p>This file is used to cover the rest of elements that are not generic, but specific to a concrete diagram.  Remember that only the shapes whose type or name are in the mapping file will be parsed into the OTM so, everything  you need to be processed in a Visio file should be in the default or in the custom mapping file. In case the same  mapping appears in both mapping files, the one in the custom file takes preference.</p>"},{"location":"startleft-processors/diagram/Visio-Mapping/#mapping-file-structure","title":"Mapping file structure","text":"<p>The Visio mapping file is expected to be a YAML file whose structure is exactly defined by its json schema.  It is divided in three great blocks described in depth below. So, the root structure of the file is composed by three  arrays for the mappings of each type of element:</p> <pre><code>trustzones: []\ncomponents: []\ndataflows: []\n</code></pre> <p>Each of these arrays contains the information for mapping shapes into TrustZones, Components or Dataflows, respectively.  Also note that all three are mandatory and have to be included in each mapping file, even if they only contain an empty array.</p>"},{"location":"startleft-processors/diagram/Visio-Mapping/#mapping-trustzones","title":"Mapping TrustZones","text":"<p>The OTM standard defines that every component in the threat model must have a  parent, so you must make sure that the mapping file contains a mapping entry for all the TrustZones present in the  diagram as well as a default one so, if no parent can be calculated for a component, it can fall into this default  TrustZone. <pre><code>trustzones:\n- label:    My Public Cloud\ntype:     b61d6911-338d-46a8-9f39-8dcd24abfe91\n</code></pre> When a shape is found in the Visio file whose name matches the mapping's label, then a TrustZone is created with these OTM Trustzone fields:   - id is the original id in the Visio file    - name is the original name in the Visio file    - type is the type in the mapping file </p> <p>For example, for this TrustZone in the Visio file and the previous mapping:</p> <p></p> <p>The resultant OTM would contain a TrustZone like this: <pre><code>{\n\"trustZones\": [\n{\n\"id\": \"47\",\n\"name\": \"My Public Cloud\",\n\"type\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n]\n}\n</code></pre></p>"},{"location":"startleft-processors/diagram/Visio-Mapping/#default-trustzone","title":"Default Trustzone","text":"<p>The components in the Visio file that there aren't inside a trust zone will be assigned to the default trust zone. We can define the default trust zone in the mapping file by this way: <pre><code>trustzones:\n- label:    My Public Cloud\ntype:     b61d6911-338d-46a8-9f39-8dcd24abfe91\n- label:    My Private Secured\ntype:     2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\n- label:    Internet\ntype:     f0ba7722-39b6-4c81-8290-a30a248bb8d9\ndefault:  true\n</code></pre> Let's see an example</p> <p></p> <p>In this example \"My EC2\" will have \"My Public Cloud\" as parent, \"My DynamoDB\" will have \"My Private Secured\" as parent, and the \"Android Client\" will have the \"Internet\" parent defined in the mapping file as default trust zone. So the OTM would be like this:</p> <p><pre><code>{\n\"trustZones\": [\n{\n\"id\": \"47\",\n\"name\": \"My Public Cloud\",\n\"type\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"risk\": {\n\"trustRating\": 10\n}\n},\n{\n\"id\": \"48\",\n\"name\": \"My Private Secured\",\n\"type\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\",\n\"risk\": {\n\"trustRating\": 10\n}\n},\n{\n\"id\": \"39388080-e23b-4e16-976a-27f2f086dc0e\",\n\"name\": \"Internet\",\n\"type\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\",\n\"risk\": {\n\"trustRating\": 10\n},\n\"properties\": {\n\"default\": true\n}\n}\n],\n\"components\": [\n{\n\"id\": \"54\",\n\"name\": \"My EC2\",\n\"type\": \"ec2\",\n\"parent\": {\n\"trustZone\": \"47\"\n}\n},\n{\n\"id\": \"59\",\n\"name\": \"My DynamoDB\",\n\"type\": \"dynamodb\",\n\"parent\": {\n\"trustZone\": \"48\"\n}\n},\n{\n\"id\": \"66\",\n\"name\": \"Android Client\",\n\"type\": \"android-client\",\n\"parent\": {\n\"trustZone\": \"39388080-e23b-4e16-976a-27f2f086dc0e\"\n}\n}\n],\n\"dataflows\": []\n}\n</code></pre> Note that the Internet id is autogenerated unlike the other trust zones present in the Visio file, which id comes from the id in the Visio file</p> <p>Due to a backward compatibility StartLeft accepts as well the legacy mapping file format. Please read Legacy-Mapping-File-Format</p>"},{"location":"startleft-processors/diagram/Visio-Mapping/#default-trustzone-not-defined","title":"Default TrustZone not defined","text":"<p>Since it must necessarily have one trust zone, if any trust zone is defined as default in the mapping file the Public Cloud will always be the default one.</p> <p>These are the basics for the TrustZone mapping behavior, but TrustZones may be defined in different and more complex ways that are explained in deep in the TrustZones mapping's page.</p>"},{"location":"startleft-processors/diagram/Visio-Mapping/#mapping-components","title":"Mapping Components","text":"<p>Components mappings' structure is similar to the TrustZones. For example, we can have a mapping like this: <pre><code>components:\n- label:  Shape's name\ntype:   OTM's type\n</code></pre> However, its behavior presents the particularity that the label may refer to the type or the name of the shape.  For instance, suppose we have this diagram:</p> <p></p> <p>Considering that the My EC2 shape belongs to the AWS stencils, the more logical scenario is mapping it by type  in the default mapping file. For that, you have to use its name in the stencil, that is the one you can see in Visio  when you select the shape:</p> <p></p> <p>With this, you may compose a mapping like this: <pre><code>components:\n- label:  Amazon EC2\ntype:   ec2\n</code></pre></p> <p>That will result in an OTM component like this: <pre><code>{\n// The ID is the unique id got from the Visio file\n\"id\": \"1\",\n\"name\": \"My EC2\",\n\"type\": \"ec2\",\n\"parent\": {\n// The parent is the default TrustZone\n\"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}\n</code></pre></p> <p>For the My Custom Machine component, you need to map by name instead of type, so we can create a custom mapping  file with this content: <pre><code>components:\n- label:  My Custom Machine\ntype:   empty-component\n</code></pre></p> <p>The resulting OTM would be: <pre><code>{\n// The ID is the unique id got from the Visio file\n\"id\": \"2\",\n\"name\": \"My Custom Machine\",\n\"type\": \"empty-component\",\n\"parent\": {\n// The parent is the default TrustZone\n\"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}\n</code></pre></p> <p>It is important to notice that mapping by name has priority over mapping by type. So if you  include mappings in both mapping files for the My EC2 component like this: <pre><code>// In the default mapping file\ncomponents:\n- label:  Amazon EC2\ntype:   ec2\n// In the custom mapping file\ncomponents:\n- label:  My EC2\ntype:   empty-component\n</code></pre></p> <p>It would result in a OTM like this: <pre><code>{\n// The ID is the unique id got from the Visio file\n\"id\": \"1\",\n\"name\": \"My EC2\",\n\"type\": \"empty-component\",\n\"parent\": {\n// The parent is the default TrustZone\n\"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}\n</code></pre></p> <p>Finally, as seen in the following picture, there are certain stencils that, despite representing different components,  share the same type. In this example, one is Amazon Redshift for AWS Analytics, and the other one for AWS Databases.</p> <p></p> <p>In case both stencils appear in the diagram, an internal identifier called UniqueID  can optionally be used to differentiate them.</p> <p>This way, they can be mapped to different components in the following manner: <pre><code>components:\n- label:  Amazon Redshift\nid:     0508F4C7-001F-0000-8E40-00608CF305B2\ntype:   redshift\n- label:  Amazon Redshift\nid:     0509DF75-001B-0000-8E40-00608CF305B2\ntype:   empty-component\n</code></pre></p> <p>Note<p>Note that mapping by UniqueID has priority over both, mapping by name and mapping by type, but the label must  still be correct.</p> </p> <p>The resulting OTM will be as follows: <pre><code>{\n\"components\": [\n{\n\"id\": \"1\",\n\"name\": \"Amazon Redshift\",\n\"type\": \"empty-component\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n},\n{\n\"id\": \"13\",\n\"name\": \"Amazon Redshift\",\n\"type\": \"redshift\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n}\n]\n}\n</code></pre></p> How to find the UniqueID of a stencil <p>Being UniqueID an internal property, finding the value for a specific component is not straightforward.</p> <p>The easiest way is creating a diagram with only the desired stencil, and extracting the contents of the .vsdx file with any file archiver that supports the ZIP format.</p> <p>From the root of the extracted files and folders, it is possible to navigate to the visio/masters subfolders and  open the masters.xml file, where the name of the stencil and its UniqueID appears.</p> <p></p> <p>More info in the official Microsoft documentation.</p>"},{"location":"startleft-processors/diagram/Visio-Mapping/#mapping-dataflows","title":"Mapping DataFlows","text":"<p>Despite the fact that a <code>dataflows</code> tag is already defined in the mapping file structure, and it is required by the schema, the DataFlows mapping process is fixed and not configurable. Basically, it takes all the arrows in the Visio source that connect  components that are mapped and create a DataFlow for them. If some arrow connects shapes that are not mapped, the  DataFlow is not created. This can be easily understood with the following picture:</p> <p></p>"},{"location":"startleft-processors/diagram/Visio-Quickstart/","title":"Visio Quickstart","text":""},{"location":"startleft-processors/diagram/Visio-Quickstart/#what-is-microsoft-visio","title":"What is Microsoft Visio?","text":"<p>Note: It is important to notice that the only supported Visio format is the  VSDX format.  If you want to import another format, you previously need to convert it to vsdx. Otherwise, you will get an error.</p> <p>Microsoft Visio is a tool that  enables its users to freely draw diagrams of any kind from scratch or based on templates.</p> <p>From the point of view of StartLeft, it is a place where infrastructure or threat model diagrams can be created.  Despite the fact that Visio gives their users complete freedom to build whatever they want in the diagram,  architecture or threat modeling diagrams tend to share a more or less common structure and StartLeft pretends to  take advantage of this in order to automatize the processing of the diagrams to create threat models in the OTM format.</p>"},{"location":"startleft-processors/diagram/Visio-Quickstart/#microsoft-visio-stencils","title":"Microsoft Visio Stencils","text":"<p>Visio Stencils are a specially interesting use case, because they are predefined Visio shapes that can be reused  in every diagram. StartLeft is able to identify this kind of shapes so that their mappings can be also reused  for converting different diagrams. This is the case, for example, of the  Visio AWS stencils,  that are prebuilt shapes which represent a bunch of reusable AWS components. This feature allows StartLeft clients  like IriusRisk to define a  default mapping file with all these stencils and inject  it in every request to StartLeft so the user does not need to create the mappings each time.</p>"},{"location":"startleft-processors/diagram/Visio-Quickstart/#other-tools","title":"Other tools","text":"<p>VSDX is a structure to represent diagrams based on XML files, but each diagramming tool can (and actually does) fill that structure in slightly different ways. This means that StartLeft cannot support out-of-the-box VSDX files generated by every tool. So, if you export to VSDX a diagram created in DrawIO, for example, some errors may appear during the StartLeft parsing process.</p> <p>Currently, apart from native Microsoft Visio diagrams, only Lucidchart exported diagrams are supported. The mappings and the main parsing process are almost equal in both cases, but you can check out  the Lucidchart support page to best know about the parsing of diagrams created with that tool.</p>"},{"location":"startleft-processors/diagram/Visio-Quickstart/#the-slp_visio-module","title":"The <code>slp_visio</code> module","text":"<p>The <code>slp_visio</code> module is the StartLeft Processor responsible for converting Microsoft Visio files into OTM.  Although not every diagram is susceptible to be parsed into OTM automatically, the fact is that there are many  situations where the StartLeft process may be very useful. </p>"},{"location":"startleft-processors/diagram/Visio-Quickstart/#mapping-introduction","title":"Mapping introduction","text":"<p>Its operation is based on two types of mapping files hierarchically processed, that is, in case a shape is mapped  in both mapping files, the mapping in the custom mapping file has preference over the default one:</p> <ul> <li>The default mapping file is expected to contain those mappings that may be potentially reused across different    conversion requests. The typical use cases for this mapping file are predefined Visio Shapes like the AWS stencils    mentioned before or more simple shapes like the database shape, for example.</li> <li>The custom mapping file is the file where the user can introduce the mappings for their own specific    components. As mentioned above, the user has absolute freedom to draw and name shapes that may be relevant for the    threat model. Only mapped shapes will be parsed into the OTM so this is the place where you need to place the    mappings for everything you want to be processed.</li> </ul> <p>Further details about the mapping behavior may be found in the  Visio-Mapping page. Regarding the usage of StartLeft to converting Visio files, you can check the manuals for the  CLI and the REST API.</p>"},{"location":"startleft-processors/diagram/Visio-Quickstart/#elements-position-and-representation","title":"Elements position and representation","text":"<p>The Visio processor can process the Visio shapes and extract from them information about their representation. This data is then placed in the  OTM RepresentationElement object. In the Representations parsing page you can find all the details about how the  representation data is extracted from Visio, but, summarizing, these are the most important points:</p> <ul> <li>Position and size are parsed, but not the shape (circle, square, etc.).</li> <li>Representation information is extracted from Visio, but not calculated. This means that TrustZones generated by    default or coming from a boundary line will not have representation data in the OTM.</li> <li>The position of the elements in the OTM is relative to its immediate parent.</li> <li>All representation information is given in integers with no decimals and rescaled to avoid losing information.</li> </ul>"},{"location":"startleft-processors/diagram/Visio-Quickstart/#a-basic-example","title":"A basic example","text":"<p>Suppose you have an architecture diagram like the one below, that contains two TrustZones (Public Cloud and  Private Secured Cloud), a VPC and components that may belong to Stencils (My EC2 and Private Database) or  generic ones (My Custom Machine).</p> <p></p> <p>You may want to upload it to a threat modeling tool like IriusRisk to build a threat model  like this:</p> <p></p> <p>The most usual configuration for performing this conversion is having two mapping files. On one hand, you would have  your reusable default mapping file that contains mappings for the AWS stencils, with a content like this: <pre><code>trustzones:\n- label:  Public Cloud\ntype:   Public Cloud\nid:     b61d6911-338d-46a8-9f39-8dcd24abfe91\ncomponents:\n- label:  Amazon EC2\ntype:   ec2\n- label:  Database\ntype:   rds\ndataflows: []\n</code></pre></p> <p>On the other hand, for this specific request, you need to provide a custom mapping file which contains the  mappings for the generic elements of the diagram (My Custom VPC, My Custom Machine and the Private Secured Cloud  TrustZone): <pre><code>trustzones:\n- label:  Private Secured Cloud\ntype:   Private Secured\nid:     2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\ncomponents:\n- label:  My Custom Machine\ntype:   empty-component\n- label:  My Custom VPC\ntype:   empty-component\ndataflows: []\n</code></pre></p> <p>The result of sending to StartLeft this diagram with these mapping files would be an OTM with all the components we  had in the original Visio source:</p> basic-visio-example.otm <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"My Visio Basic Example\",\n\"id\": \"my-visio-basic-example\"\n},\n\"representations\": [\n{\n\"name\": \"Visio\",\n\"id\": \"Visio\",\n\"type\": \"diagram\",\n\"size\": {\n\"width\": 1000,\n\"height\": 1000\n}\n}\n],\n\"trustZones\": [\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"name\": \"Public Cloud\",\n\"risk\": {\n\"trustRating\": 10\n}\n},\n{\n\"id\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\",\n\"name\": \"Private Secured\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n],\n\"components\": [\n{\n\"id\": \"67\",\n\"name\": \"My Custom VPC\",\n\"type\": \"empty-component\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n},\n{\n\"id\": \"12\",\n\"name\": \"My EC2\",\n\"type\": \"ec2\",\n\"parent\": {\n\"component\": \"67\"\n}\n},\n{\n\"id\": \"30\",\n\"name\": \"Private Database\",\n\"type\": \"rds\",\n\"parent\": {\n\"trustZone\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\"\n}\n},\n{\n\"id\": \"68\",\n\"name\": \"My Custom Machine\",\n\"type\": \"empty-component\",\n\"parent\": {\n\"component\": \"67\"\n}\n}\n],\n\"dataflows\": [\n{\n\"id\": \"34\",\n\"name\": \"0d61e659-90a3-450e-adca-65aa08382c68\",\n\"source\": \"12\",\n\"destination\": \"30\"\n},\n{\n\"id\": \"69\",\n\"name\": \"f6d209c4-a507-48ca-a9ed-7d10c1d0cc78\",\n\"source\": \"68\",\n\"destination\": \"12\"\n}\n]\n}\n</code></pre>"},{"location":"startleft-processors/diagram/Visio-Quickstart/#cli","title":"CLI","text":"<p>Note: Before continue, make sure you have StartLeft properly installed in your machine.</p> <p>First of all, retrieve all the necessary files:</p> <ul> <li>Download the <code>visio-basic-example.vsdx</code> from here.</li> <li>Save the default mapping above with the name <code>default-mapping.yaml</code>.</li> <li>Save the custom mapping above with the name <code>custom-mapping.yaml</code>.</li> </ul> <p>Now we are going to execute StartLeft for these files so that an <code>ec2.otm</code> file will be generated in our working directory with identical contents to the one above. <pre><code>startleft parse \\\n--diagram-type VISIO \\\n--default-mapping-file default-mapping.yaml \\\n--custom-mapping-file custom-mapping.yaml \\\n--output-file basic-visio-example.otm \\\n--project-id \"my-visio-basic-example\" \\\n--project-name \"My Visio Basic Example\" \\\nvisio-basic-example.vsdx\n</code></pre></p>"},{"location":"startleft-processors/diagram/Visio-Quickstart/#curl","title":"cURL","text":"<p>You can get the same result if through the StartLeft's REST API. For that, in first place we need to set up the server with the command: <pre><code>startleft server\n</code></pre></p> <p>If you want to run the server in a specific port, you can do: <pre><code>startleft server -p 8080\n</code></pre></p> <p>Then, execute the following command to retrieve the OTM file with your EC2 component:</p> <pre><code>curl --location --request POST localhost:5000/api/v1/startleft/diagram \\\n--header \"Content-Type: multipart/form-data\" \\\n--header \"Accept: application/json\" \\\n--form diag_type=\"VISIO\" \\\n--form diag_file=@\"./visio-basic-example.vsdx\" \\\n--form default_mapping_file=@\"./default-mapping.yaml\" \\\n--form custom_mapping_file=@\"./custom-mapping.yaml\" \\\n--form id=\"my-visio-basic-example\" \\\n--form name=\"My Visio Basic Example\"\n</code></pre>"},{"location":"startleft-processors/diagram/Visio-Representations/","title":"Visio Representations","text":"<p>Visio diagrams contain visual information about your infrastructure or threat model that may be useful to keep.  During the parsing of the <code>vsdx</code> file, the <code>slp_visio</code> processor is able to extract this representation data and  include it in the resultant OTM.</p>"},{"location":"startleft-processors/diagram/Visio-Representations/#where-is-the-representation-data-located","title":"Where is the representation data located?","text":"<p>We use two OTM structures to store the representation data:</p> <ul> <li>The Representation object   is placed at the root level and contains information about the general representation of the Threat Model, for    instance, its type or the size of the canvas.</li> <li>The RepresentationElement object   is placed at Component or TrustZone level and contains representation info of that element as its position and size.</li> </ul>"},{"location":"startleft-processors/diagram/Visio-Representations/#what-representation-data-is-included","title":"What representation data is included?","text":"<p>Position and size data extracted from the Visio file source are included. It is relevant to notice that no  different types of shapes are supported and all Components and TrustZones will be represented in the OTM as rectangles.</p> <p></p>"},{"location":"startleft-processors/diagram/Visio-Representations/#position-calculation","title":"Position calculation","text":"<p> In the case of TrustZones, the parent element is the limit of the Visio diagram itself.</p> <p>The <code>position</code> attribute of the   OTM RepresentationElement object contains:</p> <ul> <li><code>x</code>. Distance from the LEFT side of the parent element to the left side of the child element.</li> <li><code>y</code>. Distance from the TOP of the parent element to the top of the child element. </li> </ul>"},{"location":"startleft-processors/diagram/Visio-Representations/#size-calculation","title":"Size calculation","text":"<p>The <code>size</code> attribute of the  OTM RepresentationElement object contains:</p> <ul> <li><code>width</code>. It is the difference between the right <code>x</code> value minus the left one.</li> <li><code>height</code>. It is the difference between the bottom <code>y</code> value minus the top one.</li> </ul>"},{"location":"startleft-processors/diagram/Visio-Representations/#excluded-representations","title":"Excluded representations","text":"<p>It is very important to consider that all the information included in the OTM is directly extracted from the  Visio file and not calculated by the <code>slp_visio</code>. This means that some elements will never have representations in  the OTM:</p> <ul> <li>The boundary TrustZones represents an ambiguous zone that is not explicitly defined in the source diagram, so    they will not have a representation object.</li> <li>The default TrustZone may contain elements from different places of the diagram and neither has any    representation info in the source Visio, so no representation object can be calculated.</li> <li>The Components without parent in the source Visio will be nested into the default TrustZone. Since this does    not have representation and the Components' position must be relative, they will not have representation.</li> <li>The Dataflows between elements must unequivocally identify their origin and target, so no representation    information is transferred to the OTM.</li> </ul>"},{"location":"startleft-processors/diagram/Visio-Representations/#how-visio-representation-data-is-processed","title":"How Visio representation data is processed?","text":"<p>The Visio position information and the OTM representation data do not exactly fit, so some transformations are required:</p> <ul> <li>Diagram limits calculation. Visio diagrams are unbounded, so it is necessary to find their boundaries in    some way. In that case, they are calculated using the position of the elements at their ends.</li> <li>Origin translation. Visio diagrams origin is located in the bottom left. Since the OTM representations origin    is on the top left, it is necessary to recalculate the <code>y</code> position from the diagram's top limit.</li> <li>Precision and scale. OTM representation values must be integers. However, Visio data is in float    precision, so it is rescaled and rounded. The scale factor is expected to be parametrizable in the future, but    for now, it is fixed to the IriusRisk scale (based on DrawIO). This means that each Visio representation parameter    is processed as follows:</li> </ul> <pre><code>IRIUSRISK_SMALLEST_COMPONENT_SIZE = 82\nVISIO_STENCILS_DEFAULT_SIZE = 0.5\nSCALE_FACTOR: int = round(IRIUSRISK_SMALLEST_COMPONENT_SIZE / VISIO_STENCILS_DEFAULT_SIZE)\n</code></pre>"},{"location":"startleft-processors/diagram/Visio-Representations/#an-example","title":"An example","text":"<p>Let's take this Visio example:</p> <p></p> OTM parsing result <p>If we parse it into OTM, the result would be something like this:</p> <pre><code>  {\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"VISIO\",\n\"id\": \"VISIO\"\n},\n\"representations\": [\n{ // (1)!\n\"name\": \"VISIO Diagram Representation\",\n\"id\": \"VISIO-diagram\",\n\"type\": \"diagram\",\n\"size\": { // (2)!\n\"width\": 1826,\n\"height\": 1207\n}\n}\n],\n\"trustZones\": [\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"name\": \"Public Cloud\",\n\"risk\": {\n\"trustRating\": 10\n},\n\"representations\": [\n{ // (3)!\n\"name\": \"Public Cloud Representation\",\n\"id\": \"67-representation\", // (4)!\n\"representation\": \"VISIO-diagram\",\n\"size\": {\n\"width\": 661,\n\"height\": 551\n},\n\"position\": {\n\"x\": 328,\n\"y\": 328\n}\n}\n]\n},\n{ // (5)!\n\"id\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\",\n\"name\": \"Private Secured\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n],\n\"components\": [\n{\n\"id\": \"49\",\n\"name\": \"Custom VPC\",\n\"type\": \"empty-component\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n},\n\"representations\": [\n{\n\"name\": \"Custom VPC Representation\",\n\"id\": \"49-representation\",\n\"representation\": \"VISIO-diagram\",\n\"size\": { // (6)!\n\"width\": 246,\n\"height\": 256\n},\n\"position\": { // (7)!\n\"x\": 361,\n\"y\": 31\n}\n}\n]\n},\n{\n\"id\": \"1\",\n\"name\": \"Amazon EC2\",\n\"type\": \"ec2\",\n\"parent\": {\n\"component\": \"49\"\n},\n\"representations\": [\n{ // (8)!\n\"name\": \"Amazon EC2 Representation\",\n\"id\": \"1-representation\",\n\"representation\": \"VISIO-diagram\",\n\"size\": {\n\"width\": 82,\n\"height\": 82\n},\n\"position\": { \"x\": 82,\n\"y\": 25\n}\n}\n]\n},\n{ // (9)!\n\"id\": \"30\",\n\"name\": \"Private Database\",\n\"type\": \"rds\",\n\"parent\": {\n\"trustZone\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\"\n}\n},\n{\n\"id\": \"41\",\n\"name\": \"Custom log system\",\n\"type\": \"cloudwatch\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n},\n\"representations\": [\n{ // (10)!\n\"name\": \"Custom log system Representation\",\n\"id\": \"41-representation\",\n\"representation\": \"VISIO-diagram\",\n\"size\": {\n\"width\": 82,\n\"height\": 82\n},\n\"position\": {\n\"x\": 443,\n\"y\": 370\n}\n}\n]\n},\n{\n\"id\": \"69\",\n\"name\": \"Custom enterprise GW\",\n\"type\": \"api-gateway\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n},\n\"representations\": [\n{ // (11)!\n\"name\": \"Custom enterprise GW Representation\",\n\"id\": \"69-representation\",\n\"representation\": \"VISIO-diagram\",\n\"size\": {\n\"width\": 171,\n\"height\": 171\n},\n\"position\": {\n\"x\": 28,\n\"y\": 128\n}\n}\n]\n}\n],\n\"dataflows\": [ // (12)!\n{\n\"id\": \"17\",\n\"name\": \"fe940e8c-f9ec-4a58-a555-5ef4119e97b6\",\n\"source\": \"1\",\n\"destination\": \"41\"\n},\n{\n\"id\": \"34\",\n\"name\": \"0b3f1707-1a91-44b8-bb06-5bfd7617e315\",\n\"source\": \"1\",\n\"destination\": \"30\"\n},\n{\n\"id\": \"70\",\n\"name\": \"16f21508-d45f-4beb-aa59-7189264e5385\",\n\"source\": \"69\",\n\"destination\": \"1\"\n}\n]\n} </code></pre> <ol> <li>A diagram representation for the Visio source.</li> <li>The size of the diagram is based on its components.</li> <li>Absolute position based on the main diagram canvas.</li> <li>Reference to the diagram representation id.</li> <li>No representation for boundary TrustZone.</li> <li>The dimensions are based in the width and height of the rectangle.</li> <li>Relative position to the parent TrustZone.</li> <li>Relative representation to the parent VPC.</li> <li>No representation because it belongs to a boundary TrustZone.</li> <li>Relative representation to the parent TrustZone.</li> <li>Relative representation to the parent TrustZone calculated from its rectangle envelope.</li> <li>No representations for Dataflows.</li> </ol>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/","title":"Visio TrustZones Mapping","text":""},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#visio-shapes-context","title":"Visio shapes context","text":"<p>Trustzones in a Visio diagram can be represented in different ways and, in each of them, it does not exist a perfect  method to unambiguously identify the TrustZone to which a component belongs. This page pretends to clarify the  different  mechanisms used by StartLeft to identify TrustZones and assign components to them during the Visio diagram parsing  to an Open Threat Model (OTM).</p>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#use-of-shapely-polygons","title":"Use of shapely Polygons","text":"<p>Visio diagrams only have two ways to relate shapes:</p> <ul> <li>Connectors between shapes, that are used to create OTM dataflows.</li> </ul> <p></p> <ul> <li>Grouped shapes. This may be useful in some circumstances, but grouping shapes is a decision of the person that is   creating the diagram, so we cannot trust on that to perform generic processing.</li> </ul> <p></p> <p>These two features are not enought for the processings we need to do. Along this document, we will see that we need to  identify relationships between the shapes (inheritance, zones definition, etc.). For that reason, at the moment of  loading the Visio diagram, we use the Visio library <code>shapely</code> to create a simplified representation of each shape, so we  can then perform more or less complex operation with that representation model.</p> <p>This would be an example of a Visio diagram and the simplified model we generate:</p> <p></p> <p>The shapely object we use for the Visio shapes representation is the Polygon and an extensive manual of how to manipulate  those objects can be found here.</p>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#trustzone-identification","title":"TrustZone identification","text":"<p>We have two ways to identify TrustZones in a Visio diagram that are described below. However, it is important to notice  that, regardless of the type of TrustZone calculation, no TrustZone will be included in the OTM if it does not appear in  the mapping file. If some TrustZone candidate is identified in the Visio diagram, but it is not in the mapping file,  the TrustZone will be ignored or processed as a normal component depending on the case.</p>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#parent-shape-trustzone","title":"Parent Shape TrustZone","text":"<p>One shape that has no parent in the Visio diagram and that appears in the mapping file is considered a TrustZone.  It is the case of this example:</p> <p></p> <p>The TrustZone identification is based on the parent calculation. Notice that a component may belong directly to a  TrustZone, but also be nested into another component. Anyway, each shape must have a parent, so, for each of them, we  perform the following steps:</p> <ol> <li>We check if the shape is contained into another. If so, that shape is its parent.</li> <li>If a shape is not contained in any other, there are two options:<ol> <li>If it is mapped as a TrustZone in the mapping file, it is a TrustZone.</li> <li>If not, it is a component whose parent is the default TrustZone.</li> </ol> </li> </ol> <p>As stated before, Visio does not provide information about if a shape is over or \u201cbelongs to\u201c another one. To solve this,  we use the shapely\u2019s <code>Polygon</code> representations of each shape. For each shape, we check if it is contained in another one  by using the shapely\u2019s <code>Polygon</code>'s function <code>contains(Polygon) -&gt; bool</code>. This function lets us know if some shape contains  another.</p>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#nested-components","title":"Nested components","text":"<p>Nested components are a special case where more than one shapes will return True when calling the <code>contains</code> function.</p> <p></p> <p>In the example above, the <code>Public Cloud</code> and <code>Custom VPC</code> contain the <code>Some ec2</code> shape. In this case we use the <code>Polygon</code>'s  function area. The parent shape is the one with the smallest area, that is, the <code>Custom VPC</code>. Then, the Custom VPC is only  contained in the <code>Public Cloud</code>, so it is selected as its parent. Finally, the <code>Public Cloud</code> is not contained by any  shape, and it is mapped as TrustZone in the mapping file, so it is converted into one.</p>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#boundary-trustzone","title":"Boundary TrustZone","text":"<p>Note: The tangent would be more precise than the secant, but given that its center point is more difficult to  extract from the Visio data, we use the secant, whose calculations should be also valid for other types or arcs,  like elliptical ones.</p> <p>Boundaries are the most common way to delimite TrustZones in a threat model. However, their graphic representation is  more lax than the nested shapes, because they simply use arcs to define zones in the diagram. For example:</p> <p></p> <p>In this case, we need to use the arcs that define the boundaries to generate different zones in the diagram  and then  check the shapes that belong to those zones. Anyway, do not forget that, if a TrustZone is not in the mapping file, it  will not be generated. In case of boundary TrustZones, they will simply be ignored.</p>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#supported-types-of-arcs","title":"Supported types of arcs","text":"<p>Note: This is a relevant limitation.</p> <p>There are several types of shapes that could be used to determine boundaries in the diagram, and we will need to evolve  StartLeft to support them. Currently, we only support the Curved shape Visio type to process TrustZones. It may be evolved in the future in order to include more types of connectors.</p>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#zones-calculation","title":"Zones calculation","text":"<p>To build the diagram zones from the arc shapes, we generate internal components based on the intersection of the secant  of the boundary arcs with the diagram limits:</p> <p></p> <p>Once we have these special zone components calculated, they are inserted in the usual parent calculation process  described above. However, there are two particularities with them:</p> <ol> <li>A zone component can only be mapped to a TrustZone. If there is no TrustZone to match it in the mapping file, it is  simply ignored and not transformed in a normal component.</li> <li>If two zone components are overlapped and a shape belongs to both, we cannot use here the area criteria to decide     because it is not relevant. Instead of it, we use the shapely <code>Polygon</code>'s function centroid,  that returns a <code>Point</code>     representing the center of the generated component. Then we also get the center of the child shape and, using the    <code>Point</code>'s <code>distance</code> function, we choose the zone whose center is closer to the shape\u2019s one.</li> </ol>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#zone-component-building-details","title":"Zone component building details","text":"<p>TL;DR: This is a very low level section, feel free to skip it if you want, since the more relevant info about  TrustZone mappings can be understood without this level of detail.</p> <p>To build the zone components, we use three properties of the Visio arc shape (aka. Curved panel):</p> <ul> <li><code>Shape/Cell['PinX']</code>: X coordinate of the center of the arc shape.</li> <li><code>Shape/Cell['PinY']</code>: Y coordinate of the center of the arc shape.</li> <li><code>Shape/Cell['Angle']</code>: Angle of rotation of the shape.</li> </ul> <p>Represented in Visio, these properties would be:</p> <p></p> <p>Apart from this data, during the main parsing process of the shapes, we keep track of its position in order to calculate  the borders of the diagrams, that are essential for the calculations described below.</p> <p>Angle normalization</p> <p>The first step of the process is translating the Visio angle from the [-pi, pi] range to (0, 2pi] to simplify further  calculations using the following expression: <code>angle = angle + 2*pi if angle &lt; 0</code></p> <p>Note: Notice that Visio angles are given in radians and so that is how they are processed in StartLeft.</p> <p>Once we have the angle normalized, there are two possible cases. The first one is when we have a perfectly vertical or  horizontal secant. In this case, we will build a quadrant component (the Private Secured Cloud on the first example of  this section). The second case is when the secant is sloped with a certain angle, and we need to calculate the  intersection using the formula of the line (the other two cases in the example).</p> <p>Quadrant building</p> <p>This is the simplest case. We only have to know the orientation of the arc and then build the quadrant based on  the X or Y value depending on the case. The correspondences between the four possible orientations and the  normalized Visio angle are the following:</p> <ul> <li>UPPER: pi / 4 radians</li> <li>LOWER:  (5 / 4) * pi radians</li> <li>LEFT: (3 / 4) * pi radians</li> <li>RIGHT: (7 / 4) * pi radians</li> </ul> <p>For each of these orientations, we have a function to determine the points of the <code>Polygon</code> we have to build:</p> <ul> <li>UPPER: <code>[(x_floor, y), (x_floor, y_top), (x_top, y_top), (x_top, y)]</code> </li> <li>LOWER: <code>[(x_floor, y_floor), (x_floor, y), (x_top, y), (x_top, y_floor)])</code> </li> <li>LEFT: <code>[(x_floor, y_floor), (x_floor, y_top), (x, y_top), (x, y_floor)])</code> </li> <li>RIGHT: <code>[(x, y_floor), (x, y_top), (x_top, y_top), (x_top, y_floor)])</code> </li> </ul> <p>Irregular zone building</p> <p>In this case we have to calculate the formula of the secant line in order to calculate the point of intersection  with the borders of the diagram. For that, the first step is getting the line angle. Notice that it is different from  the Visio shape angle. For example, in the previous arc figure, the shape angle is pi/4 radians and the secant  angle is 0 radians. To get the real angle, we need to perform the following calculation:</p> <pre><code>def calc_slope_angle(angle):\nslope_angle = angle - pi / 4\nif slope_angle &lt; 0:\nslope_angle = slope_angle + 2 * pi\nif slope_angle &gt; pi:\nslope_angle = slope_angle - pi\nreturn slope_angle\n</code></pre> <p>Then, we calculate the slope with the tangent: <code>slope = tan(slope_angle)</code></p> <p>Once we have the slope and some point (the <code>PinX</code>, <code>PinY</code> coordinates), we can already calculate the formulas for  getting the Y value from the X and viceversa.</p> <pre><code>def calc_y_formula(slope: float, any_line_point: tuple):\nreturn lambda x: x * slope - any_line_point[0] * slope + any_line_point[1]\ndef calc_x_formula(slope: float, any_line_point: tuple):\nreturn lambda y: y / slope + any_line_point[0] - (any_line_point[1] / slope)\n</code></pre> <p>From this point on, the process is similar to the quadrant. In the first place, we need to determine the orientation of the arc:</p> <ul> <li>UPPER_LEFT: <code>pi / 4 &lt;= angle &lt;= (3 / 4) * pi</code> </li> <li>UPPER_RIGHT: <code>0 &lt;= angle &lt;= pi / 4 or (7 / 4) * pi &lt;= angle &lt;= 2 * pi</code> </li> <li>LOWER_LEFT: <code>(3 / 4) * pi &lt;= angle &lt;= (5 / 4) * pi</code> </li> <li>LOWER_RIGHT: <code>(5 / 4) * pi &lt;= angle &lt;= (7 / 4) * pi</code></li> </ul> <p>With the orientation and the x and y formulas, we already have all the necessary to build the <code>Polygon</code> from the  intersection of the line with the diagram borders. In this case, the functions are a little more complex because,  depending on how big the diagram is and what is the angle of the arc, the zone can be a triangle or a quadrilateral. To keep this document simpler, the functions are omitted, but they can be checked out in the <code>slp_visio</code>\u2019s  <code>irregular_zones.py</code> file.</p>"},{"location":"startleft-processors/diagram/Visio-TrustZones-Mapping/#limitations","title":"Limitations","text":"<p>Currently, there are a couple of significant limitations to take into account regarding the trustzone identification:</p> <ul> <li>In boundary TrustZones, if a shape is located between the secant and the arc itself, it is not considered part of  the TrustZone.</li> <li>We only support Visio\u2019s Curved Panel to process boundary TrustZones.</li> </ul>"},{"location":"startleft-processors/diagram/legacy/Legacy-Mapping-File-Format/","title":"Legacy Mapping File Format","text":""},{"location":"startleft-processors/diagram/legacy/Legacy-Mapping-File-Format/#mapping-file-legacy-format","title":"Mapping file legacy format","text":"<p>Due to a backward compatibility StartLeft accepts the legacy mapping file format. For the current mapping file format, please read Visio-Mapping</p> <p>Unlike the new mapping file format, the legacy one had the id field,  with the identifier of the trust zone type.</p> <p>Legacy format example: <pre><code>trustzones:\n- label:  Public Cloud\ntype:   Public Cloud\nid:     b61d6911-338d-46a8-9f39-8dcd24abfe91\n</code></pre></p> <p>When a shape is found in the Visio file whose name matches the mapping's label, then a Trustzone is created in the OTM with these fields: - id is the original id in the Visio file - name is the original name in the Visio file - type is the mapping's id, if present. If not, will be the mapping's type</p> <p>In the above example the resultant OTM would contain a TrustZone like this: <pre><code>{\n\"trustZones\": [\n{\n\"id\": \"47\",\n\"name\": \"My Public Cloud\",\n\"type\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n]\n}\n</code></pre></p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/","title":"MTMT mapping","text":"<p>A source mapping file (or 'mapping file' for short) describe how to identify components, dataflows, TrustZones,  threats and mitigations in source file and how to map them to the OTM equivalent.</p> <p>Let's see how to identify the different elements:</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#trustzones","title":"Trustzones","text":"<p>For the TrustZones we need to write two fields: <code>label</code> and <code>id</code></p> <p>The label will identify the MTMT TrustZone by its type. </p> <p>Let's see an example with a TrustZone in the MTMT_example.tm7:</p> <p></p> <p>Our TrustZone named <code>Internet</code> is of <code>Generic Trust Border Boundary</code> type.</p> <p></p> <p>So we need to put this type in the label value.</p> <p>The type in the mapping file will be the type in the OTM trust zone output. In this example, the <code>Generic Trust Border Boundary</code> source trust zones will be mapped to a OTM trust zone which type will be the value of the <code>type</code> in our mapping file.</p> <pre><code>  - label: Generic Trust Border Boundary\ntype:  6376d53e-6461-412b-8e04-7b3fe2b397de\n</code></pre> <p>In the OTM each trust zone will have a unique id and the type will be the type that we put in the mapping file</p> <p>The TrustZone OTM output will be: <pre><code>  {\"trustZones\": [\n{\n\"id\": \"7537441a-1c03-48c0-b9c8-f82d5906c139\",\n\"name\": \"Internet\",\n\"type\": \"6376d53e-6461-412b-8e04-7b3fe2b397de\",\n\"risk\": {\n\"trustRating\": 10\n},\n\"properties\": {\n\"Name\": \"Internet\"\n}\n}]}\n</code></pre></p> <p>In case we have two trust zones with the same type, the OTM will have two trust zones with the same type but different id. In the mapping file is enough having mapped once: <pre><code>  - label: Generic Trust Border Boundary\ntype: 6376d53e-6461-412b-8e04-7b3fe2b397de\n</code></pre></p> <p>With two trust zones of the same type the OTM output will be: <pre><code>  {\"trustZones\": [\n{\n\"id\": \"7537441a-1c03-48c0-b9c8-f82d5906c139\",\n\"name\": \"Internet\",\n\"type\": \"6376d53e-6461-412b-8e04-7b3fe2b397de\",\n\"risk\": {\n\"trustRating\": 10\n},\n\"properties\": {\n\"Name\": \"Internet\"\n}\n},\n{\n\"id\": \"bd837730-6a59-11ed-a798-772dcc832e1d\",\n\"name\": \"Public zone\",\n\"type\": \"6376d53e-6461-412b-8e04-7b3fe2b397de\",\n\"risk\": {\n\"trustRating\": 10\n},\n\"properties\": {\n\"Name\": \"Public zone\"\n}\n}\n]}\n</code></pre> The id of the trust zone in the OTM will be the MTMT original component id in the source file</p> <p>Due to a backward compatibility StartLeft accepts as well the legacy mapping file format. Please read Legacy-Mapping-File-Format</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#components","title":"Components","text":"<p>For the components we need to write two fields: <code>label</code> and <code>type</code>.</p> <p>The label will identify the MTMT component by its MTMT type. Let's see again the MTMT_example.tm7:</p> <p></p> <p>Our <code>Public API v2</code> component is of <code>Web API</code> type.</p> <p></p> <p>So we need to put this type in the label value.</p> <p>The <code>type</code> in the mapping file will be the type in the OTM component output.</p> <pre><code>  - label: Web API\ntype: web-service\n</code></pre> <p>The component OTM output will be: <pre><code>  {\"components\": [\n{\n\"id\": \"5d15323e-3729-4694-87b1-181c90af5045\",\n\"name\": \"Public API v2\",\n\"type\": \"web-service\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n},\n\"properties\": {\n\"Name\": \"Public API v2\"\n}\n}]}\n</code></pre> As you can see, the OTM component name is coming from the custom name in the MTMT, in our case <code>Public API v2</code>.</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#mobile-client-component","title":"Mobile Client Component","text":"<p>The <code>Mobile Client</code> component is a special case that needs a little customization in the mapping file.</p> <p></p> <p>Because from the threat modeling point of view is not the same an Android than a iOS, we need to know which type of component is based in its <code>Mobile Client Tecnologies</code> property configured in the mapping file. Let's see how to do it: <pre><code>  - label: Mobile Client\nkey: Mobile Client Technologies\nvalues:\n- value: Android\ntype: android-device-client\n- value: iOS\ntype: ios-device-client\n</code></pre> - The <code>label</code> is the component type - The <code>key</code> is the property of the component where we are going to extract the value - The <code>values</code> is a map to convert from the MTMT <code>value</code> of the property to the OTM <code>type</code></p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#dataflows","title":"Dataflows","text":"<p>No need to be in the mapping file. StartLeft will detect them and will fill the OTM dataflow automatically detecting the custom name, the source, and the destination.</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#threats-and-mitigations","title":"Threats and Mitigations","text":"<p>No need to be in the mapping file.</p> <p>StartLeft will extract OTM threats and threat instances, as well as OTM mitigations and mitigation instances from the same MTMT threat. Moreover, the OTM component to which the OTM threat instance will be added is the destination component of the MTMT threat.</p> <p>Currently, Startleft maps threats and mitigations from two kinds of templates:</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#sdl-tm-knowledge-base-core-template","title":"SDL TM Knowledge Base (Core) template","text":""},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#a-mtmt-threat","title":"A MTMT threat","text":"<p>will be mapped to an OTM threat:</p> <pre><code>{\n\"name\": \"Web Application Process Memory Tampered\",\n\"id\": \"30\",\n\"categories\": [\n\"Tampering\"\n],\n\"risk\": {\n\"likelihood\": 100,\n\"impact\": 100\n},\n\"description\": \"If Web Application is given access to memory, such as shared memory or pointers, or is given the ability to control what Web Service executes (for example, passing back a function pointer.), then Web Application can tamper with Web Service\"\n}\n</code></pre> <p>to an OTM mitigation:</p> <pre><code>{\n\"name\": \"Consider if the function could work with less access to memory, such as passing data rather than pointers\",\n\"id\": \"30\",\n\"riskReduction\": 100,\n\"description\": \"Consider if the function could work with less access to memory, such as passing data rather than pointers. Copy in data provided, and then validate it\"\n}\n</code></pre> <p>and also to an OTM threat instance along with its OTM mitigation instance, which will be mapped to the corresponding  OTM component:</p> <pre><code>{\n\"threat\": \"30\",\n\"state\": \"AutoGenerated\",\n\"mitigations\": [\n{\n\"mitigation\": \"30\",\n\"state\": \"RECOMMENDED\"\n}\n]\n}\n</code></pre> <p>There is a special case when the MTMT threat has no \". Consider\" pattern in the \"Description\" field. In such case, no OTM mitigation nor OTM mitigation instance will be mapped, only the OTM threat and threat instance can be mapped.</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#azure-threat-model-template-azurearchitecture-template","title":"Azure Threat Model Template (AzureArchitecture) template","text":""},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#a-mtmt-threat-without-a-steps-field","title":"A MTMT threat without a \"Steps\" field","text":"<p>will be mapped to an OTM threat:</p> <pre><code>{\n\"name\": \"An adversary may read and/or tamper with the data transmitted to Azure Postgres DB due to weak configuration\",\n\"id\": \"1\",\n\"categories\": [\n\"Tampering\"\n],\n\"risk\": {\n\"likelihood\": 100,\n\"impact\": 100\n},\n\"description\": \"An adversary may read and/or tamper with the data transmitted to Accounting PostgreSQL due to weak configuration\"\n}\n</code></pre> <p>to an OTM Mitigation:</p> <pre><code>{\n\"name\": \"Enforce communication between clients and Azure Postgres DB to be over SSL/TLS by enabling the Enforce SSL connection feature on the server\",\n\"id\": \"1\",\n\"riskReduction\": 100,\n\"description\": \"Enforce communication between clients and Azure Postgres DB to be over SSL/TLS by enabling the Enforce SSL connection feature on the server. Check that the connection strings used to connect to MySQL databases have the right configuration (e.g. ssl = true or sslmode=require or sslmode=true are set). Refer: &lt;a href=\\\"https://aka.ms/tmt-th154a\\\"&gt;https://aka.ms/tmt-th154a&lt;/a&gt; Configure MySQL server to use a verifiable SSL certificate (needed for SSL/TLS communication). Refer: &lt;a href=\\\"https://aka.ms/tmt-th154b\\\"&gt;https://aka.ms/tmt-th154b&lt;/a&gt;\"\n}\n</code></pre>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Mapping/#a-mtmt-threat-with-a-steps-field","title":"A MTMT threat with a \"Steps\" field","text":"<p>will be mapped to an OTM threat:</p> <pre><code>{\n\"name\": \"An adversary can access Azure storage blobs and containers anonymously\",\n\"id\": \"27\",\n\"categories\": [\n\"Spoofing\"\n],\n\"risk\": {\n\"likelihood\": 100,\n\"impact\": 100\n},\n\"description\": \"An adversary can gain access to Azure storage containers and blobs if anonymous access is provided to potentially sensitive data accidentally\"\n}\n</code></pre> <p>to an OTM mitigation:</p> <pre><code>{\n\"name\": \"Ensure that only the required containers and blobs are given anonymous read access\",\n\"id\": \"27\",\n\"riskReduction\": 100,\n\"description\": \"By default, a container and any blobs within it may be accessed only by the owner of the storage account. To give anonymous users read permissions to a container and its blobs, one can set the container permissions to allow public access. Anonymous users can read blobs within a publicly accessible container without authenticating the request. Containers provide the following options for managing container access: Full public read access: Container and blob data can be read via anonymous request. Clients can enumerate blobs within the container via anonymous request, but cannot enumerate containers within the storage account. Public read access for blobs only: Blob data within this container can be read via anonymous request, but container data is not available. Clients cannot enumerate blobs within the container via anonymous request No public read access: Container and blob data can be read by the account owner only Anonymous access is best for scenarios where certain blobs should always be available for anonymous read access. For finer-grained control, one can create a shared access signature, which enables to delegate restricted access using different permissions and over a specified time interval. Ensure that containers and blobs, which may potentially contain sensitive data, are not given anonymous access accidentally\"\n}\n</code></pre> <p>and, in both cases, also to an OTM threat instance along with its OTM mitigation instance, which will be mapped to  the corresponding OTM component:</p> <pre><code>{\n\"threat\": \"27\",\n\"state\": \"AutoGenerated\",\n\"mitigations\": [\n{\n\"mitigation\": \"27\",\n\"state\": \"RECOMMENDED\"\n}\n]\n}\n</code></pre>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/","title":"MTMT Quickstart","text":""},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#what-is-mtmt","title":"What is MTMT?","text":"<p>From the official Microsoft Threat Model Tool page:</p> <p>The Threat Modeling Tool is a core element of the Microsoft Security Development Lifecycle (SDL).  It allows software architects to identify and mitigate potential security issues.</p> <p>From the point of view of StartLeft, a MTMT file is an external threat model (external because is not OTM) input source which has information about:</p> <ul> <li>The diagram: With stencils, TrustZones and dataflows, their relationships and their visual representation.</li> <li>The threats.</li> <li>The mitigations.</li> </ul> <p>In Starleft we have available the slp_mtmt processor to import a MTM file.</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#the-slp_mtmt-processor","title":"The <code>slp_mtmt</code> processor","text":"<p>The <code>slp_mtmt</code> module is the StartLeft Processor responsible for processing MTMT files into OTM. Its operation is based on a mapping file that enables the users to define the translations between:</p> <ul> <li>The source stencils types and the OTM components output.</li> <li>The source TrustZones and the OTM TrustZones output.</li> </ul> <p>Once you got familiarized with the basics explained in this page, you will need to know more about how to use the processor in order to create the mapping file for a successful conversion from MTMT to OTM.  For that, you should take a look to this page:</p> <ul> <li>Detailed information about how to build your own mapping files in the   MTMT mapping page.</li> </ul>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#a-basic-example","title":"A basic example","text":"<p>This is a very basic threat model example from MTMT that you can use as source_file to test the endpoint</p> <p></p> <p>You can find the source  MTMT_example.tm7  file inside the examples directory</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#mtmt-support","title":"MTMT support","text":"<p>For MTMT we have available this endpoint <pre><code>POST /api/v1/startleft/external-threat-model\nRequest Body:\n    source_file:                Required. File that contains the original threat model\n    source_type:                Required. Type of source file: MTMT\n    id:                         Required. ID of the new project\n    name:                       Required. Name of the new project\n    default_mapping_file:       Required. File that contains the default mapping file between the diagram resources and threat model resources\n</code></pre></p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#mtmt-file","title":"MTMT file","text":"<p>The <code>source_file</code> field must contain a valid tm7 file.</p> <p>StartLeft supports only the <code>tm7</code> format for Microsoft Threat Modeling Tool. </p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#default-mapping-file","title":"Default mapping file","text":"<p>The aim of this mapping file is to map the MTMT elements from templates such as the Azure template. To know how to build your own mapping-file, please read MTMT-Mapping</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#cli","title":"CLI","text":"<p>Note: Before continue, make sure you have StartLeft properly installed in your machine.</p> <p>First of all, retrieve all the necessary files:</p> <ul> <li>Download the <code>MTMT_example.tm7</code> and <code>mtmt_default_mapping_example.yaml files</code> from here.</li> </ul> <p>Now we are going to execute StartLeft for these files so that a <code>basic-mtmt-example.otm</code> file will be generated in  our working directory.</p> <pre><code>startleft parse \\\n--etm-type MTMT \\\n--default-mapping-file mtmt_default_mapping_example.yaml \\\n--output-file basic-mtmt-example.otm \\\n--project-id \"my-mtmt\" \\\n--project-name \"My MTMT Basic Example\" \\\nMTMT_example.tm7\n</code></pre>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#curl","title":"cURL","text":"<p>For work with the API, in first place we need to have StartLeft properly installed</p> <p>After that, set up the server with the command: <pre><code>startleft server\n</code></pre></p> <p>If you want to run the server in a specific port, you can do: <pre><code>startleft server -p 8080\n</code></pre></p> <p>Then, execute the following command to retrieve the OTM file with your MTMT file: <pre><code>curl --location --request POST localhost:5000/api/v1/startleft/external-threat-model \\\n--header \"Content-Type: multipart/form-data\" \\\n--header \"Accept: application/json\" \\\n--form source_type=\"MTMT\" \\\n--form source_file=@\"./MTMT_example.tm7\" \\\n--form default_mapping_file=@\"./mtmt_default_mapping_example.yaml\" \\\n--form id=\"my-mtmt-project\" \\\n--form name=\"My MTMT project\"\n</code></pre></p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-Quickstart/#position-of-the-elements","title":"Position of the elements","text":"<p>For details about how we map the position of the elements, please read  MTMT-elements-position.md. </p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-elements-position/","title":"MTMT elements position","text":"<p>StartLeft takes the position information from the border boundaries in order to represent the elements in the OTM at the same canvas position than the original.</p> <p>For this purpose we have:  - The Representation for the OTM.  - The RepresentationElement for the components and TrustZones.</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-elements-position/#otm","title":"OTM","text":"<p>In the representations of the OTM we are going to have a diagram representation, because MTMT has diagram relevant information, such the canvas size.  <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"Example Project\",\n\"id\": \"example-project\"\n},\n\"representations\": [\n{\n\"name\": \"Microsoft Threat Modeling Tool\",\n\"id\": \"Microsoft Threat Modeling Tool\",\n\"type\": \"threat-model\"\n},\n{\n\"name\": \"example-project Diagram Representation\",\n\"id\": \"example-project-diagram\",\n\"type\": \"diagram\",\n\"size\": {\n\"width\": 2000,\n\"height\": 2000\n}\n}\n]}\n</code></pre></p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-elements-position/#representation-fields","title":"Representation fields","text":"<ul> <li><code>name</code>: The name of this representation.</li> <li><code>id</code>: The unique id of this representation. This field will be the reference for the    TrustZones and components representations.</li> <li><code>type</code>: The representation supported type. See    representation-supported-types.</li> <li><code>size</code>: The canvas width and height.</li> </ul>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-elements-position/#trustzones","title":"TrustZones","text":"<p>The <code>representations</code> element has two properties for the position info:</p> <ul> <li><code>size</code></li> <li><code>position</code></li> </ul> <pre><code>   {\n\"representations\": [\n{\n\"name\": \"Cloud Representation\",\n\"id\": \"acafa4b0-f94d-4077-8a42-74b959bd0796-representation\",\n\"representation\": \"example-project-diagram\",\n\"size\": {\n\"width\": 535,\n\"height\": 488\n},\n\"position\": {\n\"x\": 734,\n\"y\": 88\n}\n}\n]\n}\n</code></pre>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-elements-position/#trustzone-representation-fields","title":"TrustZone representation fields","text":"<ul> <li><code>name</code>: The name of this representation.</li> <li><code>id</code>: The unique id of this representation.</li> <li><code>representation</code>: The id of the OTM representation explained before.</li> <li><code>size</code>: The width and height of the TrustZone.</li> <li><code>position</code>: The position relative to the canvas.</li> </ul> <p>This applies for the border boundaries TrustZones.</p> <p>The TrustZones delimited by a MTMT line boundary won't have representations because  its source size is undefined.</p>"},{"location":"startleft-processors/external-threat-model/mtmt/MTMT-elements-position/#components","title":"Components","text":"<p>Into the OTM components we have the <code>representations</code> property too, with the same fields as the TrustZone.</p> <p>The difference between the component representation and the TrustZone representation is the position.</p> <p>While at the TrustZones the position is relative to the canvas,  in the components the position is relative to the parent TrustZone. Here an example:</p> <pre><code>{\n\"components\": [\n{\n\"id\": \"53245f54-0656-4ede-a393-357aeaa2e20f\",\n\"name\": \"Accounting PostgreSQL\",\n\"type\": \"CD-MICROSOFT-AZURE-DB-POSTGRESQL\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n},\n\"properties\": {\n\"Name\": \"Accounting PostgreSQL\",\n\"Out Of Scope\": \"false\",\n\"Azure Postgres DB Firewall Settings\": \"Select\",\n\"Azure Postgres DB TLS Enforced\": \"Select\"\n},\n\"representations\": [\n{\n\"name\": \"Accounting PostgreSQL Representation\",\n\"id\": \"53245f54-0656-4ede-a393-357aeaa2e20f-representation\",\n\"representation\": \"example-project-diagram\",\n\"size\": {\n\"width\": 100,\n\"height\": 100\n},\n\"position\": {\n\"x\": 334,\n\"y\": 45\n}\n}\n]}\n]}\n</code></pre>"},{"location":"startleft-processors/external-threat-model/mtmt/legacy/Legacy-Mapping-File-Format/","title":"Legacy Mapping File Format","text":""},{"location":"startleft-processors/external-threat-model/mtmt/legacy/Legacy-Mapping-File-Format/#mapping-file-legacy-format","title":"Mapping file legacy format","text":"<p>Due to a backward compatibility StartLeft accepts the legacy mapping file format. For the current mapping file format, please read MTMT-Mapping</p> <p>Unlike the new mapping file format, the legacy one had the id field, with the identifier of the trust zone type.</p> <p>Legacy format example: <pre><code>trustzones:\n- label:  Generic Trust Border Boundary\ntype:   Public Cloud\nid:     6376d53e-6461-412b-8e04-7b3fe2b397de\n</code></pre></p> <p>When we found a <code>Generic Trust Border Boundary</code> in the MTMT file, then a Trustzone is created in the OTM with these fields: - id is the original id in the MTMT file - name is the original name in the MTMT file - type is the mapping's id, if present. If not, will be the mapping's type</p> <p>In the above example the resultant OTM would contain a TrustZone like this: <pre><code>  {\"trustZones\": [\n{\n\"id\": \"7537441a-1c03-48c0-b9c8-f82d5906c139\",\n\"name\": \"Internet\",\n\"type\": \"6376d53e-6461-412b-8e04-7b3fe2b397de\",\n\"risk\": {\n\"trustRating\": 10\n},\n\"properties\": {\n\"Name\": \"Internet\"\n}\n}]}\n</code></pre></p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Examples/","title":"CloudFormation Template examples","text":""},{"location":"startleft-processors/iac/cft/CloudFormation-Examples/#sources","title":"Sources","text":"<p>You can find some sample source files inside the <code>examples</code> directory:</p> <ul> <li><code>examples/cloudformation</code> contains CloudFormation Template example files to convert into OTM format.</li> <li><code>examples/cloudformation/split</code> contains a complete CloudFormation Template example file split into two different files.</li> </ul> <p>To process these examples, it is mandatory to use the mapping files according to the file data type.  You can find some sample mapping files inside the <code>examples/cloudformation</code> directory.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Examples/#examples","title":"Examples","text":"<p>CloudFormation is the AWS tool which lets you model, provision, and manage AWS and third-party resources by treating  infrastructure as code. StartLeft's repository contains an example CloudFormation mapping file that enables you to  generate threat models based on the OTM standard from both a single or multiple CloudFormation template files using  a single command.</p> <p>The following examples, which are located in the <code>examples/cloudformation</code> and <code>examples/cloudformation/split</code>  directories, show you how to carry out the different stages of the process separately or in a single step.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Examples/#security-groups-on-multinetwork-with-load-balancer","title":"Security Groups on multinetwork with Load Balancer","text":"<p>This is a rich example when you can see in action some the capabilities of StartLeft. It represents the threat model for an architecture with two TrustZones and several Virtual Private Networks which contain elements such as:</p> <ul> <li>Elastic Load Balancer.</li> <li>Elastic Container Service.</li> <li>CloudWatch Canary.</li> <li>VPC Endpoint</li> <li>Security Groups mapped as dataflows.</li> </ul> <p>The following command will parse the CloudFormation source file <code>multinetwork_security_groups_with_lb.json</code> creating an  OTM file <code>multinetwork_security_groups_with_lb.otm</code> in the process. <pre><code>startleft parse \\\n--iac-type CLOUDFORMATION \\\n--mapping-file iriusrisk-cft-mapping.yaml \\\n--output-file multinetwork_security_groups_with_lb.otm \\\n--project-name \"CFT MN Security Groups with LB\" \\\n--project-id \"cft-mn-sg-lb\" \\\nmultinetwork_security_groups_with_lb.json\n</code></pre></p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Examples/#other-examples","title":"Other examples","text":"<p>There are inside the StartLeft repositories some other CloudFormation files with different architectures that allow you  to experiment with different mappings and options. For them, the same commands described before can be applied.</p> <ul> <li><code>elb-no-waf</code>. This is the simplest example, including only a public cloud as a <code>TrustZone</code> with an AWS Elastic Load  Balancer as a single component.</li> <li><code>elb-with-waf</code>. Slight evolution of <code>elb-no-waf</code> by including another component, a Web Application Firewall, within  the same <code>TrustZone</code> public cloud.  </li> </ul>"},{"location":"startleft-processors/iac/cft/CloudFormation-Examples/#split-examples","title":"Split examples","text":"<p>In the <code>examples/cloudformation/split</code> directory we have split the <code>multinetwork_security_groups_with_lb.json</code> into two  files which are <code>networks_cft_file.json</code> and <code>resources_cft_file.json</code>. The following command will parse both CloudFormation source files creating an OTM file  <code>multinetwork_security_groups_with_lb_from_multiple_files.otm</code> in the process. <pre><code>startleft parse \\\n--iac-type CLOUDFORMATION \\\n--mapping-file iriusrisk-cft-mapping.yaml \\\n--output-file multinetwork_security_groups_with_lb_from_multiple_files.otm \\\n--project-name \"CFT MN Security Groups with LB from multiple files\" \\\n--project-id \"cft-mn-sg-lb-ml-fl\" \\\nnetworks_cft_file.json \\\nresources_cft_file.json\n</code></pre></p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/","title":"CloudFormation mapping","text":"<p>A source mapping file (or \"mapping files\" for short) describes how to find components, dataflows, and trustzones in source file data structures.</p> <p>To accomplish this, a mapping file contains additional logic around a collection of JMESPath queries which are used. Also, some exclusive StartLeft actions based on JMESPath may be used in mapping files to solve the most complex mappings.</p> <p>Source mapping files are made up of three main sections corresponding to the main sections in an OTM file, plus an optional lookup section described below:</p> <ul> <li>trustzones</li> <li>components</li> <li>dataflows</li> </ul> <p>Each contains a list of 0 or more objects that describe how to find the respective object in the source file, and each object has a number of required and optional fields. </p> <p>Take a look at the JSONSchema file for more details.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#jmespath-queries","title":"JMESPath Queries","text":"<p>Special $action fields begin with a dollar sign ($) and do not directly contribute to the OTM output. Instead, they specify an action and behaviour used to process the source files or generate the OTM output. </p> <p>This table describes each special $actions:</p> $action Description Example $source Specifies the source of the object type $source: $root JMESPath search through the entire source file data structure $root: \"Resources|squash(@)[?Type=='AWS::EC2::VPC']\" $path JMESPath search through the object identified in the $source. A default value is optional by using the $searchParams structure $path: \"Type\" $path: \"Properties.VpcId.Ref\"$path: {$searchParams:{ searchPath: \"Properties.SubnetId.Ref\", defaultValue: \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"}} $findFirst JMESPath search through the list of objects identified in the $source and returning the first successful match. A default value is optional by using the $searchParams structure $findFirst: [\"Properties.FunctionName.Ref\", \"Properties.FunctionName\"]  $findFirst: {$searchParams:{ searchPath: [\"Properties.SubnetId.Ref\",\"Properties.SubnetId\"], defaultValue: \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"}} $format A named format string based on the output of other $special fields. Note, only to be used for id fields. $format: \"{name}\" $catchall A sub-field of $source, specifying a default search for all other objects not explicitly defined $catchall: $skip A sub-field of $source, specifying specific objects to skip if not explicitly defined $skip: $singleton A sub-field of $source, specifying specific objects to be unified under a single component or trustzone $singleton: $numberOfSources When using singleton, allows you to set different values for output name or tags when the number of sources for the same mapping are single or multiple $numberOfSources: {oneSource:{$path: \"_key\"}, multipleSource:{ $format: \"CD-ACM (grouped)\" }} $altsource Specifies an alternative mapping when $source returns no object. $altsource:       - $mappingType: {$root: \"Resources|squash(@)[?Type=='AWS::EC2::VPCEndpoint']\"}         $mappingPath: {$path: \"Properties.ServiceName\"}         $mappingLookups:           - regex: ^(.*)s3$             name: S3 from VPCEndpoint             type: s3 $lookup Allows you to look up the output of a $special field against a key-value lookup table $lookup: $hub Only for dataflow's \"source\" and \"destination\" fields. Especially created for building dataflows from Security Group structures without generating components from them. Allows to define abstract contact points for larger end-to-end final dataflows destination: {$hub: {$path: \"Properties.GroupId\"}} $ip When defining a component's \"name\" field as $ip, will generate a singleton component for representing an external IP but without limitations of singleton for this case, so the \"type\" for the defined mapping definition with $ip (i.e. generic-terminal) will not be catalogued as singleton. name: { $ip: { $path: \"Properties.SecurityGroupEgress[0].CidrIp\" } } <p>For more information on how to create a JMESPath search query, check out the website.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#hardcoded-values","title":"Hardcoded values","text":"<p>In addition to using $source and other special $actions, you can also just hardcode values which will be taken and mapped as is. For example, you may want to specify a default trustzone which wouldn't be found anywhere in the source files. You can do this easily just by adding it to a mapping file:</p> <p><pre><code>trustzones:\n  - id:   tz1\n    name: Default\n    type: default-zone\n</code></pre> The <code>id</code> field uniquely identifies a trustzone, and differentiates it from other trustzones of the same type.</p> <p>For mapping trustzones to IriusRisk trustzones, <code>type</code> field must take internal IriusRisk values depending on the type of trustzone. These values are defined in the internal CloudFormation mapping file.</p> <p>For the purpose of preserving backwards compatibility, StartLeft also accepts the legacy mapping file format. In this format, there is no <code>type</code> field and the <code>id</code> will be used as both, ID and type.</p> <p>It is not possible to have multiple trustzones of the same type when using this format.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#lookup-table","title":"Lookup table","text":"<p>Just in case there are some inconsistencies in naming conventions used, and you need to be able to translate one name into another, a simple lookup key-value table section can be added to the mapping file.</p> <p>For example, if we have a situation where a subnet name is written using a short naming convention, but is actually referred to via a longer name elsewhere, we can use the $lookup action.</p> <pre><code>parent:\n  $lookup: {$path: \"Properties.Subnets[]|map(&amp;values(@), @)[]|map(&amp;re_sub('[:]', '-', @), @)\"}\n</code></pre> <p>If the above query returns a subnet called <code>shortnameA</code>, then it will be looked up in the below table:</p> <pre><code>lookup:\n  shortnameA: amuchlongernameA\n  shortnameB: amuchlongernameB\n</code></pre> <p>To give a final value of <code>amuchlongernameA</code>.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#additional-jmespath-functions","title":"Additional JMESPath functions","text":"<p>Parsing of IaC files may be sometimes complex, so that the built-in JMESPath described above are not enough. For those cases, a set of custom functions has been created to simplify and make more powerful the creation of mapping files.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#re_sub","title":"re_sub","text":"<p>The <code>re_sub</code> function replaces the occurrences of <code>pattern</code> with <code>replace</code> in the given <code>string</code>. </p> <pre><code>def _func_re_sub(self, pattern, replace, origin_string)\n</code></pre> <p>For example, we may want to replace colon characters with hyphens such as in <code>re_sub('[:]', '-', 'stack:subnet')</code>.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#squash","title":"squash","text":"<p>The <code>squash</code> function takes a nested object of objects, and squashes them into a list of objects, injecting the parent \"key\" to the child object as \"_key\".</p> <pre><code>def _func_squash(self, obj)\n</code></pre> <p>This function is specially useful for Cloudformation mapping files. These have a root <code>Resources</code> object whose  top level keys are the resource names which have the resource objects as values. This structure is hard to iterate over  without losing the important name key. So you can use squash and refer to the name through the <code>_key</code> field. </p> <pre><code>name:    {$path: \"_key\"}\n$source: {$root: \"Resources|squash(@)[?Type=='AWS::EC2::Subnet']\"}\n</code></pre>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#tail","title":"tail","text":"<p>The <code>tail</code> function returns the characters of a given <code>string</code> from the <code>count</code> index onwards. It is equivalent to python's <code>string[count:]</code>.</p> <pre><code>def _func_tail(self, string, count)\n</code></pre>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#get_starts_with","title":"get_starts_with","text":"<p>This function is equivalent to <code>get</code>, but instead of using the <code>component_type</code> argument to perform an exact filter, the target component type must start with it.</p> <pre><code>def _func_get_starts_with(self, obj_arr, component_type)\n</code></pre>"},{"location":"startleft-processors/iac/cft/CloudFormation-Mapping/#split","title":"split","text":"<p>The <code>split</code> function is the equivalent to the python's one. It breaks a given string based on a given separator and returns the resulting array of strings. It is equivalent to python's <code>split</code> function.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Quickstart/","title":"CloudFormation Quickstart","text":""},{"location":"startleft-processors/iac/cft/CloudFormation-Quickstart/#what-is-cloudformation","title":"What is CloudFormation?","text":"<p>From the official AWS CloudFormation page: </p> <p>AWS CloudFormation is a service that gives developers and businesses an easy way to create a collection of related AWS  and third-party resources, and provision and manage them in an orderly and predictable fashion.</p> <p>From the StartLeft's perspective, a CloudFormation Template (CFT) is a file that defines a set of components with  relationships among them which can be interpreted to create a threat model. </p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Quickstart/#the-slp_cft-module","title":"The <code>slp_cft</code> module","text":"<p>The <code>slp_cft</code> module is the StartLeft Processor responsible for converting CFT files into OTM. Its operation is based  on a mapping file that enables the users to define the translations between the source AWS types and the expected  output in the OTM file. </p> <p>Once you got familiarized with the basics explained on this page, you will need to know more about how to use and  customize the behavior of the processor in order to configure your own conversions. For that, you should take a look  at the CloudFormation mapping page, where you will find all the information you need, from  basic to advanced, to build your own CFT mapping files.</p> <p>Apart from this, you may also find interesting the generic usage manuals for the CLI  and REST API.</p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Quickstart/#a-basic-example","title":"A basic example","text":"<p>Let's suppose you have a CFT file with a single AWS::EC2:Instance like this:</p> <p></p> <p>Whose source code is:</p> <pre><code>{\n\"AWSTemplateFormatVersion\": \"2010-09-09\",\n\"Metadata\": {\n\"AWS::CloudFormation::Designer\": {\n\"a7e8649b-4100-4217-8aff-3342e0afa392\": {\n\"size\": {\n\"width\": 60,\n\"height\": 60\n},\n\"position\": {\n\"x\": 120,\n\"y\": 450\n},\n\"z\": 0,\n\"embeds\": []\n}\n}\n},\n\"Resources\": {\n\"MyEC2Instance\": {\n\"Type\": \"AWS::EC2::Instance\",\n\"Properties\": {},\n\"Metadata\": {\n\"AWS::CloudFormation::Designer\": {\n\"id\": \"a7e8649b-4100-4217-8aff-3342e0afa392\"\n}\n}\n}\n}\n}\n</code></pre> <p>And you want to translate it to OTM in order to import it into IriusRisk, whose  equivalent type for an EC2 instance is an <code>ec2</code> component and the expected resultant project should be like this:</p> <p></p> <p>In that case, you will need a mapping file which contains, at least, a TrustZone and the mapping for the EC2  component. Notice that the standard requires that all the components must have a parent, in this case, the Public  Cloud TrustZone. This mapping file could be as simple as this: <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\ncomponents:\n- id:     {$format: \"{name}\"}\ntype:   ec2\nname:   {$path: \"_key\"}\n$source: {$root: \"Resources|squash(@)[?Type=='AWS::EC2::Instance']\"}\nparent: public-cloud-01\ntags:\n- { $path: \"Type\" }\ndataflows: []\n</code></pre></p> <p>The combination of this CFT and mapping file will result in the OTM file below, that contains the mapped TrustZone  and component along with all the necessary metadata defined by the standard and that is ready to be imported into a  threat modeling tool like IriusRisk.</p> <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"My EC2 project\",\n\"id\": \"my-ec2-project\"\n},\n\"representations\": [\n{\n\"name\": \"CloudFormation\",\n\"id\": \"CloudFormation\",\n\"type\": \"code\"\n}\n],\n\"trustZones\": [\n{\n\"id\": \"public-cloud-01\",\n\"name\": \"Public Cloud\",\n\"type\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n],\n\"components\": [\n{\n\"id\": \"public-cloud-01.myec2instance\",\n\"name\": \"MyEC2Instance\",\n\"type\": \"ec2\",\n\"parent\": {\n\"trustZone\": \"public-cloud-01\"\n},\n\"tags\": [\n\"AWS::EC2::Instance\"\n]\n}\n],\n\"dataflows\": []\n}\n</code></pre>"},{"location":"startleft-processors/iac/cft/CloudFormation-Quickstart/#cli","title":"CLI","text":"<p>Note: Before continuing, make sure you have  StartLeft properly installed on your machine.</p> <p>Save the files above in your file system with these names:</p> <ul> <li><code>ec2-cft.json</code> for the CloudFormation Template file.</li> <li><code>ec2-mapping.yaml</code> for the mapping file.</li> </ul> <p>Now we are going to execute StartLeft for these files so that an <code>ec2.otm</code> file will be generated in our working  directory with identical contents to the one above. <pre><code>startleft parse \\\n--iac-type CLOUDFORMATION \\\n--mapping-file ec2-mapping.yaml \\\n--output-file ec2.otm \\\n--project-id \"my-ec2-project\" \\\n--project-name \"My EC2 project\" \\\nec2-cft.json\n</code></pre></p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Quickstart/#curl","title":"cURL","text":"<p>You can get the same result through the StartLeft's REST API. For that, in the first place we need to set up the  server with the command: <pre><code>startleft server\n</code></pre></p> <p>If you want to run the server in a specific port, you can do: <pre><code>startleft server -p 8080\n</code></pre></p> <p>Then, execute the following command to retrieve the OTM file with your EC2 component: <pre><code>curl --location --request POST localhost:5000/api/v1/startleft/iac \\\n--header \"Content-Type: multipart/form-data\" \\\n--header \"Accept: application/json\" \\\n--form iac_type=\"CLOUDFORMATION\" \\\n--form iac_file=@\"./ec2-cft.json\" \\\n--form mapping_file=@\"./ec2-mapping.yaml\" \\\n--form id=\"my-ec2-project\" \\\n--form name=\"My EC2 project\"\n</code></pre></p>"},{"location":"startleft-processors/iac/cft/CloudFormation-Quickstart/#more-examples","title":"More examples","text":"<p>The infrastructure built with CloudFormation Templates may be as complex as you want. This is the reason because  StartLeft, through the mapping files, is intended to be configurable, so you can extend or modify its behavior and/or  create your own mappings on demand.</p> <p>To help you to walk through more complex situations with larger CFT and mapping files, we have created a page with  explained CFT examples which may be useful for you as a base for building your own mapping  files.</p>"},{"location":"startleft-processors/iac/tf/Terraform-Examples/","title":"Terraform examples","text":""},{"location":"startleft-processors/iac/tf/Terraform-Examples/#sources","title":"Sources","text":"<p>You can find some sample source files inside the <code>examples</code> directory:</p> <ul> <li><code>examples/terraform</code> contains Terraform example files to convert into OTM format.</li> <li><code>examples/terraform/split</code> contains a complete Terraform example file split into two different files.</li> </ul> <p>To process this examples, it is mandatory to use the mapping files according to the file data type. You can find some sample mapping files inside the <code>examples/terraform</code> directory.</p>"},{"location":"startleft-processors/iac/tf/Terraform-Examples/#examples","title":"Examples","text":"<p>StartLeft supports parsing Terraform source files. Some examples are provided in the <code>examples/terraform</code> and <code>examples/terraform/split</code> directories.</p> <pre><code>startleft parse \\\n--iac-type TERRAFORM \\\n--mapping-file iriusrisk-tf-aws-mapping \\\n--output-file elb.otm \\\n--project-name \"Terraform ELB\" \\\n--project-id \"terraform-elb\" \\\nelb.tf\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-Quickstart/","title":"Terraform Quickstart","text":""},{"location":"startleft-processors/iac/tf/Terraform-Quickstart/#what-is-terraform","title":"What is Terraform?","text":"<p>From the official Terraform page: </p> <p>Terraform is an open-source infrastructure as code software tool that enables you to safely and predictably create,  change, and improve infrastructure.</p> <p>From the StartLeft's perspective, a Terraform (TF) defines a format to write files that define sets of components  with relationships among them which can be interpreted to create a threat model. </p>"},{"location":"startleft-processors/iac/tf/Terraform-Quickstart/#the-slp_tf-module","title":"The <code>slp_tf</code> module","text":"<p>The <code>slp_tf</code> module is the StartLeft Processor responsible for converting TF files into OTM. Its operation is based  on a mapping file that enables the users to define the translations between the source TF types and the expected  output in the OTM file. </p> <p>Once you got familiarized with the basics explained in this page, you will need to know more about how to use and  customize the behavior of the processor in order to configure your own conversions. For that, you should take a look  to the Terraform mapping page, where you will find all the information you need, from  basic to advanced, to build your own CFT mapping files.</p> <p>Apart from this, you may also find interesting the generic usage manuals for the CLI  and REST API.</p>"},{"location":"startleft-processors/iac/tf/Terraform-Quickstart/#a-basic-example","title":"A basic example","text":"<p>Let's suppose you have a TF file with a single  EC2 instance like this:</p> <pre><code>data \"aws_ami\" \"ubuntu\" {\nmost_recent = true\nfilter {\nname   = \"name\"\nvalues = [\"ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*\"]\n}\nfilter {\nname   = \"virtualization-type\"\nvalues = [\"hvm\"]\n}\nowners = [\"099720109477\"] # Canonical\n}\nresource \"aws_instance\" \"web\" {\nami           = data.aws_ami.ubuntu.id\ninstance_type = \"t3.micro\"\ntags = {\nName = \"HelloWorld\"\n}\n}\n</code></pre> <p>And you want to translate it to OTM in order to import it into IriusRisk, whose equivalent type for an EC2 instance is an <code>ec2</code> component and the expected resultant project should be like this:</p> <p></p> <p>In that case, you will need a mapping file that contains, at least, a TrustZone and the mapping for the EC2  component. Notice that the standard requires that all the components must have a parent, in this case, the Public  Cloud TrustZone is mapped as the default component's TrustZone. This mapping file could be as simple as this: <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        ec2\n$source:     {$type: \"aws_instance\"}\ndataflows: []\n</code></pre></p> <p>The combination of this TF and mapping file will result in the OTM file below, that contains the mapped TrustZone  and component along with all the necessary metadata defined by the standard and that is ready to be imported in a  threat modeling tool like IriusRisk.</p> <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"My EC2 project\",\n\"id\": \"my-ec2-project\"\n},\n\"representations\": [\n{\n\"name\": \"Terraform\",\n\"id\": \"Terraform\",\n\"type\": \"code\"\n}\n],\n\"trustZones\": [\n{\n\"id\": \"public-cloud-01\",\n\"name\": \"Public Cloud\",\n\"type\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n],\n\"components\": [\n{\n\"id\": \"public-cloud-01.aws_instance-web\",\n\"name\": \"web\",\n\"type\": \"ec2\",\n\"parent\": {\n\"trustZone\": \"public-cloud-01\"\n},\n\"tags\": [\n\"aws_instance\"\n]\n}\n],\n\"dataflows\": []\n}\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-Quickstart/#cli","title":"CLI","text":"<p>Note: Before continue, make sure you have  StartLeft properly installed in your machine.</p> <p>Save the files above in your file system with these names:</p> <ul> <li><code>ec2-tf.json</code> for the Terraform file.</li> <li><code>ec2-mapping.yaml</code> for the mapping file.</li> </ul> <p>Now we are going to execute StartLeft for these files so that an <code>ec2.otm</code> file will be generated in our working  directory with identical contents to the one above. <pre><code>startleft parse \\\n--iac-type TERRAFORM \\\n--mapping-file ec2-mapping.yaml \\\n--output-file ec2.otm \\\n--project-id \"my-ec2-project\" \\\n--project-name \"My EC2 project\" \\\nec2-tf.json\n</code></pre></p>"},{"location":"startleft-processors/iac/tf/Terraform-Quickstart/#curl","title":"cURL","text":"<p>You can get the same result if through the StartLeft's REST API. For that, in first place we need to set up the  server with the command: <pre><code>startleft server\n</code></pre></p> <p>Then, execute the following command to retrieve the OTM file with your EC2 component: <pre><code>curl --location --request POST localhost:5000/api/v1/startleft/iac \\\n--header \"Content-Type: multipart/form-data\" \\\n--header \"Accept: application/json\" \\\n--form iac_type=\"TERRAFORM\" \\\n--form iac_file=@\"./ec2-tf.json\" \\\n--form mapping_file=@\"./ec2-mapping.yaml\" \\\n--form id=\"my-ec2-project\" \\\n--form name=\"My EC2 project\"\n</code></pre></p>"},{"location":"startleft-processors/iac/tf/Terraform-Quickstart/#more-examples","title":"More examples","text":"<p>The infrastructure built with Terraform may be as complex as you want. This is the reason because  StartLeft, through the mapping files, is intended to be configurable, so you can extend or modify its behavior and/or  create your own mappings on demand.</p> <p>To help you to walk through more complex situations with larger Terraform and mapping files, we have created a page  with explained TF examples which may be useful for you as a base for build your own mapping  files.</p>"},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/","title":"Additional JMESPath functions","text":"<p>Parsing of IaC files may be sometimes complex, so that the built-in JMESPath functions are not enough. For that cases, a set of custom functions has been created to simplify and make more powerful the creation of mapping files.</p>"},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/#jmespath-functions","title":"JMESPath functions","text":""},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/#re_sub","title":"re_sub","text":"<p>The <code>re_sub</code> function replaces the occurrences of <code>pattern</code> with <code>replace</code> in the given <code>string</code>.</p> <pre><code>def _func_re_sub(self, pattern, replace, origin_string)\n</code></pre> <p>For example, we may want to replace colon characters with hyphens such as in <code>re_sub('[:]', '-', 'stack:subnet')</code>.</p>"},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/#squash_terraform","title":"squash_terraform","text":"<p>The <code>squash_terraform</code> function takes a nested object of objects, and squashes them into a list of objects, injecting  the parent \"key\" to the child object as \"_key\".</p> <pre><code>def _func_squash_terraform(self, obj)\n</code></pre> <p>These have a root <code>Resources</code> object whose top level keys are the resource names which have the resource objects as  values. This structure is hard to iterate over without losing the important name key. So you can use squash it and  refer to the name through the <code>_key</code> field.</p> <pre><code>name:    {$path: \"_key\"}\n$source: {$root: \"Resources|squash_terraform(@)[?Type=='aws_instance']\"}\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/#tail","title":"tail","text":"<p>The <code>tail</code> function returns the characters of a given <code>string</code> from the <code>count</code> index onwards. It is equivalent to python's <code>string[count:]</code>.</p> <pre><code>def _func_tail(self, string, count)\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/#get","title":"get","text":"<p>The <code>get</code> function takes a dictionary array of components whose root key is the type of the component. The other argument is a component type to filter the array. It returns a component dictionary whose root key is the name of the component that also includes a <code>Type</code> and a <code>_key</code> keys with the component type and the component name respectively.</p> <pre><code>def _func_get(self, obj_arr, component_type)\n</code></pre> <p>The <code>get</code> function is mainly used for Terraform mappings in order to retrieve components by their type. An example of its use is: <code>resource|get(@, 'aws_subnet')</code>.</p>"},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/#get_starts_with","title":"get_starts_with","text":"<p>This function is equivalent to <code>get</code>, but instead of using the <code>component_type</code> argument to perform an exact filter, the target component type must starts with it.</p> <pre><code>def _func_get_starts_with(self, obj_arr, component_type)\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/#split","title":"split","text":"<p>The <code>split</code> function is the equivalent to the python's one. It breaks a given string based on a given separator and returns the resulting array of strings. It is equivalent to python's <code>split</code> function.</p> <pre><code>def _func_split(self, string, separator)\n</code></pre> <p>For instance, this function is used in Terraform mappings to retrieve the name of a referenced component, whose naming structure is <code>component-type.component-name.some-field</code>. In this case, the name is retrieved as: <code>split(component, '.')[1]</code>.</p>"},{"location":"startleft-processors/iac/tf/Terraform-additional-jmespath-functions/#get_module_terraform","title":"get_module_terraform","text":"<p>The <code>get_module_terraform</code> function takes a dict array of Terraform modules (not resources) and a component type, which is the key to filter the array comparing against 'source' module property. Returns an OTM component dict whose root key is the name of the component that also includes a Type and a _key keys with the module type (AWS type) and the module name (custom name) respectively.</p> <pre><code>def _func_get_module_terraform(self, modules, module_type)\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/","title":"Domain-Specific Language","text":"<p>There is an available Terraform Domain-Specific Language for easy mapping behavior configuration. This Terraform-DSL can be split into two sections: Special Mapping Fields and Mapping functions.</p>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#special-mapping-fields","title":"SPECIAL MAPPING FIELDS","text":"<p>These functions begin with a dollar sign ($) and do not directly contribute to the OTM output.  Instead, they specify an action or behavior used to process the source files or generate the OTM output.</p> $functions Description Applies to $default Specifies the TrustZone as default TrustZones $source Specifies the source of the object type Components, TrustZones &amp; Dataflows $altsource Specifies an alternative mapping when $source returns no object. Components $children Specifies whose components are their children Components","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#default","title":"$default","text":"<p>This special mapping field default specifies a TrustZone as the default trustzone for the components in case those components don't define their parent.</p> <p>Applies to: TrustZones</p> <p> The components[].parent value is assigned by the attribute $default on the trustZones section.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        empty-component\n$source:     {$type:  \"aws_internet_gateway\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_internet_gateway\" \"InterneteGateway\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_internet_gateway-internetegateway\nname: InterneteGateway\ntype: empty-component\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_internet_gateway\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#source","title":"$source","text":"<p>This special mapping field source specifies the origin of the object type to be mapped. Its behavior is configured by the Terraform-DSL mapping functions to go through all the Terraform Resource files for returning the matching elements.</p> <p>Applies to: Components, TrustZones &amp; Dataflows</p> <p> This mapping specifies the source for the empty-component with the resources of type  <code>aws_internet_gateway</code>.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        empty-component\n$source:     {$type:  \"aws_internet_gateway\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_internet_gateway\" \"InterneteGateway\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_internet_gateway-internetegateway\nname: InterneteGateway\ntype: empty-component\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_internet_gateway\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#altsource","title":"$altsource","text":"<p>This special mapping field altsource specifies an alternative mapping when $source returns nothing.</p> <p>Applies to: Components</p> <p>Reference to Mapping an AltSource for deeper explanation</p>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#children","title":"$children","text":"<p>This special mapping field children specifies whose components are their children on the OTM,  it will set the parent attribute of those components on the OTM.</p> <p>Applies to: Components</p> <p>Reference to Mapping a Children for deeper explanation</p>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#mapping-functions","title":"MAPPING FUNCTIONS","text":"<p>These functions are used as parameters of the mapping attributes for configuring its behavior. </p> $functions Type Description $type filter Finds a resource by its type $name filter Finds a resource by its name $props filter Finds a resource by its properties $regex filter Specifies a custom regex to be matched by the given argument $root filter JMESPath search through the entire source file data structure $path accessor JMESPath search through the object identified in the $source. A default value is optional by using the <code>$searchParams</code>structure $findFirst selector JMESPath search through the list of objects identified in the <code>$source</code> and returns the first successful match. A default value is optional by using the <code>$searchParams</code> structure $searchParams selector Specifies a default value for $path or <code>$findFirst</code> mapping functions $singleton grouper Specific objects to be unified under a single component or TrustZone $numberOfSources selector When using a <code>$singleton</code>, it allows you to set different values for output name or tags when the number of sources for the same mapping is single or multiple $format formatter A named format string based on the output of other <code>$special</code> fields. $module filter Search through the module section matching by source's attribute $skip filter A sub-field of <code>$source</code>, specifying specific objects to skip if not explicitly defined $catchall filter A sub-field of <code>$source</code>, including any matching resource unless it is already found (as a more specific one) or if it has been skipped $lookup selector Allows you to look up the output of a $special field against a key-value lookup table $hub connector Only for dataflow's \"source\" and \"destination\" fields. Specially created for building dataflows from Security Group structures without generating components from them. Allows defining abstract contact points for larger end-to-end final dataflows $ip grouper When defining a component's \"name\" field as <code>$ip</code>, will generate a singleton component for representing an external IP but without limitations of singleton for this case, so the \"type\" for the defined mapping definition with <code>$ip</code> (i.e. generic-terminal) will not be catalogued as singleton","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#type","title":"$type","text":"<p>This mapping function type returns resources by their <code>resource_type</code> attribute on the  Terraform Source Dictionary. This function can be used combined with <code>$name</code> and <code>$props</code> to create a more complete query.  </p> Type Consumes Produces Configuration params filter A list of resources A resources list filtered by type Can be configured with a string, a list of strings or using the $regex mapping function <p> This mapping specifies the component rds by the resources of type in  (<code>aws_db_instance</code>,  <code>aws_rds_cluster</code>)</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:       rds\n$source:    {$type: [\"aws_db_instance\", \"aws_rds_cluster\"]}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_db_instance\" \"mysql\" {}\nresource \"aws_rds_cluster\" \"aurora-cluster-demo\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_db_instance-mysql\nname: mysql\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_db_instance\n- id: public-cloud-01.aws_rds_cluster-aurora_cluster_demo\nname: aurora-cluster-demo\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_rds_cluster\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#name","title":"$name","text":"<p>This mapping function name returns resources by their <code>resource_name</code> attribute on the  Terraform Source Dictionary. This function can be used combined with <code>$type</code> and <code>$props</code> to create a more complete query.</p> Type Consumes Produces Configuration params filter A list of resources A resources list filtered by name Can be configured with a string, a list of strings or using the $regex mapping function <p> This mapping specifies the component <code>rds</code> by the resources with name <code>mysql</code></p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:       rds\n$source:    {$name: \"mysql\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_db_instance\" \"mysql\" {}\nresource \"aws_rds_cluster\" \"aurora-cluster-demo\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_db_instance-mysql\nname: mysql\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_db_instance\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#props","title":"$props","text":"<p>This mapping function props returns resources by their <code>resource_properties</code> attribute on the  Terraform Source Dictionary. This function can be used combined with $type and $name to create a more complete query.</p> Type Consumes Produces Configuration params filter A list of resources A resources list filtered by its properties Can be configured with a string, a list of strings or using the $regex mapping function <p> This mapping specifies the component <code>generic-client</code> by the resources with type  <code>aws_security_group</code> having the property <code>egress[0].cidr_blocks</code>present in their <code>resource_properties</code></p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        generic-client\n$source:     {$type: \"aws_security_group\", $props: \"egress[0].cidr_blocks\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_security_group\" \"webserver\" {\negress {\ncidr_blocks      = [\"0.0.0.0/0\"]\n}\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_security_group-webserver\nname: webserver\ntype: generic-client\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_security_group\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#regex","title":"$regex","text":"<p>This mapping function regex allows configuring a custom regex to be matched against the resource attribute. This function can be used as a parameter for <code>$type</code>, <code>$name</code> and <code>$props</code>.  </p> Type Consumes Produces Configuration params filter A list of resources A resources list which attribute matches the regex A valid regex <p> This mapping specifies the component <code>api-gateway</code> by the resources with type  matching the regex <code>^aws_api_gateway_\\w*$</code></p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        api-gateway\n$source:     {$type: {$regex: ^aws_api_gateway_\\w*$}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_api_gateway_rest_api\" \"rest_api\" {}\nresource \"aws_api_gateway_authorizer\" \"api_authorizer\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_api_gateway_rest_api-rest_api\nname: rest_api\ntype: api-gateway\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_api_gateway_rest_api\n- id: public-cloud-01.aws_api_gateway_authorizer-api_authorizer\nname: api_authorizer\ntype: api-gateway\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_api_gateway_authorizer\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#root","title":"$root","text":"<p>This mapping function root allows to search through the entire source file data structure by using  JMESPath.</p> Type Consumes Produces Configuration params filter The entire source file A resources list filtered by the JMESpath query A JMESpath query <p> When using <code>$root</code>, it may be useful to use  Additional JMESPath functions. This map specifies the component  <code>vpc</code> by using the get JMESPath functions</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        vpc\n$source:     {$root: \"resource|get(@, 'aws_vpc')\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_vpc\" \"CustomVPC\" {\ncidr_block  = var.vpcCidrblock\n}\n</code></pre> <pre><code>---\notmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_vpc-customvpc\nname: CustomVPC\ntype: vpc\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_vpc\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#path","title":"$path","text":"<p>This mapping function path allows getting the values from the object identified in the <code>$source</code> by using  JMESPath. A default value is optional by using the  <code>$searchParams</code> structure.</p> Type Consumes Produces Configuration params accessor The $source object An attribute list filtered by the query A JMESpath query or $searchParams structure <p> This mapping specifies the component <code>empty-component</code> which name is retrieved by the $source attribute <code>resouce_properties.cidr_block</code></p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        empty-component\nname:        {$path: \"resource_properties.cidr_block\"}\n$source:     {$type: \"aws_subnet\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_subnet\" \"PrivateSubnet1\" {\nvpc_id     = aws_vpc.CustomVPC.id\ncidr_block = \"10.0.2.0/24\"\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_subnet-privatesubnet1\nname: 10.0.2.0/24\ntype: empty-component\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_subnet\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#findfirst","title":"$findFirst","text":"<p>This mapping function findFirst searchs through the list of objects identified in the <code>$source</code>  and returns the first successful match. A default value is optional by using the <code>$searchParams</code> structure.</p> Type Consumes Produces Configuration params filter The $source object A string attribute A list of objects identified in the $source or $searchParams structure <p> This mapping specifies a component rds whose name is configured by a list of attributes</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        empty-component\nname:        {$findFirst: [\"resource_properties.cidr_block\", \"resource_name\"]}\n$source:     {$type: \"aws_subnet\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_subnet\" \"PrivateSubnet1\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_subnet-privatesubnet1\nname: PrivateSubnet1\ntype: empty-component\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_subnet\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#searchparams","title":"$searchParams","text":"<p>This mapping function searchParams specifies a default value for <code>$path</code> or <code>$findFirst</code> mapping functions.</p> Type Consumes Produces Configuration params selector The $path or $findFirst functions A string attribute A searchPath and/or a defaultValue <p> This mapping specifies a component rds whose tag is retrieved from <code>resource_properties. engine</code> with <code>rds</code> as default value.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:       rds\n$source:    {$type: [\"aws_db_instance\", \"aws_rds_cluster\"]}\ntags:\n- {$path: {$searchParams: {\n                    searchPath: \"resource_properties.engine\",                     defaultValue: \"rds\"}}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_db_instance\" \"mysql\" {\nengine               = \"mysql\" }\nresource \"aws_rds_cluster\" \"aurora-cluster-demo\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_db_instance-mysql\nname: mysql\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- mysql\n- id: public-cloud-01.aws_rds_cluster-aurora_cluster_demo\nname: aurora-cluster-demo\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- rds\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#singleton","title":"$singleton","text":"<p>This mapping function singleton unifies TF resources under a single component or TrustZone. This function is frequently combined with <code>$numberOfSources</code> for generating text fields like the name or the tags.  So is done, for example, in the default configuration described in the  Component Template Pattern.</p> Type Consumes Produces Configuration params group A list of resources A list of resources grouped by the given params Mapping Function configuration <p> This mapping specifies a unique component <code>CD-SYSTEMS-MANAGER</code>  for any number of resources whose name starts with <code>aws_ssm_</code>. </p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        CD-SYSTEMS-MANAGER\n$source:     {$singleton: {$type: {$regex: ^aws_ssm_\\w*$}}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_ssm_parameter\" \"ssm_parameter\" {}\nresource \"aws_ssm_document\" \"ssm_document\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_ssm_parameter-ssm_parameter\nname: CD-SYSTEMS-MANAGER (grouped)\ntype: CD-SYSTEMS-MANAGER\nparent:\ntrustZone: public-cloud-01\ntags:\n- ssm_parameter (aws_ssm_parameter)\n- ssm_document (aws_ssm_document)\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#numberofsources","title":"$numberOfSources","text":"<p>This mapping function numberOfSources allows you to set different values for output name or tags  when the number of sources for the same mapping is single or multiple.</p> Type Consumes Produces Configuration params group The $source object A string attribute oneSource and multipleSource configuration attributes <p>The result of this function may be expressed as: <pre><code>multipleSource if $singleton &amp;&amp; (numberOfSources &gt; 1) else oneSource\n</code></pre></p> <p> This mapping specifies a unique component <code>CD-SYSTEMS-MANAGER</code>  and set its name by <code>CD-SYSTEMS-MANAGER (grouped)</code> when found more than one resource. </p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        CD-SYSTEMS-MANAGER\nname:        {$numberOfSources: {\n                    oneSource: {$path: \"resource_name\"},                     multipleSource: {$format: \"{type} (grouped)\"}}}\n$source:     {$singleton: {$type: {$regex: ^aws_ssm_\\w*$}}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_ssm_parameter\" \"ssm_parameter\" {}\nresource \"aws_ssm_document\" \"ssm_document\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_ssm_parameter-ssm_parameter\nname: CD-SYSTEMS-MANAGER (grouped)\ntype: CD-SYSTEMS-MANAGER\nparent:\ntrustZone: public-cloud-01\ntags:\n- ssm_parameter (aws_ssm_parameter)\n- ssm_document (aws_ssm_document)\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#format","title":"$format","text":"<p>This mapping function format returns a formatted version of the string, using values from <code>$source</code>  and the <code>name</code> or <code>type</code> mapper attributes. These substitutions are identified by braces ('{' and '}')</p> Type Consumes Produces Configuration params formatter The $source object and <code>name</code> and <code>type</code> mapper attributes A string attribute The string formatter configuration <p> This mapping specifies a component <code>rds</code> whose name is configured by a complex string</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:       rds\nname:       {$format: \"{type} created by resource {resource_name} of type {resource_type}\"}\n$source:    {$type: \"aws_db_instance\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_db_instance\" \"mysql\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_db_instance-mysql\nname: rds created by resource mysql of type aws_db_instance\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_db_instance\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#module","title":"$module","text":"<p>This mapping function module searches for  modules in the TF configuration  matching by the <code>source</code>'s attribute. </p> Type Consumes Produces Configuration params filter A list of resources A modules list filtered by source's attribute The source's attribute value <p> This mapping specifies a component <code>rds</code> for the module <code>terraform-aws-modules/rds/aws</code></p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type: rds\n$source: {$module: \"terraform-aws-modules/rds/aws\"}\ndataflows: []\n</code></pre> <pre><code>module \"db\" {\nsource  = \"terraform-aws-modules/rds/aws\"\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.db\nname: db\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- terraform-aws-modules/rds/aws\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#skip","title":"$skip","text":"<p>This mapping function skip specifying specific objects to skip if not explicitly defined.</p> Type Consumes Produces Configuration params filter A list of resources A resources list of resources to skip Mapping Function configuration <p> This mapping specifies the component <code>rds</code> for the resources of type in  (<code>aws_db_instance</code>,  <code>aws_rds_cluster</code>) but skipping the resource with name <code>mysql-secret</code></p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:       rds\n$source:    {$type: [\"aws_db_instance\", \"aws_rds_cluster\"]}\n- type:       skip_mysql-secret\n$source:    {$skip: {$name: \"mysql-secret\"}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_db_instance\" \"mysql\" {}\nresource \"aws_db_instance\" \"mysql-secret\" {}\nresource \"aws_rds_cluster\" \"aurora-cluster-demo\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_db_instance-mysql\nname: mysql\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_db_instance\n- id: public-cloud-01.aws_rds_cluster-aurora_cluster_demo\nname: aurora-cluster-demo\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_rds_cluster\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#catchall","title":"$catchall","text":"<p>This mapping function catchall is used to create a component for each resource that matches a certain query. It will include any matching resource unless it is already found as a more specific resource or if it has been skipped.</p> Type Consumes Produces Configuration params filter A list of resources A list of resources matching the provided query Mapping Function configuration Example #1: only catchall <p> This mapping matches all previously not matched components, regardless theirs specific types or names. It is used along with $root mapping function seen before, and with $squash_terraform explained in the next section</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\n$default: true\ncomponents:\n- type:       empty-component\n$source:    {$catchall: {$root: \"resource|squash_terraform(@)\"}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_db_instance\" \"mysql\" {}\nresource \"aws_db_instance\" \"mysql-secret\" {}\nresource \"aws_rds_cluster\" \"aurora-cluster-demo\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\ncomponents:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_db_instance-mysql\nname: mysql\ntype: empty-component\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_db_instance\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_db_instance-mysql_secret\nname: mysql-secret\ntype: empty-component\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_db_instance\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_db_instance-aurora_cluster_demo\nname: aurora-cluster-demo\ntype: empty-component\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_rds_cluster\ndataflows: []\n</code></pre> Example #2: explicit mapping and catchall <p> This mapping matches all resources, except for those ones already mapped by a more specific case</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\n$default: true\ncomponents:\n- type:       rds\n$source:    {$type: [\"aws_db_instance\", \"aws_rds_cluster\"]}\n- type:       empty-component\n$source:    {$catchall: {$root: \"resource|squash_terraform(@)\"}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_db_instance\" \"mysql\" {}\nresource \"aws_db_instance\" \"mysql-secret\" {}\nresource \"aws_rds_cluster\" \"aurora-cluster-demo\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\ncomponents:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_db_instance-mysql\nname: mysql\ntype: rds\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_db_instance\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_db_instance-mysql_secret\nname: mysql-secret\ntype: rds\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_db_instance\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_db_instance-aurora_cluster_demo\nname: aurora-cluster-demo\ntype: empty-component\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_rds_cluster\ndataflows: []\n</code></pre> Example #3: skip and catchall <p> This mapping matches all resources, except for those explicitly skipped</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\n$default: true\ncomponents:\n- type:       skip_mysql-secret\n$source:    {$skip: {$name: \"mysql-secret\"}}\n- type:       empty-component\n$source:    {$catchall: {$root: \"resource|squash_terraform(@)\"}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_db_instance\" \"mysql\" {}\nresource \"aws_db_instance\" \"mysql-secret\" {}\nresource \"aws_rds_cluster\" \"aurora-cluster-demo\" {}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\ncomponents:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_db_instance-mysql\nname: mysql\ntype: empty-component\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_db_instance\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_db_instance-aurora_cluster_demo\nname: aurora-cluster-demo\ntype: empty-component\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_rds_cluster\ndataflows: []\n</code></pre>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#lookup","title":"$lookup","text":"<p>This mapping function lookup allows you to look up the output of a special field against a key-value lookup table.</p> Example for lookup <p>Just in case there are some inconsistencies in naming conventions used, and you need to be able to translate one name into another, a simple lookup key-value table section can be added to the mapping file. For example, if we have a situation where a subnet name is written using a short naming convention, but is actually referred to via a longer name elsewhere, we can use the $lookup action.</p> <pre><code>parent:\n$lookup: {$path: \"Properties.Subnets[]|map(&amp;values(@), @)[]|map(&amp;re_sub('[:]', '-', @), @)\"}\n</code></pre> <p>If the above query returns a subnet called <code>shortnameA</code>, then it will be looked up in the below table:</p> <pre><code>lookup:\nshortnameA: amuchlongernameA\nshortnameB: amuchlongernameB\n</code></pre> <p>To give a final value of <code>amuchlongernameA</code>.</p>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#hub","title":"$hub","text":"<p>This special mapping field hub allows defining abstract contact points for larger end-to-end final dataflows. Only for dataflow's \"source\" and \"destination\" fields. Specially created for building dataflows from  Security Group structures without generating components from them.</p> <p>Reference to Security Groups as dataflows  for usage examples.</p>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-domain-specific-language/#ip","title":"$ip","text":"<p>When defining a component's \"name\" field as <code>$ip</code>, will generate a singleton component for representing an external  IP but without limitations of singleton for this case, so the \"type\" for the defined mapping definition with <code>$ip</code>  (i.e. <code>generic-terminal</code>) will not be catalogued as singleton.</p> <p>Reference to Security Groups as dataflows  for usage examples.</p>","boost":2},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/","title":"How Dataflow Mapping File works","text":"<p> Refer to How To Map Dataflows section for a simpler introduction.</p> <p>Info</p> <p>In Terraform configuration files there not exist a direct relationship between resources and data flow. Mapping configuration is needed to be configured in the mapping file to represent its flows in the OTM.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/#types-of-dataflows-in-terraform","title":"Types of dataflows in Terraform","text":""},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/#simple-dataflows","title":"Simple dataflows","text":"<p>When dataflows mapping attribute has enough information, they are mapped directly through the mapping file. It could be divided into three types:</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/#resource-a-ab","title":"resource A, A\u2192B","text":"<p>The <code>$source</code> is the origin of the dataflow and has the information about the destination dataflow itself.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        api-gateway\n$source:     {$type: \"aws_api_gateway_authorizer\"}\n- type:        cognito\n$source:     {$type: \"aws_cognito_user_pool\"}\ndataflows:\n- name:         {$format: \"API gateway data flow from {resource_type}\"}\n$source:      {$type: \"aws_api_gateway_authorizer\"}\nsource:       {$path: \"resource_id\"}\ndestination:  {$path: \"resource_properties.provider_arns[0]\"}\ntags:\n- API gateway dataflow\n</code></pre> <pre><code>resource \"aws_cognito_user_pool\" \"user_pool\" { }\nresource \"aws_api_gateway_authorizer\" \"api_authorizer\" {    provider_arns = [aws_cognito_user_pool.user_pool.arn]\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_api_gateway_authorizer-api_authorizer\nname: api_authorizer\ntype: api-gateway\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_api_gateway_authorizer\n- id: public-cloud-01.aws_cognito_user_pool-user_pool\nname: user_pool\ntype: cognito\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_cognito_user_pool\ndataflows:\n- id: 2ced6f2f-5eb9-4fa2-8417-beca148a6994\nname: API gateway data flow from aws_api_gateway_authorizer\nsource: public-cloud-01.aws_api_gateway_authorizer-api_authorizer\ndestination: public-cloud-01.aws_cognito_user_pool-user_pool\ntags:\n- API gateway dataflow\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/#resource-a-singletonab","title":"resource A, singleton(A)\u2192B","text":"<p>The <code>$source</code> is the origin of the dataflow and has the information about the destination dataflow itself, but the origin resource is mapped as a <code>$singleton</code> in the terraform file.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        api-gateway\n$source:     {$singleton: {$type: {$regex: ^aws_api_gateway_\\w*$}}}\n- type:        cognito\n$source:     {$type: \"aws_cognito_user_pool\"}\ndataflows:\n- name:         {$format: \"API gateway data flow from {resource_type}\"}\n$source:      {$type: \"aws_api_gateway_authorizer\"}\nsource:       {$numberOfSources: {oneSource: {$path: \"resource_id\"}, multipleSource: {$format: \"api-gateway (grouped)\"}}}\ndestination:  {$path: \"resource_properties.provider_arns[0]\"}\ntags:\n- API gateway dataflow\n</code></pre> <pre><code>resource \"aws_api_gateway_rest_api\" \"rest_api\" { }\nresource \"aws_cognito_user_pool\" \"user_pool\" { }\nresource \"aws_api_gateway_authorizer\" \"api_authorizer\" {    provider_arns = [aws_cognito_user_pool.user_pool.arn]\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_cognito_user_pool-user_pool\nname: user_pool\ntype: cognito\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_cognito_user_pool\n- id: public-cloud-01.aws_api_gateway_rest_api-rest_api\nname: api-gateway (grouped)\ntype: api-gateway\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- rest_api (aws_api_gateway_rest_api)\n- api_authorizer (aws_api_gateway_authorizer)\ndataflows:\n- id: 3708e8b2-c593-4d4e-a2a6-a9861985ad12\nname: API gateway data flow from aws_api_gateway_authorizer\nsource: public-cloud-01.aws_api_gateway_rest_api-rest_api\ndestination: public-cloud-01.aws_cognito_user_pool-user_pool\ntags:\n- API gateway dataflow\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/#resource-a-bc","title":"resource A, B\u2192C.","text":"<p>The <code>$source</code> has info to define a dataflow between two different resources.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        s3\n$source:     {$type: \"aws_s3_bucket\"}\ndataflows:\n- name:         {$format: \"S3 dataflow from {resource_type}\"}\n$source:      {$type: \"aws_s3_bucket_logging\"}\nsource:       {$path: \"resource_properties.bucket\" }\ndestination:  {$path: \"resource_properties.target_bucket\"}\ntags:\n- $format: \"Dataflow created by {resource_type}-{resource_name}\"\n</code></pre> <pre><code>resource \"aws_s3_bucket_logging\" \"logging\" {\nbucket = aws_s3_bucket.bucket.id target_bucket = aws_s3_bucket.log_bucket.id\n}\nresource \"aws_s3_bucket\" \"bucket\" { }\nresource \"aws_s3_bucket\" \"log_bucket\" { }\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_s3_bucket-bucket\nname: bucket\ntype: s3\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_s3_bucket\n- id: public-cloud-01.aws_s3_bucket-log_bucket\nname: log_bucket\ntype: s3\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_s3_bucket\ndataflows:\n- id: 591089c3-9dc1-42c0-a574-3674f2d9deaf\nname: S3 dataflow from aws_s3_bucket_logging\nsource: public-cloud-01.aws_s3_bucket-bucket\ndestination: public-cloud-01.aws_s3_bucket-log_bucket\ntags:\n- Dataflow created by aws_s3_bucket_logging-logging\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/#security-groups-as-dataflows","title":"Security Groups as dataflows","text":"<p>After some analysis of the best way on how to implement Security Groups(as trustzones, components or dataflows),  the final decision was to begin implementing them as dataflows, leaving for later a possible implementation in other ways.</p> Scope of a Security Group <p>If a Threat Model is going to be generated from a Terraform file</p> <p>and the IaC file contains AWS resources</p> <p>and some of those AWS resources contains Security Groups information</p> <p>and this information is consistent and sufficient</p> <p>then there are AWS Security Groups that can be threat modeled as dataflows from the IaC file</p> <p> </p> Security Group referencing external IPs <p>If an AWS Security Group has got security group rules referencing an external IP</p> <p>then the resultant Threat Model will include an Internet trust zone</p> <p>and that trust zone will include a \"generic terminal\" component and this \"generic terminal\" component will be named as the external IP</p> <p>and this \"generic terminal\" component will be the origin or destination to all associated components to the SG.    </p> Security Group EgressSecurity Group Ingress <p> </p> <p> </p>"},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/#a-sg_a-b","title":"A \u2192 SG_A \u2192 B","text":"<p>These are the dataflows that have only one Security Group between the two connected resources.</p> Security Group as dataflow type 1: A \u2192 SG_A \u2192 B <p>If an IaC resource is an AWS Security Group</p> <p>and has Security Group rules inside SecurityGroupIngress and/or SecurityGroupEgress data structures</p> <p>and there is an AWS resource with SecurityGroupIds containing the name of the AWS Security Group</p> <p>then the AWS resource is associated to that Security Group</p> <p>and the AWS resource will take from Security Group the rules to allow inbound or outbound connections</p> <p> </p> Mapping fileResource FileOTMIriusRisk Threat Model Example <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\n- id:   f0ba7722-39b6-4c81-8290-a30a248bb8d9\nname: Internet\ntype: f0ba7722-39b6-4c81-8290-a30a248bb8d9\n$source: {$singleton: {$type: \"aws_security_group\", $props: [\"egress[0].cidr_blocks\", \"ingress[0].cidr_blocks\"]}}\ncomponents:\n- type:        vpc\n$source:     {$type: \"aws_vpc\"}\n- type:        empty-component\n$source:     {$type: \"aws_subnet\"}\nparent:      {$path: \"resource_properties.vpc_id\"}\n- type:        empty-component\n$source:     {$type: \"aws_vpc_endpoint\"}\nparent:      {$path: \"resource_properties.subnet_ids\"}\n- type:        generic-client\nname:        {$ip: {$path: \"resource_properties.egress[0].cidr_blocks\"}}\n$source:     {$type: \"aws_security_group\", $props: \"egress[0].cidr_blocks\"}\nparent:      f0ba7722-39b6-4c81-8290-a30a248bb8d9\ntags:\n- Outbound connection destination IP\n- type:        generic-client\nname:        {$ip: {$path: \"resource_properties.ingress[0].cidr_blocks\"}}\n$source:     {$type: \"aws_security_group\", $props: \"ingress[0].cidr_blocks\"}\nparent:      f0ba7722-39b6-4c81-8290-a30a248bb8d9\ntags:\n- Inbound connection source IP\ndataflows:\n- $source:      {$props: \"security_group_ids\"}\nsource:       {$path: \"resource_id\"}\ndestination:  {$hub: {$path: \"resource_properties.security_group_ids\"}}\n- $source:      {$type: \"aws_security_group\"}\nsource:       {$path: \"resource_properties.ingress[0].cidr_blocks\"}\ndestination:  {$hub: {$path: \"resource_id\"}}\ntags:\n- $path: \"resource_properties.ingress[0].description\"\n- $path: \"resource_properties.ingress[0].protocol\"\n- $path: \"resource_properties.ingress[0].from_port|to_string(@)\"\n- $path: \"resource_properties.ingress[0].to_port|to_string(@)\"\n- $source:      {$type: \"aws_security_group\"}\nsource:       {$hub: {$path: \"resource_id\"}}\ndestination:  {$path: \"resource_properties.egress[0].cidr_blocks\"}\ntags:\n- $path: \"resource_properties.egress[0].description\"\n- $path: \"resource_properties.egress[0].protocol\"\n- $path: \"resource_properties.egress[0].cidr_blocks|join(',', @)\"\n</code></pre> <pre><code>variable \"vpcCidrblock\" {\ndefault = [\"10.0.0.0/16\"]\n}  resource \"aws_vpc\" \"CustomVPC\" {\ncidr_block  = var.vpcCidrblock\n}\nresource \"aws_subnet\" \"PrivateSubnet1\" {\nvpc_id     = aws_vpc.CustomVPC.id\n}\nresource \"aws_security_group\" \"VPCssmSecurityGroup\" {\nvpc_id        = aws_vpc.CustomVPC.id\ningress {\ncidr_blocks = var.vpcCidrblock\nfrom_port   = 443\nto_port     = 443\nprotocol    = \"tcp\"\ndescription = \"from CustomVPC:443\"\n}\negress {\nfrom_port   = 0\nto_port     = 0\nprotocol    = \"-1\"\ncidr_blocks = [\"0.0.0.0/0\"]\ndescription = \"Allow all outbound traffic by default\"\n}\n}\nresource \"aws_vpc_endpoint\" \"VPCssm\" {\nsecurity_group_ids = [\naws_security_group.VPCssmSecurityGroup.id,\n]\nsubnet_ids = [\naws_subnet.PrivateSubnet1.id\n]\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\n- id: f0ba7722-39b6-4c81-8290-a30a248bb8d9\nname: Internet\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_vpc-customvpc\nname: CustomVPC\ntype: vpc\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_vpc\n- id: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1\nname: PrivateSubnet1\ntype: empty-component\nparent:\ncomponent: public-cloud-01.aws_vpc-customvpc\ntags:\n- aws_subnet\n- id: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_vpc_endpoint-vpcssm\nname: VPCssm\ntype: empty-component\nparent:\ncomponent: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1\ntags:\n- aws_vpc_endpoint\n- id: f0ba7722-39b6-4c81-8290-a30a248bb8d9.aws_security_group-vpcssmsecuritygroup.0_0_0_0_0\nname: 0.0.0.0/0\ntype: generic-client\nparent:\ntrustZone: f0ba7722-39b6-4c81-8290-a30a248bb8d9\ntags:\n- Outbound connection destination IP\ndataflows:\n- id: 5173a0d7-a7dc-438a-a8a2-d310294f7698\nname: VPCssmSecurityGroup -&gt; VPCssm\nsource: public-cloud-01.aws_vpc-customvpc\ndestination: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_vpc_endpoint-vpcssm\ntags:\n- from CustomVPC:443\n- tcp\n- \"443\"\n- \"443\"\n- id: 38306ec7-5db4-421c-9a74-13b2a30ca3f6\nname: VPCssm -&gt; VPCssmSecurityGroup\nsource: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_vpc_endpoint-vpcssm\ndestination: f0ba7722-39b6-4c81-8290-a30a248bb8d9.aws_security_group-vpcssmsecuritygroup.0_0_0_0_0\ntags:\n- Allow all outbound traffic by default\n- \"-1\"\n- 0.0.0.0/0\n</code></pre> <p> </p>"},{"location":"startleft-processors/iac/tf/Terraform-how-dataflow-mapping-works/#a-sg_a-sg_b-b","title":"A \u2192 SG_A \u2192 SG_B \u2192 B","text":"<p>These are the dataflows that have two Security Groups between the two connected resources like this.</p> Security Group as dataflow type 2: A \u2192 SG_A \u2192 SG_B \u2192 B <p>If there is a Security Group that has ingress or egress data with other AWS Security Groups</p> <p>and both security groups have at least a resource associated to it</p> <p>and the resources are within different subnets</p> <p>then this Security Group will be threat modeled as dataflows between the resource of every subnet to the rest of resources of the other security group</p> <p> </p> <p>The resultant Threat Model is not a network but a TM of a network.</p> <p>If there are the same resources replicated in the Threat Model because there is more than a subnet,  applying the rest of business rules for SGs as dataflows, those dataflows will be generated consistently.</p> <p>What is threat modeled are the inbound and outbound connections from some components to other components,  not from the component to itself</p> Mapping fileResource FileOTMIriusRisk Threat Model Example <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        vpc\n$source:     {$type: \"aws_vpc\"}\n- type:        empty-component\n$source:     {$type: \"aws_subnet\"}\nparent:      {$path: \"resource_properties.vpc_id\"}\n- type:        empty-component\n$source:     {$type: \"aws_vpc_endpoint\"}\nparent:      {$path: \"resource_properties.subnet_ids\"}\n- type:        elastic-container-service\n$source:     {$type: \"aws_ecs_service\"}\nparent:      {$path:  \"resource_properties.network_configuration[0].subnets\"}\n- type:        load-balancer\n$source:     {$type: \"aws_lb\"}\nparent:      {$path: \"resource_properties.subnets\"}\ndataflows:\n- $source:      {$props: \"security_groups\"}\nsource:       {$path: \"resource_id\"}\ndestination:  {$hub: {$path: \"resource_properties.security_groups\"}}\n- $source:      {$props: \"network_configuration | [0].security_groups\"}\nsource:       {$path: \"resource_id\"}\ndestination:  {$hub: {$path: \"resource_properties.network_configuration[0].security_groups\"}}\n- $source:      {$type: \"aws_security_group_rule\",  $props: \"type=='ingress'\"}\nsource:       {$hub: {$path: \"resource_properties.source_security_group_id\"}}\ndestination:  {$hub: {$path: \"resource_properties.security_group_id\"}}\ntags:\n- $path: \"resource_properties.description\"\n- $path: \"resource_properties.protocol\"\n- $path: \"resource_properties.from_port|to_string(@)\"\n- $path: \"resource_properties.to_port|to_string(@)\"\n- $source:      {$type: \"aws_security_group_rule\",  $props: \"type=='egress'\"}\nsource:       {$hub: {$path: \"resource_properties.security_group_id\"}}\ndestination:  {$hub: {$path: \"resource_properties.source_security_group_id\"}}\ntags:\n- $path: \"resource_properties.description\"\n- $path: \"resource_properties.protocol\"\n- $path: \"resource_properties.from_port|to_string(@)\"\n- $path: \"resource_properties.to_port|to_string(@)\"\n</code></pre> <pre><code>resource \"aws_vpc\" \"CustomVPC\" {\ncidr_block  = \"10.0.0.0/16\"\n}\nresource \"aws_subnet\" \"PrivateSubnet1\" {\nvpc_id     = aws_vpc.CustomVPC.id\n}\nresource \"aws_subnet\" \"PrivateSubnet2\" {\nvpc_id     = aws_vpc.CustomVPC.id\n}\nresource \"aws_security_group\" \"OutboundSecurityGroup\" {\nvpc_id        = aws_vpc.CustomVPC.id\n}\nresource \"aws_security_group\" \"ServiceLBSecurityGroup\" {\nvpc_id        = aws_vpc.CustomVPC.id\n}\nresource \"aws_security_group_rule\" \"OutboundSecurityGroupIngressfromServiceLBSecurityGroup\" {\ntype                      = \"ingress\"\nfrom_port                 = 80\nto_port                   = 80\nprotocol                  = \"tcp\"\nsecurity_group_id         = aws_security_group.OutboundSecurityGroup.id\nsource_security_group_id  = aws_security_group.ServiceLBSecurityGroup.id\ndescription               = \"Load balancer to target\"\n}\nresource \"aws_security_group_rule\" \"ServiceLBSecurityGroupEgresstoOutboundSecurityGroup\" {\ntype                      = \"egress\"\nfrom_port                 = 80\nto_port                   = 80\nprotocol                  = \"tcp\"\nsecurity_group_id         = aws_security_group.ServiceLBSecurityGroup.id\nsource_security_group_id  = aws_security_group.OutboundSecurityGroup.id\ndescription               = \"Load balancer to target\"\n}\nresource \"aws_ecs_service\" \"Service\" {\nnetwork_configuration {\nsubnets = [aws_subnet.PrivateSubnet1.id, aws_subnet.PrivateSubnet2.id]\nsecurity_groups = [aws_security_group.OutboundSecurityGroup.id]\n}\n}\nresource \"aws_lb\" \"ServiceLB\" {\nsecurity_groups             = [aws_security_group.ServiceLBSecurityGroup.id]\nsubnets                     = [aws_subnet.PrivateSubnet1.id, aws_subnet.PrivateSubnet2.id]\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_vpc-customvpc\nname: CustomVPC\ntype: vpc\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_vpc\n- id: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1\nname: PrivateSubnet1\ntype: empty-component\nparent:\ncomponent: public-cloud-01.aws_vpc-customvpc\ntags:\n- aws_subnet\n- id: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2\nname: PrivateSubnet2\ntype: empty-component\nparent:\ncomponent: public-cloud-01.aws_vpc-customvpc\ntags:\n- aws_subnet\n- id: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_ecs_service-service\nname: Service\ntype: elastic-container-service\nparent:\ncomponent: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1\ntags:\n- aws_ecs_service\n- id: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2.aws_ecs_service-service\nname: Service\ntype: elastic-container-service\nparent:\ncomponent: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2\ntags:\n- aws_ecs_service\n- id: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_lb-servicelb\nname: ServiceLB\ntype: load-balancer\nparent:\ncomponent: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1\ntags:\n- aws_lb\n- id: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2.aws_lb-servicelb\nname: ServiceLB\ntype: load-balancer\nparent:\ncomponent: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2\ntags:\n- aws_lb\ndataflows:\n- id: 9e5be4ce-d37c-423e-9981-4dcb0b39c175\nname: ServiceLB -&gt; Service\nsource: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_lb-servicelb\ndestination: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_ecs_service-service\ntags:\n- Load balancer to target\n- tcp\n- \"80\"\n- \"80\"\n- Load balancer to target\n- tcp\n- \"80\"\n- \"80\"\n- id: 92d467a9-6ee8-4f41-8d01-7fb0a6a5e06d\nname: ServiceLB -&gt; Service\nsource: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_lb-servicelb\ndestination: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2.aws_ecs_service-service\ntags:\n- Load balancer to target\n- tcp\n- \"80\"\n- \"80\"\n- Load balancer to target\n- tcp\n- \"80\"\n- \"80\"\n- id: 2dfbd037-469a-4168-8388-e673f1190a3b\nname: ServiceLB -&gt; Service\nsource: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2.aws_lb-servicelb\ndestination: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet1.aws_ecs_service-service\ntags:\n- Load balancer to target\n- tcp\n- \"80\"\n- \"80\"\n- Load balancer to target\n- tcp\n- \"80\"\n- \"80\"\n- id: f04c37bf-3a01-40dd-a0cc-b438c840fa84\nname: ServiceLB -&gt; Service\nsource: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2.aws_lb-servicelb\ndestination: public-cloud-01.aws_vpc-customvpc.aws_subnet-privatesubnet2.aws_ecs_service-service\ntags:\n- Load balancer to target\n- tcp\n- \"80\"\n- \"80\"\n- Load balancer to target\n- tcp\n- \"80\"\n- \"80\"\n</code></pre> <p> </p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/","title":"How Mapping File works","text":"<p>This page is an in-depth explanation of how <code>slp_tf</code> handles mapping and Terraform resource files to generate an OTM.</p> <p>This diagram shows how mapping and Terraform resource files are pre-processed to simplify and decouple the Terraform parser logic from the input files.</p> <p></p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#loading-the-terraform-source-file","title":"Loading the Terraform Source File","text":"<p>In this step, the Terraform Loader receives a file written in the  Terraform configuration language and generates a Terraform source dictionary with the internal data structure used by the Terraform Parser for compose the OTM.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#what-is-a-terraform-configuration","title":"What is a Terraform Configuration","text":"<p>\"A Terraform configuration is a complete document in the Terraform language that tells Terraform how to manage  a given collection of infrastructure. A configuration can consist of multiple files and directories.\"</p> Terraform language Syntax <p>The syntax of the Terraform language consists of only a few basic elements <pre><code>resource \"aws_vpc\" \"main\" {\ncidr_block = var.base_cidr_block\n}\n&lt;BLOCK TYPE&gt; \"&lt;BLOCK LABEL&gt;\" \"&lt;BLOCK LABEL&gt;\" {\n  # Block body\n&lt;IDENTIFIER&gt; = &lt;EXPRESSION&gt; # Argument\n}\n</code></pre></p> Example for Network topology for Amazon Web Services <p>The following example describes a simple network topology for Amazon Web Services, just to give you a sense of the  overall structure and syntax of the Terraform language. Similar configurations can be created for other virtual  network services, using resource types defined by other providers, and a practical network configuration will  often contain additional elements not shown here.</p> <pre><code>terraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 1.0.4\"\n}\n}\n}\nvariable \"aws_region\" {}\nvariable \"base_cidr_block\" {\ndescription = \"A /16 CIDR range definition, such as 10.1.0.0/16, that the VPC will use\"\ndefault = \"10.1.0.0/16\"\n}\nvariable \"availability_zones\" {\ndescription = \"A list of availability zones in which to create subnets\"\ntype = list(string)\n}\nprovider \"aws\" {\nregion = var.aws_region\n}\nresource \"aws_vpc\" \"main\" {\n  # Referencing the base_cidr_block variable allows the network address\n  # to be changed without modifying the configuration.\ncidr_block = var.base_cidr_block\n}\nresource \"aws_subnet\" \"az\" {\n  # Create one subnet for each given availability zone.\ncount = length(var.availability_zones)\n  # For each subnet, use one of the specified availability zones.\navailability_zone = var.availability_zones[count.index]\n  # By referencing the aws_vpc.main object, Terraform knows that the subnet\n  # must be created only after the VPC is created.\nvpc_id = aws_vpc.main.id\n  # Built-in functions and operators can be used for simple transformations of\n  # values, such as computing a subnet address. Here we create a /20 prefix for\n  # each subnet, using consecutive addresses for each availability zone,\n  # such as 10.1.16.0/20 .\ncidr_block = cidrsubnet(aws_vpc.main.cidr_block, 4, count.index+1)\n}\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#terraform-source-dictionary","title":"Terraform Source Dictionary","text":"<p>The most important data for the <code>TerraformParser</code> is placed into the <code>&lt;BLOCK TYPE&gt;</code>:  Resource Blocks and Module Blocks</p> <p>This <code>TerraformLoader</code> takes the Terraform Configuration files and generates the <code>Terraform source dictionary</code>  used to build the OTM.  It is important to notice that the mapping file works always against this data structure and not the against raw  Terraform source.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#terraform-source-dictionary-syntax","title":"Terraform Source Dictionary Syntax","text":"<p>This data structure is generated by post-processing the Terraform Configuration files  for adding the values <code>resource_type, resource_name and resource_properties</code> which will be used to configure the mapping behavior. Some additional data may exist due to its existence in the original loaded file.</p> <p> The fields <code>resource_*</code> is used for matching and generating the OTM components.</p> Terraform Configuration filesTerraform source dictionary <pre><code># [...] Reduced for simplicity\nresource \"aws_vpc\" \"main\" {\ncidr_block = var.base_cidr_block\n}\nresource \"aws_subnet\" \"az\" {\ncount = length(var.availability_zones)\navailability_zone = var.availability_zones[count.index]\nvpc_id = aws_vpc.main.id\ncidr_block = cidrsubnet(aws_vpc.main.cidr_block, 4, count.index+1)\n}\nmodule \"vpc\" {\nsource  = \"terraform-aws-modules/vpc/aws\"\n}\n# [...] Reduced for simplicity\n</code></pre> <pre><code># [...] Reduced for simplicity\nresource:\n- resource_type: aws_vpc\nresource_name: main\nresource_properties:\ncidr_block: '${var.base_cidr_block}'\n- resource_type: aws_subnet\nresource_name: az\nresource_properties:\ncount: '${length(var.availability_zones)}'\navailability_zone: '${var.availability_zones[count.index]}'\nvpc_id: '${aws_vpc.main.id}'\ncidr_block: '${cidrsubnet(aws_vpc.main.cidr_block,4,count.index + 1)}'\nmodule:\n- vpc:\nsource: terraform-aws-modules/vpc/aws\n# [...] Reduced for simplicity \n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#creating-a-terraform-mapping-file","title":"Creating a Terraform Mapping File","text":"<p>This section will explain the three different sections into which a Mapping File is divided.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#how-to-map-trustzones","title":"How To Map TrustZones","text":"<p>The TrustZone is a Threat Modelling concept that will never be present as is in the Terraform source file. Thus, the <code>slp_tf</code> relies on the configuration defined in the <code>trustzones</code> section of the Mapping File.  <pre><code>trustzones: # (1)!\n- id:   public-cloud-01 # (2)!\nname: Public Cloud # (3)!\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91 # (5)!\n$default: true # (4)!\n</code></pre></p> <ol> <li>trustzones section defines the TrustZone mapping behavior. At least one TrustZone is needed to be defined</li> <li>set trustzone[id] value, which also can be used as a reference when setting the parent of a component <code>parent: public-cloud</code>. The <code>id</code> field uniquely identifies a trustzone, and differentiates it from other trustzones of the same type.</li> <li>set trustzone[name] value</li> <li>Optional: default trustzone to be used if a component does not define its parent</li> <li>set trustzone[type] value. For mapping trustzones to IriusRisk trustzones, <code>type</code> field must take internal IriusRisk values depending on the type of trustzone.</li> </ol> <p>For the purpose of preserving backwards compatibility, StartLeft also accepts the legacy mapping file format. In this format, there is no <code>type</code> field and the <code>id</code> will be used as both, ID and type.</p> <p>It is not possible to have multiple trustzones of the same type when using this format.</p> <p>The creation of some TrustZone may depend on the existence of some resources in the original file. To configure this  behavior, the <code>$source</code> attribute is used.</p> <pre><code>trustzones:\n- id:   internet-01\nname: Internet\ntype: f0ba7722-39b6-4c81-8290-a30a248bb8d9\n$source: { # (1)!\n      $singleton: # (2)!\n{$type: \"aws_security_group\", # (3)!\n         $props: \"egress[0].cidr_blocks\"} # (4)!\n}\n</code></pre> <ol> <li>special mapping fields <code>$source</code> this attribute is used to configure the mapping behavior which will create a TrustZone</li> <li>All the matching resources will be unified under a single TrustZone which will be created in case the <code>{$type: \"aws_security_group\", $props: \"egress[0].cidr_blocks\"}</code> query returns any element</li> <li>mapping functions <code>$type</code> performs a search along the entire resource list to return the element with the matching type</li> <li>mapping functions <code>$props</code> performs a search along the entire resource list to return the element with the matching props</li> </ol> Example for TrustZones Terraform Mapping <p>In this example, two TrustZones are created:</p> <ol> <li>The <code>Public Cloud</code> is created as the default TrustZone.</li> <li>The <code>Internet</code> is created because a resource with <code>resource_type</code> == <code>aws_security_group</code> with <code>resource_properties</code> contains <code>egress[0].cidr_blocks</code> is present.</li> </ol> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\n- id:   internet-01\nname: Internet\ntype: f0ba7722-39b6-4c81-8290-a30a248bb8d9\n$source: {\n      $singleton:\n{$type: \"aws_security_group\",\n         $props: \"egress[0].cidr_blocks\"}\n}\n[...] Reduced for simplicity\n</code></pre> <pre><code>[...] Reduced for simplicity\nresource \"aws_security_group\" \"VPCssmSecurityGroup\" {\nvpc_id        = aws_vpc.CustomVPC.id\negress {\nfrom_port   = 0\nto_port     = 0\nprotocol    = \"-1\"\ncidr_blocks = [\"0.0.0.0/0\"]\ndescription = \"Allow all outbound traffic by default\"\n}\n}\n[...] Reduced for simplicity\n</code></pre> <pre><code>trustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\n- id: internet-01\nname: Internet\ntype: f0ba7722-39b6-4c81-8290-a30a248bb8d9\nrisk:\ntrustRating: 10\n[...] Reduced for simplicity\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#how-to-map-components","title":"How To Map Components","text":"<p>This section explains several ways of mapping a resource to an OTM component.</p> <p>Those components are retrieved by the Terraform Domain-Specific Language  available functions configured in special mapping fields <code>$source</code>.  We will use the <code>$type</code> Terraform DSL function in the following examples for simplicity.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#mapping-a-component","title":"Mapping a component","text":"<p>The easiest way to map a component is to define the output <code>type</code> value and the <code>$source</code> to specify the source of the object type</p> Component Template Pattern <p>To reduce the minimal amount of data needed for mapping files, a template pattern is used to set the common  attributes. <pre><code>name:   # (1)!\n{$numberOfSources: { # (2)! \n        oneSource: {$path: \"resource_name\"},         multipleSource: {$format: \"{type} (grouped)\"}}} # \nparent: {$parent: $default_tz} # (3)!\ntags: # (4)!\n- {$numberOfSources: { # (5)!\n        oneSource: {$path: \"resource_type\"},\n        multipleSource: {$format: \"{resource_name} ({resource_type})\"}}}\n</code></pre></p> <ol> <li>set the component[name] value</li> <li>returns the value <code>multipleSource</code> in case (<code>$singleton</code> &amp;&amp; exists more than 1 resource), returns <code>oneSource</code> otherwise.</li> <li>set the component[parent] as the default configured TrustZone</li> <li>set the component[tags] value</li> <li>returns the value <code>multipleSource</code> in case (<code>$singleton</code> &amp;&amp; exists more than 1 resource), returns <code>oneSource</code> otherwise.</li> </ol> <p> The values provided in the mapping file have always priority over the template\u2019s ones.</p> <p>Example</p> <p>The following configuration: <pre><code>  - type:        CD-ACM\n$source:     {$singleton: {$type: \"aws_acm_certificate\"}}\n</code></pre> would be internally converted to: <pre><code>  - type:        CD-ACM\nname:        {$numberOfSources: {\n        oneSource: {$path: \"resource_name\"},         multipleSource: {$format: \"{type} (grouped)\"}}}\n$source:     {$singleton: {$type: \"aws_acm_certificate\"}}\n# note: the TZ id is the configured as default\nparent:      {$parent: public-cloud-01}\ntags:\n- {$numberOfSources: {\n            oneSource: {$path: \"resource_type\"},             multipleSource: {$format: \"{resource_name} ({resource_type})\"}}}\n</code></pre></p> Mapping fileInternal Mapping file Resource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        vpc\n$source:     {$type: \"aws_vpc\"}\ndataflows: []\n</code></pre> <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        vpc\nname:        {$numberOfSources: {\n        oneSource: {$path: \"resource_name\"},         multipleSource: {$format: \"{type} (grouped)\"}}}\n$source:     {$type: \"aws_vpc\"}\nparent:      {$parent: public-cloud-01}\ntags:\n- {$numberOfSources: {\n            oneSource: {$path: \"resource_type\"},             multipleSource: {$format: \"{resource_name} ({resource_type})\"}}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_vpc\" \"CustomVPC\" {\ncidr_block  = var.vpcCidrblock\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_vpc-customvpc\nname: CustomVPC\ntype: vpc\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_vpc\ndataflows: []\n</code></pre> <p> The component identifier is generated internally by the <code>slp_tf</code>. </p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#mapping-an-altsource","title":"Mapping an AltSource","text":"<p>$altsource is a special mapping field that specifies an alternative mapping when $source returns nothing.</p> <p>This is the minimal configuration needed to configure an $altsource, the following Example configures an altsource for <code>aws_s3_bucket</code> <pre><code>- type:        s3\n$source:     {$type: \"aws_s3_bucket\"}\n$altsource: # (1)!\n- $mappingType: {$type: \"aws_vpc_endpoint\"} # (2)!\n$mappingPath: {$path: \"*.service_name | [0]\"} # (3)!\n$mappingLookups: # (4)!\n- regex: ^(.*)s3$ # (5)!\n</code></pre></p> <ol> <li>special mapping fields specifies an alternative mapping when $source returns no object</li> <li>special mapping fields set the selected resources as the object to be mapped</li> <li>special mapping fields specifies the attribute over the one the $mappingLookups logic will be executed</li> <li>contains a set of regular expressions to search inside the string defined in $mappingType and $mappingPath. This     field may be multiple because there may be more than one service to infer</li> <li>if regex match with the $mappingPath the component is created</li> </ol> <p> This configuration maps a s3 by the existence of a resource with      <code>resource_type == aws_vpc_endpoint</code> and <code>*.service_name[0] match regex ^(.*)s3$</code>     but it is only executed in case none resource of aws_s3_bucket type exists.</p> AltSource Template Pattern <p>For reducing the minimal amount of data needed for mapping file, a template pattern is used to set the common attributes for the $mappingLookups attribute.</p> <pre><code>$altsource:\n- $mappingLookups:\n- name:  \"{mapping['type']} from altsource\" # (1)!\ntype:  \"{mapping['type']}\" # (2)!\ntags: # (3)!\n- {$numberOfSources:  # (4)!\n{oneSource: {$path: \"resource_type\"}, # (5)! \n                multipleSource: {$format: \"{resource_name} ({resource_type})\"}}} # (6)! \n</code></pre> <ol> <li>set the component[name] value by type inheritance with the suffix <code>from atlsource</code>.</li> <li>set the component[type] value by type inheritance.</li> <li>set the component[tags] value</li> <li>returns the value <code>multipleSource</code> in case (<code>$singleton</code> &amp;&amp; exists more than 1 resource), returns <code>oneSource</code> otherwise.</li> <li>returns the <code>resource_type</code> as <code>oneSource</code> attribute</li> <li>returns the \"<code>resource_name (resource_type)</code>\" as <code>multipleSource</code> attribute</li> </ol> <p> The values provided in the mapping file are always preferred over the template\u2019s  ones.</p> Mapping fileInternal Mapping file Resource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:       s3\n$source:    {$type: \"aws_s3_bucket\"}\n$altsource:\n- $mappingType: {$type: \"aws_vpc_endpoint\"}\n$mappingPath: {$path: \"*.service_name | [0]\"}\n$mappingLookups:\n- regex: ^(.*)s3$\nname: S3 from VPCEndpoint\ndataflows: []\n</code></pre> <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:   s3\nname:   {$numberOfSources: {\n        oneSource: {$path: \"resource_name\"},\n        multipleSource: {$format: \"{type} (grouped)\"}}}\n$source:    {$type: \"aws_s3_bucket\"}\n$altsource:\n- $mappingType: {$type: \"aws_vpc_endpoint\"}\n$mappingPath: {$path: \"*.service_name | [0]\"}\n$mappingLookups:\n- regex: ^(.*)s3$\nname: S3 from VPCEndpoint\ntype: s3\ntags:\n- {$numberOfSources:\n{oneSource: {$path: \"resource_type\"},                     multipleSource: {$format: \"{resource_name} ({resource_type})\"}}}\nparent: {$parent: public-cloud-01}\ntags:\n- {$numberOfSources: {\n            oneSource: {$path: \"resource_type\"},             multipleSource: {$format: \"{resource_name} ({resource_type})\"}}}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_vpc_endpoint\" \"s3\" {\nvpc_id            = data.aws_vpc.selected.id\nservice_name      = \"com.amazonaws.${var.region}.s3\"\nvpc_endpoint_type = \"Interface\"\nprivate_dns_enabled = true\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_vpc_endpoint-s3-altsource\nname: S3 from VPCEndpoint\ntype: s3\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_vpc_endpoint\ndataflows: []\n</code></pre> <p> Note that the template component name is override for $mappingLookups[].name on the  Mapping File.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#mapping-a-parent","title":"Mapping a Parent","text":"<p> The order of the components is important because parent components must be defined  before child components.</p> <p>When mapping a component, the default TrustZone is set to the parent component value by the component template pattern, nevertheless, it can be modified to set other TrustZones or Component with the attribute <code>component['parent']</code> in the mapping file.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        empty-component\n$source:     {$type: \"aws_subnet\"}\n- type:        load-balancer\n$source:     {$type: [\"aws_lb\", \"aws_elb\"]}\nparent:      {$path: \"resource_properties.subnets\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_subnet\" \"PrivateSubnet1\" {\nvpc_id     = aws_vpc.CustomVPC.id\ncidr_block = \"10.0.2.0/24\"\n}\nresource \"aws_subnet\" \"PrivateSubnet2\" {\nvpc_id     = aws_vpc.CustomVPC.id\ncidr_block = \"10.0.3.0/24\"\n}\nresource \"aws_lb\" \"ServiceLB\" {\nsubnets   = [aws_subnet.PrivateSubnet1.id, aws_subnet.PrivateSubnet2.id]\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_subnet-privatesubnet1\nname: PrivateSubnet1\ntype: empty-component\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_subnet\n- id: public-cloud-01.aws_subnet-privatesubnet2\nname: PrivateSubnet2\ntype: empty-component\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_subnet\n- id: &gt;-\npublic-cloud-01.aws_subnet-privatesubnet1.aws_lb-servicelb\nname: ServiceLB\ntype: load-balancer\nparent:\ncomponent: public-cloud-01.aws_subnet-privatesubnet1\ntags:\n- aws_lb\n- id: &gt;-\npublic-cloud-01.aws_subnet-privatesubnet2.aws_lb-servicelb\nname: ServiceLB\ntype: load-balancer\nparent:\ncomponent: public-cloud-01.aws_subnet-privatesubnet2\ntags:\n- aws_lb\ndataflows: []\n</code></pre> <p>  This mapper defines a load-balancer by resources of type <code>aws_lb</code> or <code>aws_elb</code> and sets its  parent by its <code>resource_properties.subnets</code> value. This component will be created as many times as subnets exist.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#mapping-a-children","title":"Mapping a Children","text":"<p> The order of the components is important because parent components must be defined  before child components.</p> <p>When mapping a component, it can define what components are their children on the OTM. $children will set the parent attribute of those components on the OTM.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        elastic-container-service\n$source:     {$type:  \"aws_ecs_service\"}\nparent:      {$path:  \"resource_properties.network_configuration[0].subnets\"}\n$children:    {$path:  \"resource_properties.task_definition|split(@, '.')[1]\"}\n- type:        docker-container\n$source:     {$type: \"aws_ecs_task_definition\"}\ndataflows: []\n</code></pre> <pre><code>resource \"aws_ecs_task_definition\" \"service\" { }\nresource \"aws_ecs_service\" \"mongo\" {\ntask_definition = aws_ecs_task_definition.service.arn\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_ecs_service-mongo\nname: mongo\ntype: elastic-container-service\nparent:\ntrustZone: public-cloud-01\ntags:\n- aws_ecs_service\n- id: public-cloud-01.aws_ecs_service-mongo.aws_ecs_task_definition-service\nname: service\ntype: docker-container\nparent:\ncomponent: public-cloud-01.aws_ecs_service-mongo\ntags:\n- aws_ecs_task_definition\ndataflows: [] </code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#mapping-a-module","title":"Mapping a Module","text":"<p>The modules imported in a Terraform file can be mapped into OTM components using the special mapping field <code>$module</code> to match the <code>module[].source</code> value.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type: rds\n$source: {$module: \"terraform-aws-modules/rds/aws\"}\n- type: vpc\n$source: {$module: \"terraform-aws-modules/vpc/aws\"}\n- type: load-balancer\n$source: {$module: \"terraform-aws-modules/alb/aws\"}\ndataflows: []\n</code></pre> <pre><code>module \"db\" {\nsource  = \"terraform-aws-modules/rds/aws\"\n}\nmodule \"vpc\" {\nsource  = \"terraform-aws-modules/vpc/aws\"\n}\nmodule \"alb\" {\nsource  = \"terraform-aws-modules/alb/aws\"\n}\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.db\nname: db\ntype: rds\nparent:\ntrustZone: public-cloud-01\ntags:\n- terraform-aws-modules/rds/aws\n- id: public-cloud-01.vpc\nname: vpc\ntype: vpc\nparent:\ntrustZone: public-cloud-01\ntags:\n- terraform-aws-modules/vpc/aws\n- id: public-cloud-01.alb\nname: alb\ntype: load-balancer\nparent:\ntrustZone: public-cloud-01\ntags:\n- terraform-aws-modules/alb/aws\ndataflows: []\n</code></pre>"},{"location":"startleft-processors/iac/tf/Terraform-how-mapping-file-works/#how-to-map-dataflows","title":"How To Map Dataflows","text":"<p>The Dataflows is a Threat Modelling concept that will never be present as is in the Terraform source file. Thus, the <code>slp_tf</code> relies on the configuration defined in the <code>dataflows</code> section of the Mapping File.  <pre><code>dataflows: # (1)!\n- name:         {$format: \"S3 dataflow from {resource_type}\"} # (2)!\n$source:      {$type: \"aws_s3_bucket_logging\"} # (3)!\nsource:       {$path: \"resource_properties.bucket\" } # (4)!\ndestination:  {$path: \"resource_properties.target_bucket\"} # (5)!\ntags: # (6)!\n- $format: \"Dataflow created by {resource_type}-{resource_name}\"\n</code></pre></p> <ol> <li>dataflows section defines the Dataflows mapping behavior.</li> <li>set dataflow[name] value</li> <li>special mapping fields <code>$source</code> this attribute is used to configure the mapping behavior which will create a dataflow</li> <li>set dataflow[source] value using any attribute available at the $source</li> <li>set dataflow[destination] value using any attribute available at the $source</li> <li>Optional: set component[tag] value</li> </ol> <p> The mapping name attribute is optional, resource_name will use as default</p> <p>The creation of some dataflow may depend on the existence of some resources in the original file. To configure this  behavior, the <code>$source</code> attribute is used.</p> Mapping fileResource FileOTM <pre><code>trustzones:\n- id:   public-cloud-01\nname: Public Cloud\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91\n$default: true\ncomponents:\n- type:        s3\n$source:     {$type: \"aws_s3_bucket\"}\ndataflows:\n- name:         {$format: \"S3 dataflow from {resource_type}\"}\n$source:      {$type: \"aws_s3_bucket_logging\"}\nsource:       {$path: \"resource_properties.bucket\" }\ndestination:  {$path: \"resource_properties.target_bucket\"}\ntags:\n- $format: \"Dataflow created by {resource_type}-{resource_name}\"\n</code></pre> <pre><code>resource \"aws_s3_bucket_logging\" \"logging\" {\nbucket = aws_s3_bucket.bucket.id target_bucket = aws_s3_bucket.log_bucket.id\n}\nresource \"aws_s3_bucket\" \"bucket\" { }\nresource \"aws_s3_bucket\" \"log_bucket\" { }\n</code></pre> <pre><code>otmVersion: 0.1.0\nproject:\nname: name\nid: id\nrepresentations:\n- name: Terraform\nid: Terraform\ntype: code\ntrustZones:\n- id: b61d6911-338d-46a8-9f39-8dcd24abfe91\nname: Public Cloud\nrisk:\ntrustRating: 10\ncomponents:\n- id: public-cloud-01.aws_s3_bucket-bucket\nname: bucket\ntype: s3\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_s3_bucket\n- id: public-cloud-01.aws_s3_bucket-log_bucket\nname: log_bucket\ntype: s3\nparent:\ntrustZone: b61d6911-338d-46a8-9f39-8dcd24abfe91\ntags:\n- aws_s3_bucket\ndataflows:\n- id: 591089c3-9dc1-42c0-a574-3674f2d9deaf\nname: S3 dataflow from aws_s3_bucket_logging\nsource: public-cloud-01.aws_s3_bucket-bucket\ndestination: public-cloud-01.aws_s3_bucket-log_bucket\ntags:\n- Dataflow created by aws_s3_bucket_logging-logging\n</code></pre> <p> The dataflow identifier is generated internally by the <code>slp_tf</code>.</p> <p>As Terraform Dataflows may be a complicated concept, refer to the  How Dataflow Mapping works section for deeper explanation.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-to-create-a-basic-mapping-file/","title":"How to Create a Terraform mapping","text":"<p>A source mapping file (or 'mapping file' for short) describes how to find and map components, dataflows, and TrustZones in source file data structures.</p> <p>This mapping file is divided into three sections which correspond to the main sections in an OTM file:</p> <ul> <li><code>trustzones</code>.</li> <li><code>components</code>.</li> <li><code>dataflows</code>.</li> </ul> <p>To define the mapping behavior, a Domain-Specific Language has been created to abstract the implementation details  inside the <code>slp_tf</code>, providing a set of <code>$functions</code> containing the logic around a collection of JMESPath queries that  are used.</p> <p>Take a look at the JSONSchema file and the Open Threat Model specification for more details.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-to-create-a-basic-mapping-file/#how-to-create-a-basic-mapping-file","title":"How to create a Basic Mapping File","text":"<p>This section is a Getting Started Guide for a basic mapping file for Terraform.</p> <p>For a more in-deep explanation, there is available a How Mapping File works page and a complete guide about the Domain-Specific language.</p>"},{"location":"startleft-processors/iac/tf/Terraform-how-to-create-a-basic-mapping-file/#minimal-mapping-file-configuration","title":"Minimal mapping file configuration","text":"<p> Some boilerplate mapping configuration is included out-of-the-box, take a look to How Mapping File works to more details</p> <p>There is a set of easy-to-use functions that fulfill the most common mapping requirements. Here appear the minimal  mapping configuration examples that include these functions with their explanation:</p> <pre><code>trustzones: # (1)!\n- id:   public-cloud-01 # (2)!\nname: Public Cloud # (3)!\ntype: b61d6911-338d-46a8-9f39-8dcd24abfe91 # (16)!\n$default: true # (4)!\n- id:   internet-01\nname: Internet\ntype: f0ba7722-39b6-4c81-8290-a30a248bb8d9\n$source: {$singleton: # (5)!\n{$type: \"aws_security_group\", # (6)!\n                 $props: \"egress[0].cidr_blocks\"} # (7)!\n}\ncomponents: # (8)!\n- type:        ec2 # (9)!\n$source: # (10)! \n{$type: \"aws_instance\"} # (11)! \n- type:        generic-client\n$source:     {$type: \"aws_security_group\",  # (12)!\n                  $props: \"egress[0].cidr_blocks\"} parent:      internet-01 # (13)!\ntags: # (14)!\n- Outbound connection destination IP\ndataflows: [] # (15)!\n</code></pre> <ol> <li>trustzones section defines the TrustZone mapping behavior. At least one TrustZone is needed to be defined</li> <li>set trustzone[id] value, which also can be used as a reference when setting the parent of a component <code>parent: public-cloud</code>. The <code>id</code> field uniquely identifies a trustzone, and differentiates it from other trustzones of the same type.</li> <li>set trustzone[name] value</li> <li>Optional: default trustzone to be used if a component does not define its parent</li> <li>All the matching resources will be unified under a single TrustZone which will be created in case the <code>{$type: \"aws_security_group\", $props: \"egress[0].cidr_blocks\"}</code> query returns any element</li> <li>mapping function <code>$type</code> performs a search along the entire resource list to return the element with the matching type</li> <li>mapping function <code>$props</code> performs a search along the entire resource list to return the element with the matching props</li> <li>components section defines the component mapping behavior</li> <li>set component[type] value</li> <li>special mapping field <code>$source</code> set the selected resources as the object to be mapped</li> <li>mapping function <code>$type</code> performs a search along the entire resource list to return the element with the matching type</li> <li>mapping function performs a query combining <code>$type</code> and <code>$props</code> functions returning a list of $source to be mapped into a component for each existing Terraform resource that matches those conditions</li> <li>Optional: set component[parent] as the Internet TrustZone</li> <li>Optional: set component[tag] value</li> <li>dataflows section is explained in detail on How Dataflow Mapping works</li> <li>set trustzone[type] value. For mapping trustzones to IriusRisk trustzones, <code>type</code> field must take internal IriusRisk values depending on the type of trustzone.</li> </ol>"},{"location":"startleft-processors/iac/tf/Terraform-how-to-create-a-basic-mapping-file/#special-mapping-fields","title":"Special mapping fields","text":"<p>These functions begin with a dollar sign ($) and do not directly contribute to the OTM output.  Instead, they specify an action or behavior used to process the source files or generate the OTM output.</p> $functions Description Applies to $default Specifies the TrustZone as default TrustZones $source Specifies the source of the object type Components, TrustZones &amp; Dataflows <p>Here you can find the complete list of special mapping fields. </p>"},{"location":"startleft-processors/iac/tf/Terraform-how-to-create-a-basic-mapping-file/#mapping-functions","title":"Mapping functions","text":"<p>These functions are used as parameters of the mapping attributes for configuring its behavior. </p> $functions Type Description Consumes Produces $type filter Finds a resource by its type A list of resources A resources list filtered by type $props filter Finds a resource by its properties A list of resources A resources list filtered by the given props $singleton group Specific objects to be unified under a single component or TrustZone A list of resources A list of resources grouped by the given params <p>Here you can find the complete list of Mapping functions.</p>"},{"location":"usage/Command-Line-Interface/","title":"Command Line Interface (CLI)","text":"<p>Serverless CLI mode is the original Startleft operation mode where:</p> <ul> <li> <p>Startleft runs as a standalone application.</p> </li> <li> <p>Execution is performed via CLI in local machine.</p> </li> <li> <p>Input files are in local machine.</p> </li> <li> <p>Mapping file may be Startleft default or another user-defined may be specified.</p> </li> </ul>"},{"location":"usage/Command-Line-Interface/#command-help","title":"Command Help","text":"<p>For help, just run <code>startleft</code> without arguments:</p> <p><pre><code>$ startleft\nUsage: startleft [OPTIONS] COMMAND [ARGS]...\n\nParse IaC and other files to the Open Threat Model format\n\nOptions:\n  -l, --log-level [CRIT|ERROR|WARN|INFO|DEBUG|NONE]\nSet the log level.\n  -v, --verbose / -nv, --no-verbose\n                                  Makes logging more verbose.\n  --version                       Show the version and exit.\n  --help                          Show this message and exit.\n\nCommands:\n  parse     Parses source files into Open Threat Model\n  search    Searches source files for the given query\n  server    Launches the REST server to generate OTMs from requests\n  validate  Validates a mapping or OTM file\n</code></pre> You can also get help for specific commands.</p> Example for <code>parse</code> command help <pre><code>    $ startleft parse --help\n    Usage: startleft parse [OPTIONS] SOURCE_FILE...\n    Parses source files into Open Threat Model\n\nOptions:\n      -t, --iac-type [CLOUDFORMATION|TERRAFORM]\nThe IaC file type. NOTE: This argument is\n                                      mutually exclusive with  arguments:\n                                      [custom_mapping_file, etm_type,\n                                      diagram_type, default_mapping_file].\n      -g, --diagram-type [VISIO|LUCID]      The diagram file type. NOTE: This\n                                      argument is mutually exclusive with\n                                      arguments: [mapping_file, iac_type].\n      -e, --etm-type [MTMT]           The etm file type. NOTE: This argument is\n                                      mutually exclusive with  arguments:\n                                      [mapping_file, diagram_type, iac_type].\n      -m, --mapping-file TEXT         Mapping file to parse the IaC file. NOTE:\n                                      This argument is mutually exclusive with\n                                      arguments: [etm_type, default_mapping_file,\n                                      diagram_type, custom_mapping_file].\n      -d, --default-mapping-file TEXT\n                                      Default mapping file to parse the diagram\n                                      file. NOTE: This argument is mutually\n                                      exclusive with  arguments: [mapping_file,\n                                      iac_type]. -c, --custom-mapping-file TEXT  Custom mapping file to parse the diagram\n                                      file.\n      -o, --output-file TEXT          OTM output file.\n      -n, --project-name TEXT         Project name.  [required]\n-i, --project-id TEXT           Project id.  [required]\n--help                          Show this message and exit.\n</code></pre>"},{"location":"usage/Command-Line-Interface/#command-summary","title":"Command Summary","text":"<p>The list of commands that can be used to work in CLI mode is detailed as follows:</p> Command Description parse Parses source files into Open Threat Model. validate Validates a mapping or OTM file. search Searches source files for the given query. server Launches the REST server to generate OTMs from requests."},{"location":"usage/Command-Line-Interface/#parse","title":"Parse","text":"<p>This command is used for parsing source files into the Open Threat Model format.</p> <p>The options that it supports are:</p> <pre><code>  -t, --iac-type [CLOUDFORMATION|TERRAFORM]\nThe IaC file type. NOTE: This argument\n                                  is mutually exclusive with  arguments:\n                                  [custom_mapping_file,\n                                  default_mapping_file, diagram_type].\n  -g, --diagram-type [VISIO|LUCID]      The diagram file type. NOTE: This\n                                  argument is mutually exclusive with\n                                  arguments: [mapping_file, iac_type].\n  -m, --mapping-file TEXT         Mapping file to parse the IaC file.\n                                  NOTE: This argument is mutually\n                                  exclusive with  arguments:\n                                  [custom_mapping_file,\n                                  default_mapping_file, diagram_type].\n  -d, --default-mapping-file TEXT\n                                  Default mapping file to parse the\n                                  diagram or ETM file. NOTE: This argument is\n                                  mutually exclusive with  arguments:\n                                  [mapping_file, iac_type].\n  -c, --custom-mapping-file TEXT  Custom mapping file to parse the\n                                  diagram or ETM file.\n  -o, --output-file TEXT          OTM output file.\n  -n, --project-name TEXT         Project name.  [required]\n-i, --project-id TEXT           Project id.  [required]\n--help                          Show this message and exit.\n</code></pre> <p> Notice that the argument with the <code>IaC or diagram file name</code> to parse is not  preceded by a parameter </p> CLI executionOutputFile <pre><code>startleft parse \\\n--iac-type TERRAFORM \\\n--mapping-file iriusrisk-tf-aws-mapping.yaml \\\n--output-file multinetwork_security_groups_with_lb.otm \\\n--project-name \"Terraform MN Security Groups with LB\" \\\n--project-id \"tf-mn-sg-lb\" \\\nmultinetwork_security_groups_with_lb.tf\n</code></pre> <pre><code>Parsing source files into OTM\nParsing IaC source files into OTM\nValidating Terraform file\nMapping file size is valid\nLoading schema file 'iac_tf_mapping_schema.json'\nMapping files are valid\nMapping files are valid\nMapping file size is valid\nLoading mapping data\nAdding trustzones\nAdded 2 trustzones successfully\nAdding components\nAdded 22 components successfully\nAdding dataflows\nAdded 22 dataflows successfully\nLoading schema file 'otm_schema.json'\nOTM file schema is valid\nOTM file has consistent IDs\nOTM file validated successfully\nWriting OTM file to 'multinetwork_security_groups_with_lb.otm'\n</code></pre> <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"Terraform MN Security Groups with LB\",\n\"id\": \"tf-mn-sg-lb\"\n},\n\"representations\": [\n{\n\"name\": \"Terraform\",\n\"id\": \"Terraform\",\n\"type\": \"code\"\n}\n],\n\"trustZones\": [\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"name\": \"Public Cloud\",\n\"risk\": {\n\"trustRating\": 10\n}\n},\n{\n\"id\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\",\n\"name\": \"Internet\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n],\n\"components\": [\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_vpc-customvpc\",\n\"name\": \"CustomVPC\",\n\"type\": \"vpc\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n},\n\"tags\": [\n\"aws_vpc\"\n]\n},\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_vpc-customvpc.aws_subnet-privatesubnet1\",\n\"name\": \"PrivateSubnet1\",\n\"type\": \"empty-component\",\n\"parent\": {\n\"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.aws_vpc-customvpc\"\n},\n\"tags\": [\n\"aws_subnet\"\n]\n}\n[...] Reduced for simplicity\n</code></pre> <p>You can also parse more than one IaC file as in this other example:</p> CLI executionOutputFile <pre><code>startleft parse \\\n--iac-type CLOUDFORMATION \\\n--project-name \"cft_multiple_files_project\" \\\n--project-id cft_multiple_files_project_id \\\n--mapping-file iriusrisk-cft-mapping.yaml \\\nnetworks_cft_file.json \\\nresources_cft_file.json\n</code></pre> <pre><code>Parsing source files into OTM\nParsing IaC source files into OTM\nValidating CloudFormation file\nMapping file size is valid\nLoading schema file 'iac_cft_mapping_schema.json'\nMapping files are valid\nMapping files are valid\nMapping file size is valid\nLoading mapping data\nAdding trustzones\nAdded 2 trustzones successfully\nAdding components\nAdded 22 components successfully\nAdding dataflows\nAdded 22 dataflows successfully\nLoading schema file 'otm_schema.json'\nOTM file schema is valid\nOTM file has consistent IDs\nOTM file validated successfully\nWriting OTM file to 'threatmodel.otm'\n</code></pre> <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"cft_multiple_files_project\",\n\"id\": \"cft_multiple_files_project_id\"\n},\n\"representations\": [\n{\n\"name\": \"CloudFormation\",\n\"id\": \"CloudFormation\",\n\"type\": \"code\"\n}\n],\n\"trustZones\": [\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"name\": \"Public Cloud\",\n\"risk\": {\n\"trustRating\": 10\n}\n},\n{\n\"id\": \"f0ba7722-39b6-4c81-8290-a30a248bb8d9\",\n\"name\": \"Internet\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n],\n\"components\": [\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\",\n\"name\": \"CustomVPC\",\n\"type\": \"vpc\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n},\n\"tags\": [\n\"AWS::EC2::VPC\"\n]\n},\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc.privatesubnet1\",\n\"name\": \"PrivateSubnet1\",\n\"type\": \"empty-component\",\n\"parent\": {\n\"component\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91.customvpc\"\n},\n\"tags\": [\n\"AWS::EC2::Subnet\"\n]\n},\n[...] Reduced for simplicity\n</code></pre> <p>There are different combinations that we can use, but we have to take into account the above required arguments. An  example of a diagram parse is shown below.</p> CLI executionOutputFile <pre><code>startleft parse \\\n--diagram-type VISIO \\\n--default-mapping-file iriusrisk-visio-aws-mapping.yaml \\\n--output-file visio-basic-example.otm \\\n--project-name \"VISIO Basic Example\" \\\n--project-id \"vs-bs-ex\" \\\nvisio-basic-example.vsdx\n</code></pre> <pre><code>Parsing source files into OTM\nParsing diagram source files into OTM\nValidating visio file\nMapping file size is valid\nLoading schema file 'diagram_mapping_schema.json'\nMapping files are valid\nMapping files are valid\nMapping file size is valid\nLoading mapping data\nLoading schema file 'otm_schema.json'\nOTM file schema is valid\nOTM file has consistent IDs\nOTM file validated successfully\nWriting OTM file to 'visio-basic-example.otm'\n</code></pre> <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"VISIO Basic Example\",\n\"id\": \"vs-bs-ex\"\n},\n\"representations\": [\n{\n\"name\": \"Visio\",\n\"id\": \"Visio\",\n\"type\": \"diagram\",\n\"size\": {\n\"width\": 1000,\n\"height\": 1000\n}\n}\n],\n\"trustZones\": [\n{\n\"id\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\",\n\"name\": \"Public Cloud\",\n\"risk\": {\n\"trustRating\": 10\n}\n},\n{\n\"id\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\",\n\"name\": \"Private Secured\",\n\"risk\": {\n\"trustRating\": 10\n}\n}\n],\n\"components\": [\n{\n\"id\": \"12\",\n\"name\": \"My EC2\",\n\"type\": \"ec2\",\n\"parent\": {\n\"trustZone\": \"b61d6911-338d-46a8-9f39-8dcd24abfe91\"\n}\n},\n{\n\"id\": \"30\",\n\"name\": \"Private Database\",\n\"type\": \"rds\",\n\"parent\": {\n\"trustZone\": \"2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\"\n}\n}\n],\n\"dataflows\": [\n{\n\"id\": \"34\",\n\"name\": \"998dcc87-ab45-4ac5-9e6a-62d08ce73a20\",\n\"source\": \"12\",\n\"destination\": \"30\"\n}\n]\n}\n</code></pre>"},{"location":"usage/Command-Line-Interface/#differences-between-parsing-diagram-and-iac-files","title":"Differences between parsing Diagram and IaC files","text":"<p>We have seen that there are some differences when parsing diagram and IaC files. Here we will detail what  they are and how to proceed.</p> Option Description Diagram IaC Example None The IaC / diagram file to parse. Required Required multinetwork_security_groups_with_lb.tf -t, --iac-type The IaC file type. - Required TERRAFORM -g, --diagram-type The diagram file type. Required - VISIO -m, --mapping-file Mapping file to parse the IaC file. - Required iriusrisk-tf-aws-mapping.yaml -d, --default-mapping-file Default mapping file to parse the diagram file. Required - iriusrisk-visio-aws-mapping.yaml -c, --custom-mapping-file Custom mapping file to parse the  diagram file. Optional - custom-visio-aws-mapping.yaml -o, --output-file OTM output file. Optional Optional visio-basic-example.otm -n, --project-name Project name. Required Required \"VISIO Basic Example\" -i, --project-id Project id. Required Required \"vs-bs-ex\" <p>If we want to parse an <code>IaC</code> file, we should specify:</p> <ul> <li>The IaC file we want to parse.</li> <li>The IaC type.</li> <li>The mapping file we want to use to parse the IaC file.</li> <li>The project name.</li> <li>The project id.</li> <li>Optionally the name of the OTM output file.</li> </ul> Correct example for IaC <pre><code>startleft parse \\\n--iac-type TERRAFORM \\\n--mapping-file iriusrisk-tf-aws-mapping.yaml \\\n--output-file elb.otm \\\n--project-name \"Terraform ELB example\" \\\n--project-id \"tf-elb-ex\" \\\nelb.tf\n</code></pre> Incorrect example for IaC <p><pre><code>startleft parse \\\n--iac-type TERRAFORM \\\n--default-mapping-file iriusrisk-tf-aws-mapping.yaml \\\n--project-name \"Terraform ELB example\" \\\n--project-id \"tf-elb-ex\" \\\nelb.tf\n</code></pre> The --mapping-file option is missed and the diagram --default-mapping-file option is added to parse an IaC file.</p> <p>On the other hand, if we want to parse a <code>diagram</code> file, we should specify the following options:</p> <ul> <li>The diagram file we want to parse.</li> <li>The diagram's type.</li> <li>The default mapping file we want to use to parse the diagram file.</li> <li>Optionally, the custom mapping file that we have created to parse the diagram file.</li> <li>The project's name.</li> <li>The project id.</li> <li>Optionally the name of the OTM output file.</li> </ul> Correct example for diagram <pre><code>startleft parse \\\n--diagram-type VISIO \\\n--default-mapping-file iriusrisk-visio-aws-mapping.yaml \\\n--output-file aws-with-tz-and-vpc.otm \\\n--project-name \"Aws with tz and vpt\" \\\n--project-id \"vs-aws-tz-vpc\" \\\naws-with-tz-and-vpc.vsdx\n</code></pre> Incorrect example for diagram <p><pre><code>startleft parse \\\n--diagram-type VISIO \\\n--custom-mapping-file iriusrisk-visio-aws-mapping.yaml \\\n--project-name \"Aws with tz and vpt\" \\\n--project-id \"vs-aws-tz-vpc\" \\\naws-with-tz-and-vpc.vsdx\n</code></pre> The --default-mapping-file option is missed.</p>"},{"location":"usage/Command-Line-Interface/#validate","title":"Validate","text":"<p>Validation is a CLI-specific feature and is used to validate both OTM and mapping files.  </p> <p>The full set of options are:</p> <pre><code>Usage: startleft validate [OPTIONS]\nValidates a mapping or OTM file\n\nOptions:\n  -m, --mapping-file TEXT         Mapping file to validate. NOTE: This\n                                  argument is mutually exclusive with\n                                  arguments: [otm_file]. [required]\n-t, --mapping-type [CLOUDFORMATION|TERRAFORM|VISIO|MTMT|LUCID]\nMapping file type to validate. NOTE: This\n                                  argument is mutually exclusive with\n                                  arguments: [otm_file]. [required]\n-o, --otm-file TEXT             OTM input file. NOTE: This argument is\n                                  mutually exclusive with  arguments:\n                                  [mapping_file]. [required]\n--help                          Show this message and exit.\n</code></pre> Validating <code>Mapping files</code> and <code>OTM files</code> <p>If we want to validate a mapping file, we should indicate its type. So if we use the <code>--mapping-file</code> option with the file we want to check,  we should use the mandatory <code>--mapping-type</code> parameter which indicates the specific type of the given mapping file.</p> <p>On the other hand, if we want to validate an otm file, we should use the <code>--otm-file</code> option without <code>--mapping-type</code>.</p> <p>Both <code>--mapping-file</code> and <code>--otm-file</code> are mutually exclusive.</p> <p> We can use this command only to validate one file at once</p> <p>OTM validation is a special feature of StartLeft, as it does not apply to any format and instead allows users  to validate OTM files generated in any way, including manually. </p> CLI executionOutputOTM file <pre><code>startleft validate \\\n--otm-file threatmodel.otm </code></pre> <pre><code>Validating OTM file\nLoading schema file '/otm/resources/schemas/otm_schema.json'\nOTM file schema is valid\nOTM file has consistent IDs\nOTM file validated successfully\n</code></pre> <pre><code>    otmVersion: 0.1.0\nproject:\nname: Manual ThreatModel\nid:   manual-threatmodel\ntrustZones:\n- id:   f0ba7722-39b6-4c81-8290-a30a248bb8d9\nname: Internet\nrisk:\ntrustRating: 1\n- id:   6376d53e-6461-412b-8e04-7b3fe2b397de\nname: Public\nrisk:\ntrustRating: 1\n- id:   2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\nname: Private Secured\nrisk:\ntrustRating: 100\ncomponents:\n- id:     user\nname:   User\ntype:   generic-client\nparent:\ntrustZone: f0ba7722-39b6-4c81-8290-a30a248bb8d9\n- id:     web-server\nname:   Web server\ntype:   web-application-server-side\nparent:\ntrustZone: 6376d53e-6461-412b-8e04-7b3fe2b397de\n- id:     database\nname:   Database\ntype:   postgresql\nparent:\ntrustZone: 2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\ndataflows:\n- id:     client-connection\nname:   Client connection\nsource:   user\ndestination:   web-server\n- id:     database-connection\nname:   Database connection\nsource:   web-server\ndestination:     database\n</code></pre> <p>An example with a mapping file:</p> CLI executionOutput <pre><code>startleft validate \\\n--mapping-file iriusrisk-visio-aws-mapping.yaml \\ \n--mapping-type VISIO\n</code></pre> <pre><code>Validating: VISIO mapping files\nLoading schema file '/slp_visio/resources/schemas/diagram_mapping_schema.json'\nMapping file size is valid\nMapping files are valid\n</code></pre>"},{"location":"usage/Command-Line-Interface/#search","title":"Search","text":"<p>This command runs a JMESPath search query against  the provided source file and outputs the matching results. It is only available for <code>IaC</code> source files  and the full set of options are:</p> <pre><code>  -t, --iac-type [CLOUDFORMATION|TERRAFORM]\nThe IaC file type.  [required]\n-q, --query TEXT                JMESPath query to run against the IaC file.\n  --help                          Show this message and exit.\n</code></pre> <p> Notice that the argument with the <code>IaC file name</code> is not  preceded by a parameter </p> <code>Terraform</code> example CLI executionOutputFile <pre><code>startleft search \\\n--iac-type TERRAFORM \\\n--query \"resource|[?resource_type=='aws_vpc']\" \\\nmultinetwork_security_groups_with_lb.tf\n</code></pre> <pre><code>[...] Reduced for simplicity\n--- Results ---\n[\n{\n\"aws_vpc\": {\n\"CustomVPC\": {\n\"cidr_block\": \"${var.vpcCidrblock}\"\n}\n},\n    \"resource_type\": \"aws_vpc\",\n    \"resource_name\": \"CustomVPC\",\n    \"resource_properties\": {\n\"cidr_block\": \"${var.vpcCidrblock}\"\n},\n    \"Type\": \"aws_vpc\",\n    \"_key\": \"CustomVPC\",\n    \"Properties\": {\n\"cidr_block\": \"${var.vpcCidrblock}\"\n}\n}\n]\n</code></pre> <pre><code>variable \"vpcCidrblock\" {\ntype    = list\ndefault = [\"10.0.0.0/16\"]\n}\nvariable \"ingressCidrblock\" {\ntype    = list\ndefault = [\"0.0.0.0/0\"]\n}\nresource \"aws_vpc\" \"CustomVPC\" {\ncidr_block  = var.vpcCidrblock\n}\nresource \"aws_subnet\" \"PrivateSubnet1\" {\nvpc_id     = aws_vpc.CustomVPC.id\ncidr_block = \"10.0.2.0/24\"\n}\nresource \"aws_subnet\" \"PrivateSubnet2\" {\nvpc_id     = aws_vpc.CustomVPC.id\ncidr_block = \"10.0.3.0/24\"\n}\n[...] Reduced for simplicity\n</code></pre> <code>Cluodformation</code> example CLI executionOutputFile <pre><code>startleft search \\\n--iac-type CLOUDFORMATION \\\n--query \"Resources|squash(@)[?Type=='AWS::ElasticLoadBalancingV2::LoadBalancer']\" \\\nmultinetwork_security_groups_with_lb.json\n</code></pre> <pre><code>[...] Reduced for simplicity\n--- Results ---\n[\n{\n\"Type\": \"AWS::ElasticLoadBalancingV2::LoadBalancer\",\n    \"Properties\": {\n\"LoadBalancerAttributes\": [\n{\n\"Key\": \"deletion_protection.enabled\",\n          \"Value\": \"false\"\n}\n],\n      \"Scheme\": \"internal\",\n      \"SecurityGroups\": [\n{\n\"Fn::GetAtt\": [\n\"ServiceLBSecurityGroup\",\n            \"GroupId\"\n]\n}\n],\n      \"Subnets\": [\n{\n\"Fn::ImportValue\": \"ECSFargateGoVPCStack:ExportsOutputRefVPCPrivateSubnet1SubnetXYZ\"\n},\n        {\n\"Fn::ImportValue\": \"ECSFargateGoVPCStack:ExportsOutputRefVPCPrivateSubnet2SubnetABC\"\n}\n],\n      \"Type\": \"application\"\n},\n    \"_key\": \"ServiceLB\"\n}\n]\n</code></pre> <pre><code>[...] Reduced for simplicity\n\"ServiceLB\": {\n\"Type\": \"AWS::ElasticLoadBalancingV2::LoadBalancer\",\n\"Properties\": {\n\"LoadBalancerAttributes\": [\n{\n\"Key\": \"deletion_protection.enabled\",\n\"Value\": \"false\"\n}\n],\n\"Scheme\": \"internal\",\n\"SecurityGroups\": [\n{\n\"Fn::GetAtt\": [\n\"ServiceLBSecurityGroup\",\n\"GroupId\"\n]\n}\n],\n\"Subnets\": [\n{\n\"Fn::ImportValue\": \"ECSFargateGoVPCStack:ExportsOutputRefVPCPrivateSubnet1SubnetXYZ\"\n},\n{\n\"Fn::ImportValue\": \"ECSFargateGoVPCStack:ExportsOutputRefVPCPrivateSubnet2SubnetABC\"\n}\n],\n\"Type\": \"application\"\n}\n},\n</code></pre>"},{"location":"usage/Command-Line-Interface/#server","title":"Server","text":"<p>This is the latest Startleft operation mode where it runs as a server with its own <code>REST API endpoints</code> that  receive one or more IaC files, process them and give back the OTM file in the response. The available options are:</p> <pre><code>    -p, --port INTEGER  Startleft deployment port.\n    --help              Show this message and exit.\n</code></pre> CLI executionOutput <pre><code>startleft server \\\n--port 5000\n</code></pre> <pre><code>INFO    cli - Startleft version: 1.10.0\nINFO    server - Started server process []\nINFO    on - Waiting for application startup.\nINFO    on - Application startup complete.\nINFO    server - Uvicorn running on http://127.0.0.1:5000 (Press CTRL+C to quit)\n</code></pre>"},{"location":"usage/REST-API/","title":"REST API","text":""},{"location":"usage/REST-API/#usage","title":"Usage","text":"<p>StartLeft can also be deployed as a standalone REST server if you prefer to communicate via API. In this operation mode, StartLeft returns the OTM file in the HTTP response. You can launch the application as a server with the following command:</p> <p><code>startleft server</code></p> <p>The <code>--help</code> option provides more details about the usage: <pre><code>startleft server --help\nUsage: startleft server [OPTIONS]...\n\nLaunches the REST server to generate OTMs from requests\n\nOptions:\n  -p, --port INTEGER  StartLeft deployment port.\n  --help              Show this message and exit.\n</code></pre> If not specified, port 5000 will be used by default.</p> <p>You can see and try the endpoints provided by opening the following URL in a web browser: http://localhost:5000/docs</p> <p>Note</p> <p>When executing <code>startleft server</code> the following command-line message indicates that StartLeft's REST API is ready:</p> <p><code>Uvicorn running on http://127.0.0.1:5000 (Press CTRL+C to quit)</code></p>"},{"location":"usage/REST-API/#additional-options","title":"Additional options","text":"<p>You can also set general StartLeft options when using the API mode. More information on the Command Line Interface page  or with the command <code>startleft --help server</code>.</p> <p>For example, to launch the server with a log level of DEBUG for testing purposes you can use the following command:</p> <p><code>startleft --log-level DEBUG server</code></p>"},{"location":"usage/REST-API/#endpoints","title":"Endpoints","text":"<p>This section describes all the available endpoints, their parameters, and example requests and responses. </p> <p>Example files</p> <p>Refer to each specific format section for example files to use.</p>"},{"location":"usage/REST-API/#health","title":"Health","text":"<p><pre><code>GET /health\n</code></pre> This endpoint can be used to check the status of the application and its version.</p> Example RequestResponse <pre><code>curl localhost:5000/health\n</code></pre> <pre><code>{\n\"status\": \"OK\",\n\"version\": \"1.10.0\",\n\"components\": {\n\"StartLeft\": \"OK\"\n}\n}\n</code></pre>"},{"location":"usage/REST-API/#iac","title":"IaC","text":"<p><pre><code>POST /api/v1/startleft/iac\nRequest Body:\n    iac_file:                   Required. File that contains the IaC definition. If you want to add more than one IaC file, you need to duplicate this tag as many times as files you want to upload.\n    iac_type:                   Required. Type of the IaC file: [CLOUDFORMATION, TERRAFORM]\n    id                          Required. ID of the new project\n    name                        Required. Name of the new project\n    mapping_file                Required. File that contains the mapping between IaC resources and threat model resources.\n</code></pre> This endpoint accepts one or more IaC source files (currently Cloudformation  or Terraform) and a mapping file, and generates an OTM with  the resulting threat modeling content.</p> Example RequestResponse (reduced for simplicity)Files <pre><code>curl --location \\\n--request POST localhost:5000/api/v1/startleft/iac \\\n--header \"Content-Type: multipart/form-data\" \\\n--header \"Accept: application/json\" \\\n--form iac_type=\"CLOUDFORMATION\" \\\n--form iac_file=@\"./resources_cft_file.json\" \\\n--form iac_file=@\"./networks_cft_file.json\" \\\n--form mapping_file=@\"./iriusrisk-cft-mapping.yaml\" \\\n--form id=\"cft-to-otm-example\" \\\n--form name=\"CFT to OTM example\"\n</code></pre> <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"CFT to OTM example\",\n\"id\": \"cft-to-otm-example\"\n},\n\"representations\": [\n{\n\"name\": \"CloudFormation\",\n\"id\": \"CloudFormation\",\n\"type\": \"code\"\n}\n],\n\"trustZones\": [...],\n\"components\": [...],\n\"dataflows\": [...]\n}\n</code></pre> <p>You can download the example files from the examples directory.</p>"},{"location":"usage/REST-API/#diagram","title":"Diagram","text":"<p><pre><code>POST /api/v1/startleft/diagram\nRequest Body:\n    diag_file:                  Required. File that contains the diagram\n    diag_type:                  Required. Type of the diagram file: [VISIO, LUCID]\n    id                          Required. ID of the new project\n    name                        Required. Name of the new project\n    default_mapping_file        Required. File that contains the default mapping file between the diagram resources and threat model resources\n    custom_mapping_file         Optional. File that contains the custom user mapping file between the diagram resources and threat model resources\n</code></pre> This endpoint accepts one diagram source file (currently only in Visio  format, including diagrams exported from Lucidchart),  a mapping file, and an optional custom mapping file, and generates an OTM with the resulting threat modeling content.</p> Example RequestResponse (reduced for simplicity)visio-basic-example.vsdxdefault-mapping.yamlcustom-mapping.yaml <pre><code>curl --location \\\n--request POST localhost:5000/api/v1/startleft/diagram \\\n--header \"Content-Type: multipart/form-data\" \\\n--header \"Accept: application/json\" \\\n--form diag_type=\"VISIO\" \\\n--form diag_file=@\"./visio-basic-example.vsdx\" \\\n--form default_mapping_file=@\"./default-mapping.yaml\" \\\n--form custom_mapping_file=@\"./custom-mapping.yaml\" \\\n--form id=\"vsdx-to-otm-example\" \\\n--form name=\"VSDX to OTM example\"\n</code></pre> <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"VSDX to OTM example\",\n\"id\": \"vsdx-to-otm-example\"\n},\n\"representations\": [\n{\n\"name\": \"Visio\",\n\"id\": \"Visio\",\n\"type\": \"diagram\",\n\"size\": {\n\"width\": 1000,\n\"height\": 1000\n}\n}\n],\n\"trustZones\": [...],\n\"components\": [...],\n\"dataflows\": [...]\n}\n</code></pre> <p>You can download the <code>visio-basic-example.vsdx</code> from here.</p> <pre><code>trustzones:\n- label:  Public Cloud\ntype:   Public Cloud\nid:     b61d6911-338d-46a8-9f39-8dcd24abfe91\ncomponents:\n- label:  Amazon EC2\ntype:   ec2\n- label:  Database\ntype:   rds\ndataflows: []\n</code></pre> <pre><code>trustzones:\n- label:  Private Secured Cloud\ntype:   Private Secured\nid:     2ab4effa-40b7-4cd2-ba81-8247d29a6f2d\ncomponents:\n- label:  My Custom Machine\ntype:   empty-component\n- label:  My Custom VPC\ntype:   empty-component\ndataflows: []\n</code></pre>"},{"location":"usage/REST-API/#external-threat-model","title":"External threat model","text":"<p><pre><code>POST /api/v1/startleft/external-threat-model\nRequest Body:\n    source_file:                Required. File that contains the threat model\n    source_type:                Required. Type of the threat model file: MTMT\n    id                          Required. ID of the new project\n    name                        Required. Name of the new project\n    default_mapping_file        Required. File that contains the default mapping file between the source threat model resources and the resulting threat model resources\n</code></pre> This endpoint accepts one threat modeling source file (currently only  Microsoft Threat Modeling Tool) and a mapping  file, and generates an OTM with the resulting threat modeling content.</p> Example RequestResponse (reduced for simplicity)Files <pre><code>curl --location \\\n--request POST localhost:5000/api/v1/startleft/external-threat-model \\\n--header \"Content-Type: multipart/form-data\" \\\n--header \"Accept: application/json\" \\\n--form source_type=\"MTMT\" \\\n--form source_file=@\"./MTMT_example.tm7\" \\\n--form default_mapping_file=@\"./mtmt_default_mapping_example.yaml\" \\\n--form id=\"tm7-to-otm-example\" \\\n--form name=\"TM7 to OTM example\"\n</code></pre> <pre><code>{\n\"otmVersion\": \"0.1.0\",\n\"project\": {\n\"name\": \"TM7 to OTM example\",\n\"id\": \"tm7-to-otm-example\"\n},\n\"representations\": [\n{\n\"name\": \"Microsoft Threat Modeling Tool\",\n\"id\": \"Microsoft Threat Modeling Tool\",\n\"type\": \"threat-model\"\n},\n{\n\"name\": \"tm7-to-otm-example Diagram Representation\",\n\"id\": \"tm7-to-otm-example-diagram\",\n\"type\": \"diagram\",\n\"size\": {\n\"width\": 2000,\n\"height\": 2000\n}\n}\n],\n\"trustZones\": [...],\n\"components\": [...],\n\"dataflows\": [...],\n\"threats\": [...],\n\"mitigations\": [...]\n}\n</code></pre> <p>You can download the example files from the examples directory.</p>"},{"location":"usage/REST-API/#error-management","title":"Error management","text":"<p>Refer to the Errors Management page to learn about the different error responses  when StartLeft is operating in API mode.</p>"},{"location":"usage/REST-API/#uvicorn","title":"Uvicorn","text":"<p>It is also possible to launch StartLeft's server directly through Uvicorn.  This could be useful, for example, to deploy it in a container.</p> <p>Example command:</p> <pre><code>uvicorn startleft.startleft.api.fastapi_server:webapp --host 0.0.0.0 --port 5000 --log-level critical\n</code></pre>"}]}